# Climate System Debug & Status Card
type: vertical-stack
cards:
  # System Status Overview
  - type: markdown
    title: "ğŸ” Climate System Debug Status"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #0F172A 0%, #1E293B 100%);
          border: 2px solid #3B82F6;
          border-radius: 12px;
        }
    content: |
      ## Current Season & Settings
      **Season:** {{ states('input_select.climate_season') | title }}
      **Occupancy:** {{ states('input_select.occupancy') | title }}
      **Month:** {{ now().strftime('%B') }} ({{ now().month }})
      **Time:** {{ now().strftime('%H:%M') }}

      ### Weather Flags & Context

      **HEATING CONDITIONS (Cold):**
      - **Super Cold Today (<5Â°C):** {{ 'YES â„ï¸' if is_state('input_boolean.super_cold_today', 'on') else 'No' }}
      - **Cold Today (5-10Â°C):** {{ 'YES â„ï¸' if is_state('input_boolean.cold_today_flag', 'on') else 'No' }}
      - **Cool Today (10-15Â°C):** {{ 'YES â˜ï¸' if is_state('input_boolean.cool_today_flag', 'on') else 'No' }}

      **COOLING CONDITIONS (Hot):**
      - **Super Hot Today (>25Â°C):** {{ 'YES ğŸ”¥' if is_state('input_boolean.super_hot_today', 'on') else 'No' }}
      - **Hot Today (>21Â°C):** {{ 'YES â˜€ï¸' if is_state('input_boolean.hot_today_flag', 'on') else 'No' }}
      - **Warm Today (>18Â°C):** {{ 'YES ğŸŒ¤ï¸' if is_state('input_boolean.warm_today_flag', 'on') else 'No' }}

      **Forecast:**
      - **Today Max Temp:** {{ states('sensor.braybrook_temp_max_0') }}Â°C
      - **Tomorrow Min Temp:** {{ states('sensor.braybrook_temp_min_1') }}Â°C (used for cold day detection)

      **System Status:**
      - **Working From Home:** {{ 'YES ğŸ’¼' if is_state('binary_sensor.working_from_home', 'on') else 'No' }}
      - **Solar Excess Available:** {{ 'YES â˜€ï¸' if is_state('binary_sensor.solar_excess_available', 'on') else 'No' }}

      ### Time Windows (Active Now)
      {% set hour = now().hour %}
      {% set minute = now().minute %}
      {% set time_decimal = hour + (minute / 60.0) %}
      - **Preemptive Cooling (Master):** {{ 'ACTIVE ğŸŸ¢' if (time_decimal >= 9 and time_decimal < 20) else 'Inactive' }} (09:00-20:00)
      - **Preemptive Cooling (Study/Kids):** {{ 'ACTIVE ğŸŸ¢' if (time_decimal >= 9 and time_decimal < 18) else 'Inactive' }} (09:00-18:00)
      - **Naptime (Study/Kids):** {{ 'ACTIVE ğŸŸ¢' if (time_decimal >= 12.25 and time_decimal < 16) else 'Inactive' }} (12:15-16:00)
      - **Pre-bedtime (Study/Kids):** {{ 'ACTIVE ğŸŸ¢' if (time_decimal >= 18 and time_decimal < 18.75) else 'Inactive' }} (18:00-18:45)
      - **Bedtime (Study/Kids):** {{ 'ACTIVE ğŸŸ¢' if (time_decimal >= 18.75 or time_decimal < 6) else 'Inactive' }} (18:45-06:00)
      - **Bedtime (Master):** {{ 'ACTIVE ğŸŸ¢' if (time_decimal >= 21 or time_decimal < 6) else 'Inactive' }} (21:00-06:00)
      - **Frost Protection (Master):** {{ 'ACTIVE ğŸŸ¢' if (time_decimal < 6) else 'Inactive' }} (00:00-06:00)

      ---

  # System Control Panel
  - type: entities
    title: "ğŸ›ï¸ Climate System Controls"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-radius: 12px;
          border: 2px solid #F59E0B;
        }
    entities:
      - entity: input_select.climate_season
        name: "Season"
        icon: mdi:weather-partly-cloudy
      - entity: input_select.occupancy
        name: "Occupancy Mode"
        icon: mdi:home-account
      - type: divider
      - entity: input_boolean.super_cold_today
        name: "Super Cold Day Flag (<5Â°C)"
        icon: mdi:snowflake-alert
      - entity: input_boolean.cold_today_flag
        name: "Cold Day Flag (5-10Â°C)"
        icon: mdi:snowflake
      - entity: input_boolean.cool_today_flag
        name: "Cool Day Flag (10-15Â°C)"
        icon: mdi:weather-cloudy
      - type: divider
      - entity: input_boolean.super_hot_today
        name: "Super Hot Day Flag (>25Â°C)"
        icon: mdi:weather-sunny-alert
      - entity: input_boolean.hot_today_flag
        name: "Hot Day Flag (>21Â°C)"
        icon: mdi:weather-sunny
      - entity: input_boolean.warm_today_flag
        name: "Warm Day Flag (>18Â°C)"
        icon: mdi:weather-partly-sunny
      - type: divider
      - entity: binary_sensor.working_from_home
        name: "Working From Home"
        icon: mdi:laptop
      - entity: binary_sensor.solar_excess_available
        name: "Solar Excess Available"
        icon: mdi:solar-power
      - type: divider
      - entity: zone.home
        name: "People at Home"
        icon: mdi:account-group

  # Master Bedroom Status
  - type: markdown
    title: "ğŸ›ï¸ Master Bedroom Status"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #3B82F6;
        }
    content: |
      ### Climate State
      **HVAC Mode:** {{ states('climate.masterbed_room_ac') | upper }}
      **Preset Mode:** {{ state_attr('climate.masterbed_room_ac', 'preset_mode') | default('none') | title }}
      - Available: {{ state_attr('climate.masterbed_room_ac', 'preset_modes') | join(', ') }}
      **Target Temp:** {{ state_attr('climate.masterbed_room_ac', 'temperature') }}Â°C
      **Current Temp:** {{ states('sensor.ble_temperature_masterbed_temp_humidity_sensor') }}Â°C
      **Humidity:** {{ states('sensor.ble_humidity_masterbed_temp_humidity_sensor') }}%
      **Fan:** {{ states('fan.masterbedroom_fan') | title }}
      {% if not is_state('fan.masterbedroom_fan', 'off') %}
      **Fan Speed:** {{ state_attr('fan.masterbedroom_fan', 'percentage') }}%
      {% endif %}

      ### Blind & Door Status
      **Roller Blinds:** {{ state_attr('cover.roller_blinds_chan1', 'current_position') | int }}% open
      **Curtains:** {{ states('cover.curtain_3_b3bb') | title }}
      **Balcony Door:** {{ 'OPEN ğŸšª' if is_state('binary_sensor.balcony_door_sensor_magnet_opening_2', 'on') else 'Closed' }}
      **Bedroom Door:** {{ 'OPEN ğŸšª' if is_state('binary_sensor.master_bedroom_door_sensor_opening', 'on') else 'Closed âœ…' }}

      ### Manual Overrides
      **Climate Manual Control:** {{ 'ğŸ”´ ACTIVE - Automations Paused' if is_state('input_boolean.climate_manual_control_master', 'on') else 'âœ… Off - Automations Active' }}
      **Blind Manual Control:** {{ 'ğŸ”´ ACTIVE - Blind automations paused' if is_state('input_boolean.blind_manual_control', 'on') else 'âœ… Off - Blind automations active' }}

      ### Why Current State?
      {% set temp = states('sensor.ble_temperature_masterbed_temp_humidity_sensor') | float(0) %}
      {% set humidity = states('sensor.ble_humidity_masterbed_temp_humidity_sensor') | float(0) %}
      {% set season = states('input_select.climate_season') %}
      {% set occupancy = states('input_select.occupancy') %}
      {% set hvac = states('climate.masterbed_room_ac') %}
      {% set preset = state_attr('climate.masterbed_room_ac', 'preset_mode') %}
      {% set door_open = is_state('binary_sensor.master_bedroom_door_sensor_opening', 'on') %}
      {% set climate_manual = is_state('input_boolean.climate_manual_control_master', 'on') %}
      {% set hot_day = is_state('input_boolean.hot_today_flag', 'on') %}
      {% set super_hot_day = is_state('input_boolean.super_hot_today', 'on') %}
      {% set warm_day = is_state('input_boolean.warm_today_flag', 'on') %}
      {% set wfh = is_state('binary_sensor.working_from_home', 'on') %}
      {% set solar_excess = is_state('binary_sensor.solar_excess_available', 'on') %}
      {% set hour = now().hour %}
      {% set minute = now().minute %}
      {% set time_decimal = hour + (minute / 60.0) %}
      {% set bedtime = time_decimal >= 21 or time_decimal < 6 %}
      {% set frost_protection = time_decimal < 6 %}
      {% set preemptive_window = time_decimal >= 9 and time_decimal < 20 %}

      {% if occupancy == 'holiday' %}
      **ğŸ–ï¸ HOLIDAY MODE** - All HVAC off to save energy
      {% elif door_open %}
      **ğŸšª DOOR OPEN** - All climate turned off (Principle #5: door checks always active)
      {% elif climate_manual %}
      **ğŸ”´ MANUAL CONTROL ACTIVE** - User manually changed climate, automations paused for 4 hours
      {% elif occupancy == 'away' %}
      **ğŸ  AWAY MODE** - Using eco preset, reduced comfort
        {% if season == 'winter' and temp < 16 %}
      **â„ï¸ ECO HEATING** ({{ temp }}Â°C < 16Â°C) - Frost protection with eco preset
        {% elif season == 'summer' and hot_day and temp > 26 %}
      **â˜€ï¸ ECO COOLING** ({{ temp }}Â°C > 26Â°C, hot day) - Prevent overheating with eco preset
        {% else %}
      **âœ… COMFORTABLE** - No action needed in away mode
        {% endif %}
      {% elif bedtime %}
      **ğŸŒ™ BEDTIME/OVERNIGHT** (21:00-06:00)
        {% if frost_protection and season == 'winter' and temp < 16 %}
      **â„ï¸ FROST PROTECTION** ({{ temp }}Â°C < 16Â°C)
      - Mode: Heat, Preset: Frost
      - Target: Prevent freezing overnight
      - Door check: Required (Principle #5)
      - Solar: NOT required (Principle #4 exception)
        {% elif season == 'winter' and temp < 18 %}
      **ğŸ”¥ BEDTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Target: 20Â°C for sleep comfort
      - Door check: Required (Principle #5)
      - Solar: NOT required (Principle #4 exception)
        {% elif (warm_day or hot_day or super_hot_day) and temp > 22 %}
      **ğŸŒ¡ï¸ WARM NIGHT COOLING** ({{ temp }}Â°C > 22Â°C after warm/hot day)
      - Mode: Cool, Preset: Boost
      - Target: Comfort cooling overnight
      - Door check: Required (Principle #5)
      - Solar: NOT required (Principle #4 exception)
      - Triggered: 21:00 on warm/hot/super-hot days
        {% else %}
      **âœ… COMFORTABLE** ({{ temp }}Â°C) - No heating or cooling needed overnight
        {% endif %}
      {% elif humidity > 75 %}
      **ğŸ’§ HIGH HUMIDITY** ({{ humidity }}% > 75%) - Dry mode active
      - Principle #3: Dry mode only when temp not extreme
      - Cooling/heating takes priority if temp triggers
      {% elif season == 'summer' %}
      **â˜€ï¸ SUMMER MODE**
        {% if super_hot_day and preemptive_window and temp > 22 %}
      **ğŸ”¥ PREEMPTIVE COOLING** (Super hot day, {{ temp }}Â°C > 22Â°C)
      - Window: 09:00-20:00 (Principle #7)
      - Mode: Cool, Preset: Comfort
      - Door check: Required (Principle #5)
      - Solar: NOT required for super_hot preemptive (Principle #7)
      - Goal: Get ahead of extreme heat
        {% elif hot_day and temp >= 24 %}
      **ğŸŒ¡ï¸ REACTIVE COOLING** (Hot day, {{ temp }}Â°C â‰¥ 24Â°C)
      - Mode: Cool, Preset: Comfort
      - Door check: Required (Principle #5)
      - Solar: Required for daytime cooling (Principle #4)
          {% if not solar_excess and not wfh %}
      - âš ï¸ BLOCKED: No solar excess (need solar or WFH)
          {% endif %}
        {% elif temp >= 26 %}
      **ğŸ”¥ EMERGENCY COOLING** ({{ temp }}Â°C â‰¥ 26Â°C)
      - Mode: Cool, Preset: Boost
      - Triggered regardless of flags when extremely hot
        {% else %}
      **âœ… COMFORTABLE** ({{ temp }}Â°C < 24Â°C) - No cooling needed
        {% endif %}
      {% elif season == 'winter' %}
      **â„ï¸ WINTER MODE**
        {% if temp < 18 %}
          {% if wfh or (hour >= 17 and hour < 22) %}
      **ğŸ”¥ DAYTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Target: 20Â°C
      - Door check: Required (Principle #5)
      - Solar: Required UNLESS WFH (Principle #7)
            {% if not solar_excess and not wfh %}
      - âš ï¸ BLOCKED: No solar excess and not WFH
            {% elif wfh %}
      - âœ… WFH: Bypassing solar requirement (Principle #7)
            {% endif %}
          {% else %}
      **ğŸ’¼ NOT WFH & OUTSIDE EVENING** - Heating skipped to save energy
      - WFH status: {{ 'Yes' if wfh else 'No' }}
      - Current time: {{ now().strftime('%H:%M') }}
      - Heating allowed: WFH daytime or evening (17:00-22:00)
          {% endif %}
        {% else %}
      **âœ… WARM ENOUGH** ({{ temp }}Â°C â‰¥ 18Â°C) - No heating needed
        {% endif %}
      {% elif season == 'spring' or season == 'autumn' %}
      **ğŸ‚ SHOULDER SEASON ({{ season | title }})** - Minimal intervention
        {% if temp >= 26 %}
      **ğŸ”¥ HOT** ({{ temp }}Â°C â‰¥ 26Â°C) - Cooling
        {% elif temp < 16 %}
      **â„ï¸ COLD** ({{ temp }}Â°C < 16Â°C) - Heating if evening/bedtime
        {% else %}
      **âœ… COMFORTABLE** (16-26Â°C) - Natural ventilation
        {% endif %}
      {% endif %}

      ### Automation Status
      {% set manager_last = state_attr('automation.hvac_master_bedroom_versatile_climate_manager', 'last_triggered') %}
      {% set fan_last = state_attr('automation.hvac_master_bedroom_fan_sync_with_climate', 'last_triggered') %}
      {% set hot_night_last = state_attr('automation.bedrooms_overnight_ac_on_hot_days', 'last_triggered') %}
      {% set hot_off_last = state_attr('automation.bedrooms_turn_off_overnight_ac_in_morning', 'last_triggered') %}

      **ğŸ¯ HVAC - Master Bedroom Versatile Climate Manager**
      - Status: {{ 'âœ… ON' if is_state('automation.hvac_master_bedroom_versatile_climate_manager', 'on') else 'ğŸ”´ OFF' }}
      {% if manager_last %}
      - Last triggered: {{ relative_time(manager_last) }} ago
      {% endif %}
      - Triggers: State-based (temp, humidity, door, solar, season, occupancy, flags, WFH) + Time-specific (bedtime, wake-up)
      - Principle #10: No polling - fires only on state changes

      **ğŸªŸ Blinds Management**
      {% set close_hot = state_attr('automation.master_bedroom_close_blinds_when_hot', 'last_triggered') %}
      {% set close_night = state_attr('automation.master_bedroom_close_blinds_for_night_mode', 'last_triggered') %}
      {% set open_morning = state_attr('automation.master_bedroom_open_blinds_for_morning_routine', 'last_triggered') %}

      - **Close When Hot:** {{ 'âœ… ON' if is_state('automation.master_bedroom_close_blinds_when_hot', 'on') else 'ğŸ”´ OFF' }}
        {% if close_hot %}(last: {{ relative_time(close_hot) }} ago){% endif %}
      - **Close for Night:** {{ 'âœ… ON' if is_state('automation.master_bedroom_close_blinds_for_night_mode', 'on') else 'ğŸ”´ OFF' }}
        {% if close_night %}(last: {{ relative_time(close_night) }} ago){% endif %}
      - **Open for Morning:** {{ 'âœ… ON' if is_state('automation.master_bedroom_open_blinds_for_morning_routine', 'on') else 'ğŸ”´ OFF' }}
        {% if open_morning %}(last: {{ relative_time(open_morning) }} ago){% endif %}

      **ğŸŒ€ Fan Sync with Climate**
      - Status: {{ 'âœ… ON' if is_state('automation.hvac_master_bedroom_fan_sync_with_climate', 'on') else 'ğŸ”´ OFF' }}
      {% if fan_last %}
      - Last triggered: {{ relative_time(fan_last) }} ago
      {% endif %}

      **ğŸ”¥ Warm/Hot Night Bedroom Cooling (System-Wide)**
      - Status: {{ 'âœ… ON' if is_state('automation.bedrooms_overnight_ac_on_hot_days', 'on') else 'ğŸ”´ OFF' }}
      - Triggers: 9:00pm when warm/hot/super-hot day
      {% if hot_night_last %}
      - Last triggered: {{ relative_time(hot_night_last) }} ago
      {% endif %}

      **â° Turn Off Overnight AC in Morning (System-Wide)**
      - Status: {{ 'âœ… ON' if is_state('automation.bedrooms_turn_off_overnight_ac_in_morning', 'on') else 'ğŸ”´ OFF' }}
      - Triggers: 6:00am daily
      {% if hot_off_last %}
      - Last triggered: {{ relative_time(hot_off_last) }} ago
      {% endif %}

      ---

  # Living Room Status
  - type: markdown
    title: "ğŸ›‹ï¸ Living Room Status"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #EC4899;
        }
    content: |
      ### Climate State
      **HVAC Mode:** {{ states('climate.living_room_ac_2') | upper }}
      **Preset Mode:** {{ state_attr('climate.living_room_ac_2', 'preset_mode') | default('none') | title }}
      - Available: {{ state_attr('climate.living_room_ac_2', 'preset_modes') | join(', ') }}
      **Target Temp:** {{ state_attr('climate.living_room_ac_2', 'temperature') }}Â°C
      **Current Temp:** {{ states('sensor.living_room_temperature_offset') }}Â°C
      **Kitchen Temp:** {{ states('sensor.ble_temperature_kitchen_temp_humidity_sensor') }}Â°C

      ### Door Status (ALL 3 Must Be Closed - Principle #4)
      **Living Room Door:** {{ 'OPEN ğŸšª' if is_state('binary_sensor.living_room_door_sensor_opening', 'on') else 'Closed âœ…' }}
      **Interior Garage Door:** {{ 'OPEN ğŸšª' if is_state('binary_sensor.interior_garage_door_sensor_magnet_opening', 'on') else 'Closed âœ…' }}
      **Front Door:** {{ 'OPEN ğŸšª' if is_state('binary_sensor.front_door_sensor_opening', 'on') else 'Closed âœ…' }}
      {% set all_doors_closed = not is_state('binary_sensor.living_room_door_sensor_opening', 'on') and not is_state('binary_sensor.interior_garage_door_sensor_magnet_opening', 'on') and not is_state('binary_sensor.front_door_sensor_opening', 'on') %}
      **All Doors Status:** {{ 'âœ… ALL CLOSED - HVAC Allowed' if all_doors_closed else 'ğŸšª AT LEAST ONE OPEN - HVAC Blocked' }}

      ### Manual Override
      **Climate Manual Control:** {{ 'ğŸ”´ ACTIVE - Automations Paused' if is_state('input_boolean.climate_manual_control_living', 'on') else 'âœ… Off - Automations Active' }}

      ### Why Current State?
      {% set temp = states('sensor.living_room_temperature_offset') | float(0) %}
      {% set kitchen_temp = states('sensor.ble_temperature_kitchen_temp_humidity_sensor') | float(0) %}
      {% set season = states('input_select.climate_season') %}
      {% set occupancy = states('input_select.occupancy') %}
      {% set hvac = states('climate.living_room_ac_2') %}
      {% set preset = state_attr('climate.living_room_ac_2', 'preset_mode') %}
      {% set manual = is_state('input_boolean.climate_manual_control_living', 'on') %}
      {% set any_door_open = is_state('binary_sensor.living_room_door_sensor_opening', 'on') or is_state('binary_sensor.interior_garage_door_sensor_magnet_opening', 'on') or is_state('binary_sensor.front_door_sensor_opening', 'on') %}
      {% set hot_day = is_state('input_boolean.hot_today_flag', 'on') %}
      {% set super_hot_day = is_state('input_boolean.super_hot_today', 'on') %}
      {% set wfh = is_state('binary_sensor.working_from_home', 'on') %}
      {% set solar_excess = is_state('binary_sensor.solar_excess_available', 'on') %}
      {% set hour = now().hour %}
      {% set minute = now().minute %}
      {% set time_decimal = hour + (minute / 60.0) %}

      {% if occupancy == 'holiday' %}
      **ğŸ–ï¸ HOLIDAY MODE** - All HVAC off
      {% elif any_door_open %}
      **ğŸšª DOOR OPEN** - At least one of 3 doors open, all climate off
      - Principle #4: Living room requires ALL 3 doors closed
      {% elif manual %}
      **ğŸ”´ MANUAL CONTROL ACTIVE** - Automations paused for 4 hours
      {% elif occupancy == 'away' %}
      **ğŸ  AWAY MODE** - Eco preset
        {% if season == 'winter' and temp < 14.5 %}
      **â„ï¸ ECO HEATING** ({{ temp }}Â°C < 14.5Â°C) - Prevent cold with eco
        {% elif season == 'summer' and hot_day and temp > 26 %}
      **â˜€ï¸ ECO COOLING** ({{ temp }}Â°C > 26Â°C, hot day) - Prevent overheating with eco
        {% else %}
      **âœ… COMFORTABLE** - No action in away mode
        {% endif %}
      {% elif season == 'winter' %}
      **â„ï¸ WINTER MODE**
        {% if time_decimal >= 5.5 and time_decimal < 9 %}
          {% if temp < 19 or kitchen_temp < 19 %}
      **â˜• MORNING PREHEAT** (05:30-09:00)
      - Current: {{ temp }}Â°C | Kitchen: {{ kitchen_temp }}Â°C
      - Threshold: 19Â°C
      - Mode: Heat, Preset: Comfort
      - Target: Warm before family wakes
      - Solar: NOT required (Principle #4 exception for morning preheat)
          {% else %}
      **âœ… WARM ENOUGH** - Preheat not needed (â‰¥19Â°C)
          {% endif %}
        {% elif time_decimal >= 9 and time_decimal < 22 %}
          {% if temp < 18 %}
      **ğŸ”¥ DAY HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Target: 20Â°C
      - Solar: Required UNLESS WFH (Principle #7)
            {% if not solar_excess and not wfh %}
      - âš ï¸ BLOCKED: No solar excess and not WFH
            {% elif wfh %}
      - âœ… WFH: Bypassing solar requirement
            {% endif %}
          {% else %}
      **âœ… COMFORTABLE** ({{ temp }}Â°C â‰¥ 18Â°C) - No heating needed
          {% endif %}
        {% elif time_decimal >= 22 or time_decimal < 5.5 %}
          {% if temp < 14.5 %}
      **ğŸŒ™ NIGHT ECO HEATING** ({{ temp }}Â°C < 14.5Â°C)
      - Mode: Heat, Preset: Eco
      - Target: Prevent cold overnight
          {% elif temp > 16 %}
      **âœ… NIGHT - WARM** ({{ temp }}Â°C > 16Â°C) - Heater off
          {% else %}
      **ğŸŒ™ NIGHT** (14.5-16Â°C) - Monitoring
          {% endif %}
        {% endif %}
      {% elif season == 'summer' %}
      **â˜€ï¸ SUMMER MODE**
        {% if temp > 26 %}
      **ğŸ”¥ REACTIVE COOLING** ({{ temp }}Â°C > 26Â°C)
      - Mode: Cool, Preset: Comfort
      - Solar: Required for daytime (Principle #4)
          {% if not solar_excess and not wfh %}
      - âš ï¸ BLOCKED: No solar excess
          {% endif %}
        {% else %}
      **âœ… COMFORTABLE** ({{ temp }}Â°C â‰¤ 26Â°C)
        {% endif %}
      {% elif season == 'spring' or season == 'autumn' %}
      **ğŸ‚ SHOULDER SEASON ({{ season | title }})**
        {% if temp > 26 %}
      **ğŸ”¥ HOT** - Cooling may activate
        {% elif temp < 17 and time_decimal >= 5.5 and time_decimal < 9 %}
      **â„ï¸ COLD MORNING** - Light preheat if needed
        {% else %}
      **âœ… COMFORTABLE** - Natural ventilation
        {% endif %}
      {% endif %}

      ### Automation Status
      {% set manager_last = state_attr('automation.hvac_living_room_versatile_climate_manager', 'last_triggered') %}

      **ğŸ¯ HVAC - Living Room Versatile Climate Manager**
      - Status: {{ 'âœ… ON' if is_state('automation.hvac_living_room_versatile_climate_manager', 'on') else 'ğŸ”´ OFF' }}
      {% if manager_last %}
      - Last triggered: {{ relative_time(manager_last) }} ago
      {% endif %}
      - Triggers: State-based (temp, humidity, doorsÃ—3, solar, season, occupancy, flags, WFH) + Time-specific (morning preheat, night setback)
      - Principle #10: No polling - fires only on state changes

      ---

  # Study (Lucas/Henry) Status
  - type: markdown
    title: "ğŸ“š Study (Lucas's Room) Status"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #10B981;
        }
    content: |
      ### Climate State
      **HVAC Mode:** {{ states('climate.study_room_ac') | upper }}
      **Preset Mode:** {{ state_attr('climate.study_room_ac', 'preset_mode') | default('none') | title }}
      - Available: {{ state_attr('climate.study_room_ac', 'preset_modes') | join(', ') }}
      **Target Temp:** {{ state_attr('climate.study_room_ac', 'temperature') }}Â°C
      **Current Temp:** {{ states('sensor.study_room_temp_humidity_sensor_temperature') }}Â°C
      **Door:** {{ 'OPEN ğŸšª' if is_state('binary_sensor.henry_door_sensor_magnet_opening', 'on') else 'Closed âœ…' }}
      **Manual Override:** {{ 'ğŸ”´ ACTIVE' if is_state('input_boolean.climate_manual_control_study', 'on') else 'âœ… Off' }}

      ### Why Current State?
      {% set temp = states('sensor.study_room_temp_humidity_sensor_temperature') | float(0) %}
      {% set season = states('input_select.climate_season') %}
      {% set occupancy = states('input_select.occupancy') %}
      {% set hvac = states('climate.study_room_ac') %}
      {% set preset = state_attr('climate.study_room_ac', 'preset_mode') %}
      {% set door_open = is_state('binary_sensor.henry_door_sensor_magnet_opening', 'on') %}
      {% set manual = is_state('input_boolean.climate_manual_control_study', 'on') %}
      {% set hot_day = is_state('input_boolean.hot_today_flag', 'on') %}
      {% set super_hot_day = is_state('input_boolean.super_hot_today', 'on') %}
      {% set warm_day = is_state('input_boolean.warm_today_flag', 'on') %}
      {% set solar_excess = is_state('binary_sensor.solar_excess_available', 'on') %}
      {% set hour = now().hour %}
      {% set minute = now().minute %}
      {% set time_decimal = hour + (minute / 60.0) %}
      {% set naptime = time_decimal >= 12.25 and time_decimal < 16 %}
      {% set pre_bedtime = time_decimal >= 18 and time_decimal < 18.75 %}
      {% set bedtime = time_decimal >= 18.75 or time_decimal < 6 %}
      {% set preemptive_window = time_decimal >= 9 and time_decimal < 18 %}

      {% if occupancy == 'holiday' %}
      **ğŸ–ï¸ HOLIDAY MODE** - All HVAC off
      {% elif door_open %}
      **ğŸšª DOOR OPEN** - Climate off (Principle #5)
      {% elif manual %}
      **ğŸ”´ MANUAL CONTROL ACTIVE** - Automations paused
      {% elif occupancy == 'away' %}
      **ğŸ  AWAY MODE** - Eco preset
        {% if season == 'winter' and temp < 16 %}
      **â„ï¸ ECO HEATING** ({{ temp }}Â°C < 16Â°C)
        {% elif season == 'summer' and hot_day and temp > 24 %}
      **â˜€ï¸ ECO COOLING** ({{ temp }}Â°C > 24Â°C, hot day)
        {% else %}
      **âœ… COMFORTABLE** - No action
        {% endif %}
      {% elif bedtime %}
      **ğŸŒ™ BEDTIME/OVERNIGHT** (18:45-06:00)
        {% if season == 'winter' and temp < 18 %}
      **ğŸ”¥ BEDTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Target: 20Â°C
      - Solar: NOT required (Principle #4 exception)
        {% elif (warm_day or hot_day or super_hot_day) and temp > 22 %}
      **ğŸŒ¡ï¸ WARM NIGHT COOLING** ({{ temp }}Â°C > 22Â°C after warm/hot day)
      - Mode: Cool, Preset: Boost
      - Solar: NOT required (Principle #4 exception)
      - Triggered: 18:45 on warm/hot/super-hot days
        {% else %}
      **âœ… COMFORTABLE** ({{ temp }}Â°C)
        {% endif %}
      {% elif pre_bedtime %}
      **ğŸŒ… PRE-BEDTIME** (18:00-18:45)
        {% if season == 'winter' and temp < 18 %}
      **ğŸ”¥ PRE-BEDTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Solar: NOT required (Principle #4 exception)
        {% elif (warm_day or hot_day or super_hot_day) and temp > 22 %}
      **ğŸŒ¡ï¸ PRE-BEDTIME COOLING** ({{ temp }}Â°C > 22Â°C, warm/hot day)
      - Mode: Cool, Preset: Comfort
      - Solar: NOT required (Principle #4 exception)
        {% else %}
      **âœ… COMFORTABLE**
        {% endif %}
      {% elif naptime %}
      **ğŸ˜´ NAPTIME** (12:15-16:00)
        {% if season == 'winter' and temp < 18 %}
      **ğŸ”¥ NAPTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Solar: NOT required (Principle #4 exception for naptime)
        {% elif (hot_day or super_hot_day) and temp > 22 %}
      **ğŸŒ¡ï¸ NAPTIME COOLING** ({{ temp }}Â°C > 22Â°C, hot day)
      - Mode: Cool, Preset: Comfort
      - Solar: NOT required (Principle #4 exception for naptime)
        {% else %}
      **âœ… COMFORTABLE**
        {% endif %}
      {% elif season == 'summer' %}
      **â˜€ï¸ SUMMER MODE**
        {% if super_hot_day and preemptive_window and temp > 22 %}
      **ğŸ”¥ PREEMPTIVE COOLING** (Super hot, {{ temp }}Â°C > 22Â°C)
      - Window: 09:00-18:00 (Principle #7)
      - Mode: Cool, Preset: Comfort
      - Solar: NOT required for super_hot preemptive
        {% elif hot_day and temp >= 24 %}
      **ğŸŒ¡ï¸ REACTIVE COOLING** (Hot day, {{ temp }}Â°C â‰¥ 24Â°C)
      - Mode: Cool, Preset: Comfort
      - Solar: Required (Principle #4)
          {% if not solar_excess %}
      - âš ï¸ BLOCKED: No solar excess
          {% endif %}
        {% else %}
      **âœ… COMFORTABLE** ({{ temp }}Â°C < 24Â°C)
        {% endif %}
      {% elif season == 'winter' %}
      **â„ï¸ WINTER MODE**
        {% if temp < 18 %}
      **ğŸ”¥ DAYTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Target: 20Â°C
      - Solar: Required (Principle #4)
          {% if not solar_excess %}
      - âš ï¸ BLOCKED: No solar excess
          {% endif %}
        {% else %}
      **âœ… WARM ENOUGH** ({{ temp }}Â°C â‰¥ 18Â°C)
        {% endif %}
      {% elif season == 'spring' or season == 'autumn' %}
      **ğŸ‚ SHOULDER SEASON ({{ season | title }})**
        {% if temp >= 26 %}
      **ğŸ”¥ HOT** - Cooling
        {% elif temp < 16 %}
      **â„ï¸ COLD** - Heating if naptime/bedtime
        {% else %}
      **âœ… COMFORTABLE**
        {% endif %}
      {% endif %}

      ### Automation Status
      {% set manager_last = state_attr('automation.hvac_study_versatile_climate_manager', 'last_triggered') %}
      {% set hot_night_last = state_attr('automation.bedrooms_overnight_ac_on_hot_days', 'last_triggered') %}

      **ğŸ¯ HVAC - Study Versatile Climate Manager**
      - Status: {{ 'âœ… ON' if is_state('automation.hvac_study_versatile_climate_manager', 'on') else 'ğŸ”´ OFF' }}
      {% if manager_last %}
      - Last triggered: {{ relative_time(manager_last) }} ago
      {% endif %}
      - Triggers: State-based (temp, door, solar, season, occupancy, flags) + Time-specific (naptime, pre-bedtime, bedtime, wake-up, preemptive windows)
      - Principle #10: No polling - fires only on state changes

      {% set warm_or_hot_day = warm_day or hot_day or super_hot_day %}
      {% if warm_or_hot_day %}
      **ğŸ”¥ Warm/Hot Night Cooling:** {{ 'âœ… ACTIVE' if hvac == 'cool' else 'Scheduled for 18:45' }}
      - Day flags: Warm={{ warm_day }}, Hot={{ hot_day }}, Super-hot={{ super_hot_day }}
      {% endif %}

      ---

  # Kids Room (Otto) Status
  - type: markdown
    title: "ğŸ‘¶ Kids Room (Otto) Status"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #F59E0B;
        }
    content: |
      ### Climate State
      **HVAC Mode:** {{ states('climate.kids_room_ac') | upper }}
      **Preset Mode:** {{ state_attr('climate.kids_room_ac', 'preset_mode') | default('none') | title }}
      - Available: {{ state_attr('climate.kids_room_ac', 'preset_modes') | join(', ') }}
      **Target Temp:** {{ state_attr('climate.kids_room_ac', 'temperature') }}Â°C
      **Current Temp:** {{ states('sensor.kids_room_temp_humidity_sensor_temperature') }}Â°C
      **Door:** {{ 'OPEN ğŸšª' if is_state('binary_sensor.otto_room_door_sensor_opening', 'on') else 'Closed âœ…' }}
      **Manual Override:** {{ 'ğŸ”´ ACTIVE' if is_state('input_boolean.climate_manual_control_otto', 'on') else 'âœ… Off' }}

      ### Why Current State?
      {% set temp = states('sensor.kids_room_temp_humidity_sensor_temperature') | float(0) %}
      {% set season = states('input_select.climate_season') %}
      {% set occupancy = states('input_select.occupancy') %}
      {% set hvac = states('climate.kids_room_ac') %}
      {% set preset = state_attr('climate.kids_room_ac', 'preset_mode') %}
      {% set door_open = is_state('binary_sensor.otto_room_door_sensor_opening', 'on') %}
      {% set manual = is_state('input_boolean.climate_manual_control_otto', 'on') %}
      {% set hot_day = is_state('input_boolean.hot_today_flag', 'on') %}
      {% set super_hot_day = is_state('input_boolean.super_hot_today', 'on') %}
      {% set warm_day = is_state('input_boolean.warm_today_flag', 'on') %}
      {% set solar_excess = is_state('binary_sensor.solar_excess_available', 'on') %}
      {% set hour = now().hour %}
      {% set minute = now().minute %}
      {% set time_decimal = hour + (minute / 60.0) %}
      {% set naptime = time_decimal >= 12.25 and time_decimal < 16 %}
      {% set pre_bedtime = time_decimal >= 18 and time_decimal < 18.75 %}
      {% set bedtime = time_decimal >= 18.75 or time_decimal < 6 %}
      {% set preemptive_window = time_decimal >= 9 and time_decimal < 18 %}

      {% if occupancy == 'holiday' %}
      **ğŸ–ï¸ HOLIDAY MODE** - All HVAC off
      {% elif door_open %}
      **ğŸšª DOOR OPEN** - Climate off (Principle #5)
      {% elif manual %}
      **ğŸ”´ MANUAL CONTROL ACTIVE** - Automations paused
      {% elif occupancy == 'away' %}
      **ğŸ  AWAY MODE** - Eco preset
        {% if season == 'winter' and temp < 16 %}
      **â„ï¸ ECO HEATING** ({{ temp }}Â°C < 16Â°C)
        {% elif season == 'summer' and hot_day and temp > 24 %}
      **â˜€ï¸ ECO COOLING** ({{ temp }}Â°C > 24Â°C, hot day)
        {% else %}
      **âœ… COMFORTABLE** - No action
        {% endif %}
      {% elif bedtime %}
      **ğŸŒ™ BEDTIME/OVERNIGHT** (18:45-06:00)
        {% if season == 'winter' and temp < 18 %}
      **ğŸ”¥ BEDTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Target: 20Â°C
      - Solar: NOT required (Principle #4 exception)
        {% elif (warm_day or hot_day or super_hot_day) and temp > 22 %}
      **ğŸŒ¡ï¸ WARM NIGHT COOLING** ({{ temp }}Â°C > 22Â°C after warm/hot day)
      - Mode: Cool, Preset: Boost
      - Solar: NOT required (Principle #4 exception)
      - Triggered: 18:45 on warm/hot/super-hot days
        {% else %}
      **âœ… COMFORTABLE** ({{ temp }}Â°C)
        {% endif %}
      {% elif pre_bedtime %}
      **ğŸŒ… PRE-BEDTIME** (18:00-18:45)
        {% if season == 'winter' and temp < 18 %}
      **ğŸ”¥ PRE-BEDTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Solar: NOT required (Principle #4 exception)
        {% elif (warm_day or hot_day or super_hot_day) and temp > 22 %}
      **ğŸŒ¡ï¸ PRE-BEDTIME COOLING** ({{ temp }}Â°C > 22Â°C, warm/hot day)
      - Mode: Cool, Preset: Comfort
      - Solar: NOT required (Principle #4 exception)
        {% else %}
      **âœ… COMFORTABLE**
        {% endif %}
      {% elif naptime %}
      **ğŸ˜´ NAPTIME** (12:15-16:00)
        {% if season == 'winter' and temp < 18 %}
      **ğŸ”¥ NAPTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Solar: NOT required (Principle #4 exception for naptime)
        {% elif (hot_day or super_hot_day) and temp > 22 %}
      **ğŸŒ¡ï¸ NAPTIME COOLING** ({{ temp }}Â°C > 22Â°C, hot day)
      - Mode: Cool, Preset: Comfort
      - Solar: NOT required (Principle #4 exception for naptime)
        {% else %}
      **âœ… COMFORTABLE**
        {% endif %}
      {% elif season == 'summer' %}
      **â˜€ï¸ SUMMER MODE**
        {% if super_hot_day and preemptive_window and temp > 22 %}
      **ğŸ”¥ PREEMPTIVE COOLING** (Super hot, {{ temp }}Â°C > 22Â°C)
      - Window: 09:00-18:00 (Principle #7)
      - Mode: Cool, Preset: Comfort
      - Solar: NOT required for super_hot preemptive
        {% elif hot_day and temp >= 24 %}
      **ğŸŒ¡ï¸ REACTIVE COOLING** (Hot day, {{ temp }}Â°C â‰¥ 24Â°C)
      - Mode: Cool, Preset: Comfort
      - Solar: Required (Principle #4)
          {% if not solar_excess %}
      - âš ï¸ BLOCKED: No solar excess
          {% endif %}
        {% else %}
      **âœ… COMFORTABLE** ({{ temp }}Â°C < 24Â°C)
        {% endif %}
      {% elif season == 'winter' %}
      **â„ï¸ WINTER MODE**
        {% if temp < 18 %}
      **ğŸ”¥ DAYTIME HEATING** ({{ temp }}Â°C < 18Â°C)
      - Mode: Heat, Preset: Comfort
      - Target: 20Â°C
      - Solar: Required (Principle #4)
          {% if not solar_excess %}
      - âš ï¸ BLOCKED: No solar excess
          {% endif %}
        {% else %}
      **âœ… WARM ENOUGH** ({{ temp }}Â°C â‰¥ 18Â°C)
        {% endif %}
      {% elif season == 'spring' or season == 'autumn' %}
      **ğŸ‚ SHOULDER SEASON ({{ season | title }})**
        {% if temp >= 26 %}
      **ğŸ”¥ HOT** - Cooling
        {% elif temp < 16 %}
      **â„ï¸ COLD** - Heating if naptime/bedtime
        {% else %}
      **âœ… COMFORTABLE**
        {% endif %}
      {% endif %}

      ### Automation Status
      {% set manager_last = state_attr('automation.hvac_kids_room_otto_versatile_climate_manager', 'last_triggered') %}
      {% set hot_night_last = state_attr('automation.bedrooms_overnight_ac_on_hot_days', 'last_triggered') %}

      **ğŸ¯ HVAC - Kids Room (Otto) Versatile Climate Manager**
      - Status: {{ 'âœ… ON' if is_state('automation.hvac_kids_room_otto_versatile_climate_manager', 'on') else 'ğŸ”´ OFF' }}
      {% if manager_last %}
      - Last triggered: {{ relative_time(manager_last) }} ago
      {% endif %}
      - Triggers: State-based (temp, door, solar, season, occupancy, flags) + Time-specific (naptime, pre-bedtime, bedtime, wake-up, preemptive windows)
      - Principle #10: No polling - fires only on state changes

      {% set warm_or_hot_day = warm_day or hot_day or super_hot_day %}
      {% if warm_or_hot_day %}
      **ğŸ”¥ Warm/Hot Night Cooling:** {{ 'âœ… ACTIVE' if hvac == 'cool' else 'Scheduled for 18:45' }}
      - Day flags: Warm={{ warm_day }}, Hot={{ hot_day }}, Super-hot={{ super_hot_day }}
      {% endif %}

      ---

  # System-Wide Automations
  - type: markdown
    title: "âš™ï¸ System-Wide Climate Automations"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #8B5CF6;
        }
    content: |
      ### Season Detection
      **Auto Detect Season:** {{ 'âœ… ON' if is_state('automation.climate_auto_detect_season', 'on') else 'ğŸ”´ OFF' }}
      - Runs: Daily at 04:30 AM + on startup
      - Current month: {{ now().month }} â†’ Season: {{ states('input_select.climate_season') }}
      {% set season_last = state_attr('automation.climate_auto_detect_season', 'last_triggered') %}
      {% if season_last %}
      - Last run: {{ relative_time(season_last) }} ago
      {% endif %}

      ### Hot Day Detection
      **Climate Flags - Mark Hot Day:** {{ 'âœ… ON' if is_state('automation.climate_flags_mark_hot_day', 'on') else 'ğŸ”´ OFF' }}
      - Runs: Daily at 04:30 AM
      - Max temp forecast: {{ states('sensor.braybrook_temp_max_0') }}Â°C
      - Sets warm_today_flag if >18Â°C, hot_today_flag if >21Â°C, super_hot_today if >25Â°C
      {% set flags_last = state_attr('automation.climate_flags_mark_hot_day', 'last_triggered') %}
      {% if flags_last %}
      - Last run: {{ relative_time(flags_last) }} ago
      {% endif %}

      ### Door State Tracking
      **Track Downstairs Door State:** {{ 'âœ… ON' if is_state('automation.climate_track_downstairs_door_state', 'on') else 'ğŸ”´ OFF' }}
      - Maintains helper boolean for downstairs doors
      {% set door_last = state_attr('automation.climate_track_downstairs_door_state', 'last_triggered') %}
      {% if door_last %}
      - Last run: {{ relative_time(door_last) }} ago
      {% endif %}

      ### Overnight Cooling on Hot Days
      **Bedrooms - Overnight AC on Hot Days:** {{ 'âœ… ON' if is_state('automation.bedrooms_overnight_ac_on_hot_days', 'on') else 'ğŸ”´ OFF' }}
      - Triggers: 18:45 (kids/study), 21:00 (master) when warm/hot/super-hot day
      - Condition: Day max temp >18Â°C (warm_today_flag, hot_today_flag, or super_hot_today)
      - Action: AC boost mode overnight for comfort
      {% set hot_night_last = state_attr('automation.bedrooms_overnight_ac_on_hot_days', 'last_triggered') %}
      {% if hot_night_last %}
      - Last run: {{ relative_time(hot_night_last) }} ago
      {% endif %}

      **Bedrooms - Turn Off Overnight AC in Morning:** {{ 'âœ… ON' if is_state('automation.bedrooms_turn_off_overnight_ac_in_morning', 'on') else 'ğŸ”´ OFF' }}
      - Triggers: 6:00am
      - Action: Turns off all bedroom ACs
      {% set hot_off_last = state_attr('automation.bedrooms_turn_off_overnight_ac_in_morning', 'last_triggered') %}
      {% if hot_off_last %}
      - Last run: {{ relative_time(hot_off_last) }} ago
      {% endif %}

      ---

  # Performance Metrics
  - type: markdown
    title: "ğŸ“Š Performance Metrics"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #10B981;
        }
    content: |
      ### Optimization Results (Principle #9 & #10)

      **Before:** Time-pattern polling every 15 minutes
      - 4 automations Ã— 4 runs/hour = 16 automation runs/hour
      - 96 runs/day (6am-10pm active period)
      - Many unnecessary thermostat beeps from redundant service calls

      **After:** State-based + time-specific triggers
      - Runs ONLY when relevant conditions change
      - State checks prevent redundant service calls (Principle #9)
      - Estimated 80-90% reduction in automation runs
      - Significantly fewer thermostat beeps

      **Trigger Types Now Used:**
      - **State-based:** Temperature, humidity, door sensors, solar excess, season, occupancy, flags, WFH
      - **Time-specific:** Bedtime windows, wake-up times, naptime, pre-bedtime, frost protection windows

      **Service Call Optimization:**
      - ALWAYS check current state before calling set_hvac_mode or set_preset_mode
      - Only send command if value needs to change
      - Prevents annoying beeps from redundant commands

      ---

  # Quick Actions
  - type: horizontal-stack
    cards:
      - type: button
        name: "Disable All Climate"
        icon: mdi:pause-circle
        tap_action:
          action: call-service
          service: input_boolean.turn_on
          target:
            entity_id:
              - input_boolean.climate_manual_control_master
              - input_boolean.climate_manual_control_living
              - input_boolean.climate_manual_control_otto
              - input_boolean.climate_manual_control_study
        card_mod:
          style: |
            ha-card {
              background: #EF4444;
              color: white;
            }
      - type: button
        name: "Enable All Climate"
        icon: mdi:play-circle
        tap_action:
          action: call-service
          service: input_boolean.turn_off
          target:
            entity_id:
              - input_boolean.climate_manual_control_master
              - input_boolean.climate_manual_control_living
              - input_boolean.climate_manual_control_otto
              - input_boolean.climate_manual_control_study
        card_mod:
          style: |
            ha-card {
              background: #10B981;
              color: white;
            }
      - type: button
        name: "View Helpers"
        icon: mdi:tune
        tap_action:
          action: navigate
          navigation_path: /config/helpers
        card_mod:
          style: |
            ha-card {
              background: #3B82F6;
              color: white;
            }
