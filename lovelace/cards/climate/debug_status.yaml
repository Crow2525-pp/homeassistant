# Climate System Debug & Status Card
type: vertical-stack
cards:
  # System Status Overview
  - type: markdown
    title: "üîç Climate System Debug Status"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #0F172A 0%, #1E293B 100%);
          border: 2px solid #3B82F6;
          border-radius: 12px;
        }
    content: |
      ## Current Season & Settings
      **Season:** {{ states('input_select.climate_season') | title }}
      **Month:** {{ now().strftime('%B') }} ({{ now().month }})

      ### Hot Day Flags
      - **Super Hot Today (>25¬∞C):** {{ 'YES üî•' if is_state('input_boolean.super_hot_today', 'on') else 'No' }}
      - **Hot Today (>21¬∞C):** {{ 'YES ‚òÄÔ∏è' if is_state('input_boolean.hot_today_flag', 'on') else 'No' }}
      - **Warm Today (>18¬∞C):** {{ 'YES üå§Ô∏è' if is_state('input_boolean.warm_today_flag', 'on') else 'No' }}
      - **Max Temp Forecast:** {{ states('sensor.braybrook_temp_max_0') }}¬∞C

      ---

  # System Control Panel
  - type: entities
    title: "üéõÔ∏è Climate System Controls"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-radius: 12px;
          border: 2px solid #F59E0B;
        }
    entities:
      - entity: input_select.climate_season
        name: "Season"
        icon: mdi:weather-partly-cloudy
      - entity: input_select.occupancy
        name: "Occupancy Mode"
        icon: mdi:home-account
      - type: divider
      - entity: input_boolean.super_hot_today
        name: "Super Hot Day Flag (>25¬∞C)"
        icon: mdi:weather-sunny-alert
      - entity: input_boolean.hot_today_flag
        name: "Hot Day Flag (>21¬∞C)"
        icon: mdi:weather-sunny
      - entity: input_boolean.warm_today_flag
        name: "Warm Day Flag (>18¬∞C)"
        icon: mdi:weather-partly-sunny
      - type: divider
      - entity: zone.home
        name: "People at Home"
        icon: mdi:account-group

  # Master Bedroom Status
  - type: markdown
    title: "üõèÔ∏è Master Bedroom Status"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #3B82F6;
        }
    content: |
      ### Climate State
      **HVAC Mode:** {{ states('climate.masterbed_versatile_thermostat') | upper }}
      **Preset Mode:** {{ state_attr('climate.masterbed_versatile_thermostat', 'preset_mode') | default('none') | title }}
      - Available: {{ state_attr('climate.masterbed_versatile_thermostat', 'preset_modes') | join(', ') }}
      **Target Temp:** {{ state_attr('climate.masterbed_versatile_thermostat', 'temperature') }}¬∞C
      **Current Temp:** {{ states('sensor.ble_temperature_masterbed_temp_humidity_sensor') }}¬∞C
      **Humidity:** {{ states('sensor.ble_humidity_masterbed_temp_humidity_sensor') }}%
      **Fan:** {{ states('fan.masterbedroom_fan') | title }}
      {% if not is_state('fan.masterbedroom_fan', 'off') %}
      **Fan Speed:** {{ state_attr('fan.masterbedroom_fan', 'percentage') }}%
      {% endif %}

      ### Blind Status
      **Roller Blinds:** {{ state_attr('cover.roller_blinds_chan1', 'current_position') | int }}% open
      **Curtains:** {{ states('cover.curtain_3_b3bb') | title }}
      **Balcony Door:** {{ 'OPEN üö™' if is_state('binary_sensor.balcony_door_sensor_magnet_opening_2', 'on') else 'Closed' }}
      **Bedroom Door:** {{ 'OPEN üö™' if is_state('binary_sensor.master_bedroom_door_sensor_opening', 'on') else 'Closed' }}

      ### Manual Overrides
      **Climate Manual Control:** {{ 'üî¥ ACTIVE - Automations Paused' if is_state('input_boolean.climate_manual_control_master', 'on') else '‚úÖ Off - Automations Active' }}
      **Blind Manual Control:** {{ 'üî¥ ACTIVE - Blind automations paused' if is_state('input_boolean.blind_manual_control', 'on') else '‚úÖ Off - Blind automations active' }}

      ### Why Current State?
      {% set temp = states('sensor.ble_temperature_masterbed_temp_humidity_sensor') | float %}
      {% set humidity = states('sensor.ble_humidity_masterbed_temp_humidity_sensor') | float %}
      {% set season = states('input_select.climate_season') %}
      {% set hvac = states('climate.masterbed_versatile_thermostat') %}
      {% set door_open = is_state('binary_sensor.master_bedroom_door_sensor_opening', 'on') %}
      {% set climate_manual = is_state('input_boolean.climate_manual_control_master', 'on') %}
      {% set blind_manual = is_state('input_boolean.blind_manual_control', 'on') %}
      {% set hot_day = is_state('input_boolean.hot_today_flag', 'on') or is_state('input_boolean.super_hot_today', 'on') %}
      {% set wfh = is_state('binary_sensor.working_from_home', 'on') %}
      {% set solar_excess = is_state('binary_sensor.solar_excess_available', 'on') %}

      {% if door_open %}
      **üö™ DOOR OPEN** - All climate/blinds turned off (save energy)
      {% elif climate_manual %}
      **üî¥ MANUAL CONTROL ACTIVE** - User has manually changed climate, automations paused for 4 hours
      {% elif season == 'summer' %}
        {% if hot_day %}
      **‚òÄÔ∏è HOT DAY MODE (Summer)** - Blinds closed all day to block north-facing sun
          {% if temp > 26 %}
      **üî• VERY HOT** ({{ temp }}¬∞C > 26¬∞C) - Aggressive cooling:
      - Blinds: Closed
      - Fan: 66% (high speed)
            {% if hvac == 'cool' and solar_excess %}
      - AC: ON (using solar excess)
            {% elif not solar_excess %}
      - AC: OFF (no solar excess available)
            {% endif %}
          {% elif temp > 24 %}
      **üå°Ô∏è HOT** ({{ temp }}¬∞C > 24¬∞C) - Moderate cooling:
      - Blinds: Closed
      - Fan: 33% (medium speed)
            {% if hvac == 'cool' and solar_excess %}
      - AC: ON (using solar excess)
            {% endif %}
          {% else %}
      **‚úÖ COMFORTABLE** ({{ temp }}¬∞C < 24¬∞C) - Fan only for circulation
          {% endif %}
        {% else %}
      **üå§Ô∏è COOL DAY (Summer)** - Normal day, dynamic blind management
          {% if temp > 26 %}
      **üî• UNEXPECTEDLY HOT** - Activating aggressive cooling
          {% elif temp > 24 %}
      **üå°Ô∏è WARM** - Closing blinds and moderate fan
          {% elif humidity > 20 %}
      **üíß HIGH HUMIDITY** ({{ humidity }}%) - Running ventilation
          {% else %}
      **‚úÖ COMFORTABLE** - Minimal intervention
          {% endif %}
        {% endif %}
      {% elif season == 'winter' %}
      **‚ùÑÔ∏è WINTER MODE**
        {% if temp < 18 %}
          {% if now().hour >= 9 and now().hour < 20 %}
            {% if wfh or now().hour >= 17 %}
      **üî• HEATING** ({{ temp }}¬∞C < 18¬∞C) - Winter day heating active:
      - Blinds: Open for solar gain
      - Fan: Off
      - AC: Heat mode to 20¬∞C
            {% else %}
      **üíº NOT WFH** - Heating skipped during day (9am-5pm) to save energy
            {% endif %}
          {% else %}
      **üåô NIGHT** - See "Heater Night Assist" automation for overnight heating
          {% endif %}
        {% else %}
      **‚úÖ WARM ENOUGH** ({{ temp }}¬∞C ‚â• 18¬∞C) - No heating needed
        {% endif %}
      {% elif season == 'spring' or season == 'autumn' %}
      **üçÇ SHOULDER SEASON ({{ season | title }})** - Minimal intervention
        {% if temp > 26 %}
      **üî• HOT** ({{ temp }}¬∞C > 26¬∞C) - Cooling:
      - Blinds: Closed
      - Fan: 33%
        {% elif temp < 16 %}
      **‚ùÑÔ∏è COLD** ({{ temp }}¬∞C < 16¬∞C) - Heating if nighttime
        {% else %}
      **‚úÖ COMFORTABLE** (16-26¬∞C) - Natural ventilation, no HVAC
        {% endif %}
      {% endif %}

      ### Active Automations
      {% set seasonal_last = state_attr('automation.master_bedroom_seasonal_climate_manager', 'last_triggered') %}
      {% set heater_night_last = state_attr('automation.master_bedroom_heater_night_assist', 'last_triggered') %}
      {% set wake_last = state_attr('automation.master_bedroom_turn_off_ac_on_wake', 'last_triggered') %}
      {% set fan_ac_last = state_attr('automation.master_bedroom_fan_on_when_ac_starts', 'last_triggered') %}
      {% set notification_last = state_attr('automation.smart_climate_notification_master_bedroom', 'last_triggered') %}

      - **Seasonal Climate Manager:** {{ '‚úÖ ON' if is_state('automation.master_bedroom_seasonal_climate_manager', 'on') else 'üî¥ OFF' }}
        {% if seasonal_last %}
        - Last run: {{ relative_time(seasonal_last) }} ago
        {% endif %}
      - **Heater Night Assist:** {{ '‚úÖ ON' if is_state('automation.master_bedroom_heater_night_assist', 'on') else 'üî¥ OFF' }}
        - Active: 18:00-06:00 in winter
        {% if heater_night_last %}
        - Last run: {{ relative_time(heater_night_last) }} ago
        {% endif %}
      - **Turn Off AC on Wake:** {{ '‚úÖ ON' if is_state('automation.master_bedroom_turn_off_ac_on_wake', 'on') else 'üî¥ OFF' }}
        - Active: 06:00-09:00 on wake sensors
        {% if wake_last %}
        - Last run: {{ relative_time(wake_last) }} ago
        {% endif %}
      - **Fan On When AC Starts:** {{ '‚úÖ ON' if is_state('automation.master_bedroom_fan_on_when_ac_starts', 'on') else 'üî¥ OFF' }}
        {% if fan_ac_last %}
        - Last run: {{ relative_time(fan_ac_last) }} ago
        {% endif %}
      - **Smart Climate Notification:** {{ '‚úÖ ON' if is_state('automation.smart_climate_notification_master_bedroom', 'on') else 'üî¥ OFF' }}
        {% if notification_last %}
        - Last notification: {{ relative_time(notification_last) }} ago
        {% endif %}
      {% set cooling_night_last = state_attr('automation.master_bedroom_cooling_night_assist', 'last_triggered') %}
      - **Cooling Night Assist:** {{ '‚úÖ ON' if is_state('automation.master_bedroom_cooling_night_assist', 'on') else 'üî¥ OFF' }}
        - Active: 20:00-06:00 in summer
        {% if cooling_night_last %}
        - Last run: {{ relative_time(cooling_night_last) }} ago
        {% endif %}

      {% set hot_night_last = state_attr('automation.bedrooms_overnight_ac_on_hot_days', 'last_triggered') %}
      - **üî• Warm/Hot Night Bedroom Cooling:** {{ '‚úÖ ON' if is_state('automation.bedrooms_overnight_ac_on_hot_days', 'on') else 'üî¥ OFF' }}
        - Triggers: 9:00pm when day was >18¬∞C (warm/hot/super hot)
        - Mode: Boost cooling for comfort
        - Auto-off: 6:00am next morning
        {% if hot_night_last %}
        - Last run: {{ relative_time(hot_night_last) }} ago
        {% endif %}

      ---

  # Living Room Status
  - type: markdown
    title: "üõãÔ∏è Living Room Status"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #EC4899;
        }
    content: |
      ### Climate State
      **HVAC Mode:** {{ states('climate.living_room_versatile_thermostat') | upper }}
      **Preset Mode:** {{ state_attr('climate.living_room_versatile_thermostat', 'preset_mode') | default('none') | title }}
      - Available: {{ state_attr('climate.living_room_versatile_thermostat', 'preset_modes') | join(', ') }}
      **Target Temp:** {{ state_attr('climate.living_room_versatile_thermostat', 'temperature') }}¬∞C
      **Current Temp:** {{ states('sensor.living_room_temperature_offset') }}¬∞C
      **Kitchen Temp:** {{ states('sensor.ble_temperature_kitchen_temp_humidity_sensor') }}¬∞C

      ### Door Status
      **Living Room Door:** {{ 'OPEN üö™' if is_state('binary_sensor.living_room_door_sensor_opening', 'on') else 'Closed' }}
      **Garage Door:** {{ 'OPEN üö™' if is_state('binary_sensor.interior_garage_door_sensor_magnet_opening', 'on') else 'Closed' }}
      **Downstairs Doors:** {{ 'OPEN üö™' if is_state('binary_sensor.downstairs_doors', 'on') else 'All Closed' }}

      ### Manual Override
      **Climate Manual Control:** {{ 'üî¥ ACTIVE - Automations Paused' if is_state('input_boolean.climate_manual_control_living', 'on') else '‚úÖ Off - Automations Active' }}

      ### Why Current State?
      {% set temp = states('sensor.living_room_temperature_offset') | float %}
      {% set kitchen_temp = states('sensor.ble_temperature_kitchen_temp_humidity_sensor') | float %}
      {% set season = states('input_select.climate_season') %}
      {% set hvac = states('climate.living_room_ac') %}
      {% set manual = is_state('input_boolean.climate_manual_control_living', 'on') %}
      {% set hour = now().hour %}

      {% if manual %}
      **üî¥ MANUAL CONTROL ACTIVE** - User has manually changed climate, automations paused for 4 hours
      {% elif season == 'summer' %}
      **‚òÄÔ∏è SUMMER MODE**
        {% if temp > 28 %}
      **üî• VERY HOT** ({{ temp }}¬∞C > 28¬∞C) - AC cooling if available
        {% else %}
      **‚úÖ COMFORTABLE** - Natural ventilation, no HVAC needed
        {% endif %}
      {% elif season == 'winter' %}
      **‚ùÑÔ∏è WINTER MODE**
        {% if hour >= 5 and hour < 9 %}
          {% if temp < 19 or kitchen_temp < 19 %}
      **‚òï MORNING PREHEAT** (05:30-09:00)
      - Current: {{ temp }}¬∞C (threshold: 19¬∞C)
      - Kitchen: {{ kitchen_temp }}¬∞C (threshold: 19¬∞C)
      - Mode: Comfort heating
      - Fan: Highest
      - Target: Warm before family wakes
          {% else %}
      **‚úÖ WARM ENOUGH** - Preheat not needed (>19¬∞C)
          {% endif %}
        {% elif hour >= 9 and hour < 22 %}
          {% if hvac == 'heat' %}
      **üî• DAY HEATING** - Maintaining 20¬∞C comfort
          {% else %}
      **‚úÖ COMFORTABLE** - No heating needed
          {% endif %}
        {% elif hour >= 22 or hour < 5 %}
          {% if temp < 14.5 %}
      **üåô NIGHT ECO HEATING** ({{ temp }}¬∞C < 14.5¬∞C)
      - Mode: Eco (energy saving)
      - Target: Prevent cold overnight
          {% elif temp > 16 %}
      **‚úÖ NIGHT - WARM** ({{ temp }}¬∞C > 16¬∞C) - Heater off
          {% else %}
      **üåô NIGHT** (14.5-16¬∞C) - Monitoring temperature
          {% endif %}
        {% endif %}
      {% elif season == 'spring' or season == 'autumn' %}
      **üçÇ SHOULDER SEASON ({{ season | title }})** - Minimal HVAC
        {% if temp > 28 %}
      **üî• UNUSUALLY HOT** - Cooling may activate
        {% elif temp < 17 %}
      **‚ùÑÔ∏è COLD MORNING** - Light preheat if needed
        {% else %}
      **‚úÖ COMFORTABLE** - Natural ventilation
        {% endif %}
      {% endif %}

      ### Active Automations
      {% set preheat_last = state_attr('automation.living_room_preheat_at_5_30_am_if_cold', 'last_triggered') %}
      {% set turn_off_last = state_attr('automation.living_room_turn_off_heater_when_warm', 'last_triggered') %}
      {% set overnight_last = state_attr('automation.living_room_heater_off_overnight', 'last_triggered') %}
      {% set setback_last = state_attr('automation.living_room_night_temperature_setback', 'last_triggered') %}
      {% set notification_last = state_attr('automation.smart_climate_notification_living_room', 'last_triggered') %}

      - **Preheat at 5:30 AM:** {{ '‚úÖ ON' if is_state('automation.living_room_preheat_at_5_30_am_if_cold', 'on') else 'üî¥ OFF' }}
        - Active: 05:30 if temp <19¬∞C (winter)
        {% if preheat_last %}
        - Last run: {{ relative_time(preheat_last) }} ago
        {% endif %}
      - **Turn Off When Warm:** {{ '‚úÖ ON' if is_state('automation.living_room_turn_off_heater_when_warm', 'on') else 'üî¥ OFF' }}
        - Active: 06:00-07:30 if temp >20¬∞C (winter mornings)
        {% if turn_off_last %}
        - Last run: {{ relative_time(turn_off_last) }} ago
        {% endif %}
      - **Heater Off Overnight:** {{ '‚úÖ ON' if is_state('automation.living_room_heater_off_overnight', 'on') else 'üî¥ OFF' }}
        - Active: 20:30-01:00 on sleep sensors
        {% if overnight_last %}
        - Last run: {{ relative_time(overnight_last) }} ago
        {% endif %}
      - **Night Temperature Setback:** {{ '‚úÖ ON' if is_state('automation.living_room_night_temperature_setback', 'on') else 'üî¥ OFF' }}
        - Active: 22:00-05:00 if temp <14.5¬∞C or >16¬∞C
        {% if setback_last %}
        - Last run: {{ relative_time(setback_last) }} ago
        {% endif %}
      - **Smart Climate Notification:** {{ '‚úÖ ON' if is_state('automation.smart_climate_notification_living_room', 'on') else 'üî¥ OFF' }}
        {% if notification_last %}
        - Last notification: {{ relative_time(notification_last) }} ago
        {% endif %}

      ---

  # Children's Rooms Status
  - type: markdown
    title: "üë∂ Children's Rooms Status"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #F59E0B;
        }
    content: |
      ### Otto's Room
      **HVAC Mode:** {{ states('climate.otto_s_room') | upper }}
      **Preset Mode:** {{ state_attr('climate.otto_s_room', 'preset_mode') | default('none') | title }}
      - Available: {{ state_attr('climate.otto_s_room', 'preset_modes') | join(', ') }}
      **Target Temp:** {{ state_attr('climate.otto_s_room', 'temperature') }}¬∞C
      **Current Temp:** {{ states('sensor.ottos_room_temp_humidity_sensor_temperature') }}¬∞C
      **Door:** {{ 'OPEN üö™' if is_state('binary_sensor.otto_room_door_sensor_opening', 'on') else 'Closed' }}
      **Manual Override:** {{ 'üî¥ ACTIVE' if is_state('input_boolean.climate_manual_control_otto', 'on') else '‚úÖ Off' }}

      **Why this state?**
      {% set temp = states('sensor.ottos_room_temp_humidity_sensor_temperature') | float %}
      {% set hvac = states('climate.otto_s_room') %}
      {% set hour = now().hour %}
      {% set season = states('input_select.climate_season') %}
      {% if season == 'winter' and hour >= 18 or hour < 6 %}
        {% if temp < 18.5 %}
      **üåô NIGHT HEATING** ({{ temp }}¬∞C < 18.5¬∞C)
      - Target: 18.5-19.5¬∞C comfort range
      - Mode: Eco heating
      - Active: 18:00-06:00
        {% elif temp > 19.5 %}
      **‚úÖ WARM** ({{ temp }}¬∞C > 19.5¬∞C) - Heater off
        {% else %}
      **‚úÖ COMFORTABLE** (18.5-19.5¬∞C) - Maintaining range
        {% endif %}
      {% else %}
      **‚òÄÔ∏è DAYTIME** - No heating needed (kids not in room)
      {% endif %}

      **Heater Night Routine:** {{ '‚úÖ ON' if is_state('automation.otto_s_room_heater_night_routine', 'on') else 'üî¥ OFF' }}
      **Cooling Night Routine:** {{ '‚úÖ ON' if is_state('automation.otto_s_room_cooling_night_routine', 'on') else 'üî¥ OFF' }}
      - Active: 18:00-06:00 in summer

      {% set warm_or_hot_day = is_state('input_boolean.warm_today_flag', 'on') or is_state('input_boolean.hot_today_flag', 'on') or is_state('input_boolean.super_hot_today', 'on') %}
      {% if warm_or_hot_day %}
      **üî• WARM/HOT NIGHT COOLING:** {{ '‚úÖ ACTIVE' if hvac == 'cool' else 'Scheduled' }}
      - Triggers at 6:45pm when day >18¬∞C
      - Mode: Boost cooling overnight
      - Auto-off at 6:00am
      {% endif %}

      ---

      ### Henry's Room / Study
      **HVAC Mode:** {{ states('climate.henry_s_room_versatile_thermostat') | upper }}
      **Preset Mode:** {{ state_attr('climate.henry_s_room_versatile_thermostat', 'preset_mode') | default('none') | title }}
      - Available: {{ state_attr('climate.henry_s_room_versatile_thermostat', 'preset_modes') | join(', ') }}
      **Target Temp:** {{ state_attr('climate.henry_s_room_versatile_thermostat', 'temperature') }}¬∞C
      **Current Temp:** {{ states('sensor.study_esp32_henrysroom_temperature') }}¬∞C
      **Door:** {{ 'OPEN üö™' if is_state('binary_sensor.henry_door_sensor_magnet_opening', 'on') else 'Closed' }}
      **Manual Override:** {{ 'üî¥ ACTIVE' if is_state('input_boolean.climate_manual_control_study', 'on') else '‚úÖ Off' }}

      **Why this state?**
      {% set temp = states('sensor.study_esp32_henrysroom_temperature') | float %}
      {% set hvac = states('climate.henry_s_room_versatile_thermostat') %}
      {% set hour = now().hour %}
      {% set season = states('input_select.climate_season') %}
      {% if season == 'winter' and hour >= 18 or hour < 6 %}
        {% if temp < 19.7 %}
      **üåô NIGHT HEATING** ({{ temp }}¬∞C < 19.7¬∞C)
      - Target: 19.7-20.1¬∞C comfort range
      - Mode: Eco heating
      - Active: 18:00-06:00
        {% elif temp > 20.1 %}
      **‚úÖ WARM** ({{ temp }}¬∞C > 20.1¬∞C) - Heater off
        {% else %}
      **‚úÖ COMFORTABLE** (19.7-20.1¬∞C) - Maintaining range
        {% endif %}
      {% else %}
      **‚òÄÔ∏è DAYTIME** - No heating needed
      {% endif %}

      **Heater Night Routine:** {{ '‚úÖ ON' if is_state('automation.henry_s_room_heater_night_routine', 'on') else 'üî¥ OFF' }}
      **Cooling Night Routine:** {{ '‚úÖ ON' if is_state('automation.henry_s_room_cooling_night_routine', 'on') else 'üî¥ OFF' }}
      - Active: 18:00-06:00 in summer

      {% set warm_or_hot_day = is_state('input_boolean.warm_today_flag', 'on') or is_state('input_boolean.hot_today_flag', 'on') or is_state('input_boolean.super_hot_today', 'on') %}
      {% if warm_or_hot_day %}
      **üî• WARM/HOT NIGHT COOLING:** {{ '‚úÖ ACTIVE' if hvac == 'cool' else 'Scheduled' }}
      - Triggers at 6:45pm when day >18¬∞C
      - Mode: Boost cooling overnight
      - Auto-off at 6:00am
      {% endif %}

      ---

  # Temperature Thresholds Reference
  - type: markdown
    title: "üéØ Temperature Thresholds (Configurable)"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #10B981;
        }
    content: |
      ### Master Bedroom
      - **Summer Cooling:** {{ states('input_number.master_bedroom_temp_summer_cool') }}¬∞C
      - **Winter Heating:** {{ states('input_number.master_bedroom_temp_winter_heat') }}¬∞C
      - **Comfort Range:** {{ states('input_number.master_bedroom_temp_comfort_low') }}¬∞C - {{ states('input_number.master_bedroom_temp_comfort_high') }}¬∞C

      ### Living Room
      - **Summer Cooling:** {{ states('input_number.living_room_temp_summer_cool') }}¬∞C
      - **Winter Heating:** {{ states('input_number.living_room_temp_winter_heat') }}¬∞C
      - **Winter Morning:** {{ states('input_number.living_room_temp_winter_morning') }}¬∞C
      - **Comfort Target:** {{ states('input_number.living_room_temp_comfort') }}¬∞C

      üí° *Adjust these in Settings > Helpers to change when climate activates*

      ---

  # System-Wide Automations
  - type: markdown
    title: "‚öôÔ∏è System-Wide Climate Automations"
    card_mod:
      style: |
        ha-card {
          background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
          border-left: 4px solid #8B5CF6;
        }
    content: |
      ### Season Detection
      **Auto Detect Season:** {{ '‚úÖ ON' if is_state('automation.climate_auto_detect_season', 'on') else 'üî¥ OFF' }}
      - Runs: Daily at 04:30 AM + on startup
      - Current month: {{ now().month }} ‚Üí Season: {{ states('input_select.climate_season') }}
      {% set season_last = state_attr('automation.climate_auto_detect_season', 'last_triggered') %}
      {% if season_last %}
      - Last run: {{ relative_time(season_last) }} ago
      {% endif %}

      ### Hot Day Detection
      **Climate Flags - Mark Hot Day:** {{ '‚úÖ ON' if is_state('automation.climate_flags_mark_hot_day', 'on') else 'üî¥ OFF' }}
      - Runs: Daily at 04:30 AM
      - Max temp forecast: {{ states('sensor.braybrook_temp_max_0') }}¬∞C
      - Sets warm_today_flag if >18¬∞C, hot_today_flag if >21¬∞C, super_hot_today if >25¬∞C
      {% set flags_last = state_attr('automation.climate_flags_mark_hot_day', 'last_triggered') %}
      {% if flags_last %}
      - Last run: {{ relative_time(flags_last) }} ago
      {% endif %}

      ### Door State Tracking
      **Track Downstairs Door State:** {{ '‚úÖ ON' if is_state('automation.climate_track_downstairs_door_state', 'on') else 'üî¥ OFF' }}
      - Maintains helper boolean for downstairs doors
      {% set door_last = state_attr('automation.climate_track_downstairs_door_state', 'last_triggered') %}
      {% if door_last %}
      - Last run: {{ relative_time(door_last) }} ago
      {% endif %}

      ### Overnight Cooling on Hot Days
      **Bedrooms - Overnight AC on Hot Days:** {{ '‚úÖ ON' if is_state('automation.bedrooms_overnight_ac_on_hot_days', 'on') else 'üî¥ OFF' }}
      - Triggers: 6:45pm (kids), 9:00pm (master) when warm/hot day
      - Condition: Day max temp >18¬∞C (warm_today_flag, hot_today_flag, or super_hot_today)
      - Action: AC boost mode overnight for comfort
      {% set hot_night_last = state_attr('automation.bedrooms_overnight_ac_on_hot_days', 'last_triggered') %}
      {% if hot_night_last %}
      - Last run: {{ relative_time(hot_night_last) }} ago
      {% endif %}

      **Bedrooms - Turn Off Overnight AC in Morning:** {{ '‚úÖ ON' if is_state('automation.bedrooms_turn_off_overnight_ac_in_morning', 'on') else 'üî¥ OFF' }}
      - Triggers: 6:00am
      - Action: Turns off all bedroom ACs
      {% set hot_off_last = state_attr('automation.bedrooms_turn_off_overnight_ac_in_morning', 'last_triggered') %}
      {% if hot_off_last %}
      - Last run: {{ relative_time(hot_off_last) }} ago
      {% endif %}

      ---

  # Quick Actions
  - type: horizontal-stack
    cards:
      - type: button
        name: "Disable All Climate"
        icon: mdi:pause-circle
        tap_action:
          action: call-service
          service: input_boolean.turn_on
          target:
            entity_id:
              - input_boolean.climate_manual_control_master
              - input_boolean.climate_manual_control_living
              - input_boolean.climate_manual_control_otto
              - input_boolean.climate_manual_control_study
        card_mod:
          style: |
            ha-card {
              background: #EF4444;
              color: white;
            }
      - type: button
        name: "Enable All Climate"
        icon: mdi:play-circle
        tap_action:
          action: call-service
          service: input_boolean.turn_off
          target:
            entity_id:
              - input_boolean.climate_manual_control_master
              - input_boolean.climate_manual_control_living
              - input_boolean.climate_manual_control_otto
              - input_boolean.climate_manual_control_study
        card_mod:
          style: |
            ha-card {
              background: #10B981;
              color: white;
            }
      - type: button
        name: "View Helpers"
        icon: mdi:tune
        tap_action:
          action: navigate
          navigation_path: /config/helpers
        card_mod:
          style: |
            ha-card {
              background: #3B82F6;
              color: white;
            }
