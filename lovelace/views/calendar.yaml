# Calendar
title: Calendar
path: calendar
icon: mdi:calendar
badges: !include ../badges/standard.yaml
cards:
  - !include ../cards/navbar.yaml
  # Top row - Today's info in a grid
  - type: grid
    columns: 2
    cards:
      - !include ../cards/calendar/today_agenda.yaml
      - type: vertical-stack
        cards:
          - !include ../cards/calendar/quick_actions.yaml
          - !include ../cards/calendar/family_presence.yaml

  # Full width week planner
  - !include ../cards/calendar/week_planner.yaml

  # Work location stats - Calendar view
  - type: custom:button-card
    entity: sensor.work_calendar_this_week
    name: Work Schedule
    icon: mdi:calendar-week
    show_state: false
    show_label: true
    label: >
      WFH: [[[ return states['sensor.wfh_days_count']; ]]] days (4w) |
      WFO: [[[ return states['sensor.office_days_count']; ]]] days (4w)
    state_display: >
      [[[
        return states['sensor.work_calendar_this_week']?.attributes?.week_summary || 'Loading...';
      ]]]
    custom_fields:
      summary: >
        [[[
          return `<div style="text-align: center; padding: 10px; font-size: 12px;">
            ${states['sensor.wfh_days_count'] || '0'} WFH |
            ${states['sensor.office_days_count'] || '0'} WFO |
            ${states['sensor.total_work_days_count'] || '0'} Total (Last 4 weeks)
          </div>`;
        ]]]
    layout: icon_state
    tap_action:
      action: navigate
      navigation_path: calendar
    styles:
      card:
        - border-radius: 8px
        - box-shadow: 0 2px 4px rgba(0,0,0,0.1)

  # Work location stats - Last 4 weeks
  - type: grid
    columns: 3
    cards:
      - type: entity
        entity: sensor.wfh_days_count
        name: WFH Days (4 weeks)
        icon: mdi:home-account
      - type: entity
        entity: sensor.office_days_count
        name: Office Days (4 weeks)
        icon: mdi:office-building
      - type: entity
        entity: sensor.total_work_days_count
        name: Total Work Days (4 weeks)
        icon: mdi:calendar-check

  # Work location stats - Tax year
  - type: grid
    columns: 2
    cards:
      - type: entity
        entity: sensor.wfh_days_financial_year_count
        name: WFH Days (FY 2024-25)
        icon: mdi:home-account
      - type: entity
        entity: sensor.office_days_financial_year_count
        name: Office Days (FY 2024-25)
        icon: mdi:office-building

  # Work location status - Debug & Diagnostics (Text View)
  - type: markdown
    title: "üîç Office Status Debug"
    content: |
      **Working at Office:** `{{ states('binary_sensor.working_at_office') }}`

      **Why:** {{ state_attr('binary_sensor.working_at_office', 'time_window_reason') }}

      **Current Time:** {{ state_attr('binary_sensor.working_at_office', 'current_time') }}

      **Conditions:**
      - Weekday: {{ state_attr('binary_sensor.working_at_office', 'is_weekday') }}
      - Work Hours (8am-5pm): {{ state_attr('binary_sensor.working_at_office', 'is_work_hours') }}
      - At Work Zone: {{ state_attr('binary_sensor.working_at_office', 'person_at_work') }}
      - Location: {{ state_attr('binary_sensor.working_at_office', 'person_location') }}

      **Tracking Data:**
      - Hours Last 4 Weeks: {{ states('sensor.office_days_last_4_weeks') }}
      - Days Last 4 Weeks: {{ states('sensor.office_days_count') }}

  - type: markdown
    title: "üè† WFH Status Debug"
    content: |
      **Working From Home:** `{{ states('binary_sensor.working_from_home') }}`

      **Conditions:**
      - Weekday: {{ state_attr('binary_sensor.working_from_home', 'is_weekday') }}
      - Work Hours (8am-5pm): {{ state_attr('binary_sensor.working_from_home', 'is_work_hours') }}
      - Desk Switch On: {{ state_attr('binary_sensor.working_from_home', 'desk_switch_on') }}
      - Computer Online: {{ state_attr('binary_sensor.working_from_home', 'computer_online') }}

      **Equipment State:**
      - Desk Switch: {{ states('switch.computer_plug_switch') }}
      - Computer Tracker: {{ states('device_tracker.aolt002068_3') }}

  # Work from home history
  - type: history-graph
    title: Phil's Work Location - Last 4 Weeks
    hours_to_show: 672
    entities:
      - entity: binary_sensor.working_from_home
        name: Working From Home
      - entity: binary_sensor.working_at_office
        name: Working at Office
