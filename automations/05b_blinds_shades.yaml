---
- id: '1644402690423'
  alias: Master Bedroom - Close Blinds for Night Mode
  description: Closes the master bedroom roller blinds at 21:30 when manual control
    is disabled. Curtain step paused 2025-10-17 while the Matter cover is offline.
  trigger:
  - platform: time
    at: '21:30:00'
  condition:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: cover.roller_blinds_chan1
      state: open
  action:
  - action: cover.close_cover
    metadata: {}
    data: {}
    target:
      entity_id:
      - cover.roller_blinds_chan1
  mode: single
- id: '1644437526740'
  alias: Master Bedroom - Open Blinds for Morning Routine
  description: Opens master bedroom roller blinds to 50% at 8am on weekdays when working
    from home and manual control is off. Curtains step removed 2025-10-17 while the
    Matter cover is offline. Only blocks on super hot days.
  triggers:
  - at: 08:00:00
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: binary_sensor.working_from_home
    state: 'on'
  - condition: state
    entity_id: input_boolean.super_hot_today
    state: 'off'
  actions:
  - action: script.1693262268843
    metadata: {}
    data: {}
  mode: single
- id: '1682548783368'
  alias: Master Bedroom - Raise Blinds When Windy
  description: Raises the roller blinds when wind speed exceeds 40 and manual control
    is off.
  trigger:
  - platform: template
    value_template: '{{ state_attr(''weather.home'', ''wind_speed'') > 40}}'
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  action:
  - variables:
      original_position: '{{ states(''cover.roller_blinds_chan1'') }}'
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.roller_blinds_chan1
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: 'Safety alert: high winds'
      message: Roller blinds up
  - wait_for_trigger:
    - platform: template
      value_template: '{{ state_attr(''weather.home'', ''wind_speed'') < 25 }}'
    continue_on_timeout: false
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: Wind speed reduced
      message: Blinds can go back down
  - action: "{% if original_position == 'closed' %}\n  cover.close_cover\n{% elif
      original_position == 'open' %}\n  cover.open_cover\n{% else %}\n  cover.stop_cover\n{%
      endif %}\n"
    target:
      entity_id: cover.roller_blinds_chan1
    alias: Restore Blinds to Previous Position
  mode: single
- id: '1723799786022'
  alias: Master Bedroom - Close Blinds When Hot
  description: Closes bedroom roller blinds with escalating responses based on indoor
    heat. Curtain step paused 2025-10-17 while the Matter cover is offline.
  triggers:
  - at: input_datetime.wakeup_time_phil_steph
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.super_hot_today
        state: 'on'
      sequence:
      - action: cover.close_cover
        metadata: {}
        data: {}
        target:
          entity_id:
          - cover.roller_blinds_chan1
      alias: Super Hot - Close Everything
    default:
    - action: cover.open_cover
      metadata: {}
      data: {}
      target:
        entity_id:
        - cover.roller_blinds_chan1
    alias: Not Super Hot - Open Blinds and Curtains
  mode: single
- id: '1749869631608'
  alias: Curtains - Cover Control Automation
  description: Coordinates cover control automation behaviour for the curtain group.
  use_blueprint:
    path: hvorragend/cover_control_automation.yaml
    input:
      auto_options:
      - auto_up_enabled
      - auto_down_enabled
      - auto_brightness_enabled
      - auto_sun_enabled
      - auto_ventilate_enabled
      cover_status_options: cover_helper_enabled
      cover_status_helper: input_text.cover_status_helper_curtains
      workday_sensor: binary_sensor.workday_sensor
      default_brightness_sensor: sensor.hub_2_0be5_light_level
      brightness_up: 10
      contact_window_opened: binary_sensor.balcony_door_sensor_magnet_opening_2
      resident_sensor: input_boolean.home_presence
      check_config: true
      blind: cover.curtain_3_b3bb
      shading_brightness_sensor: sensor.hub_2_0be5_illuminance
      shading_temperatur_sensor1: sensor.ble_temperature_masterbed_temp_humidity_sensor
      shading_temperatur_sensor2: sensor.essendon_airport_temp
      shading_forecast_sensor: sensor.essendon_airport_max_temp
      drive_time: 18
      time_control: time_control_input
      brightness_down: 11940
- id: '1749858009259'
  alias: Outdoor Blinds - Cover Control Automation
  description: Coordinates cover control automation behaviour for the outdoor blinds.
  conditions:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  use_blueprint:
    path: hvorragend/cover_control_automation.yaml
    input:
      auto_options:
      - auto_up_enabled
      - auto_down_enabled
      - auto_brightness_enabled
      - auto_sun_enabled
      - auto_ventilate_enabled
      - auto_shading_enabled
      cover_status_options: cover_helper_enabled
      cover_status_helper: input_text.cover_status_helper
      cover_drive_time: 90
      workday_sensor: binary_sensor.workday_sensor
      default_brightness_sensor: sensor.hub_2_0be5_illuminance
      brightness_up: 1000
      brightness_down: 11900
      contact_window_opened: binary_sensor.balcony_door_sensor_magnet_opening_2
      resident_sensor: input_boolean.home_presence
      resident_config:
      - resident_closing_enabled
      - resident_allow_opening
      check_config: true
      blind: cover.roller_blinds_chan1
      open_position: 100
      close_position: 0
      ventilate_position: 30
      shading_position: 25
      position_tolerance: 0
      shading_brightness_sensor: sensor.hub_2_0be5_illuminance
      shading_temperatur_sensor1: sensor.ble_temperature_masterbed_temp_humidity_sensor
      shading_temperatur_sensor2: sensor.essendon_airport_temp
      shading_forecast_sensor: sensor.essendon_airport_max_temp
      shading_sun_brightness_start: 20000
      shading_sun_brightness_end: 12000
      shading_elevation_min: 30
      shading_azimuth_start: 45
      shading_azimuth_end: 360
      is_shading_end_immediate_by_sun_position: true
      auto_shading_start_condition: []
      auto_shading_end_condition:
      - condition: sun
        after: sunset
      drive_delay_fix: 16
      drive_delay_random: 5
      sun_elevation_up: 12
      sun_elevation_down: 5
      sun_time_duration: 120
- id: '1721641437270'
  alias: Covers - Refresh Roller Blind Positions
  description: Periodically polls the roller blinds to keep positions accurate in
    Home Assistant. Updates every 30 seconds based on 18-minute full travel time.
  trigger:
  - platform: time_pattern
    seconds: /30
  condition:
  - condition: state
    entity_id: timer.roller_blind_timer
    state: active
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.roller_blind_state
        state: opening
      sequence:
      - service: input_number.set_value
        target:
          entity_id: input_number.roller_blind_position
        data:
          value: '{{ [states(''input_number.roller_blind_position'')|int(0) + 2.78,
            100] | min }}'
    - conditions:
      - condition: state
        entity_id: input_select.roller_blind_state
        state: closing
      sequence:
      - service: input_number.set_value
        target:
          entity_id: input_number.roller_blind_position
        data:
          value: '{{ [states(''input_number.roller_blind_position'')|int(0) - 2.78,
            0] | max }}'
- id: '1749869999001'
  alias: Covers - Roller Blind Timer Finished (Full Open)
  description: When timer finishes, set position to 100 if opening to full open
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.roller_blind_timer
  condition:
  - condition: state
    entity_id: input_select.roller_blind_state
    state: opening
  - condition: template
    value_template: '{{ states(''input_number.roller_blind_target_position'') | int(0)
      == 100 }}'
  action:
  - action: input_number.set_value
    target:
      entity_id: input_number.roller_blind_position
    data:
      value: 100
  - action: input_select.select_option
    target:
      entity_id: input_select.roller_blind_state
    data:
      option: open
  mode: single
- id: '1749869999002'
  alias: Covers - Roller Blind Timer Finished (Full Close)
  description: When timer finishes, set position to 0 if closing to full close
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.roller_blind_timer
  condition:
  - condition: state
    entity_id: input_select.roller_blind_state
    state: closing
  - condition: template
    value_template: '{{ states(''input_number.roller_blind_target_position'') | int(0)
      == 0 }}'
  action:
  - action: input_number.set_value
    target:
      entity_id: input_number.roller_blind_position
    data:
      value: 0
  - action: input_select.select_option
    target:
      entity_id: input_select.roller_blind_state
    data:
      option: closed
  mode: single
- id: '1749869999003'
  alias: Covers - Roller Blind Partial Position Stop
  description: Stops blind when reaching target partial position during movement
  trigger:
  - platform: time_pattern
    seconds: /5
  condition:
  - condition: state
    entity_id: timer.roller_blind_timer
    state: active
  - condition: template
    value_template: "{% set target = states('input_number.roller_blind_target_position')
      | int(0) %} {% set current = states('input_number.roller_blind_position') |
      int(0) %} {% set state = states('input_select.roller_blind_state') %} {% set
      tolerance = 3 %} {# Only check for partial positions (not 0 or 100) #} {% if
      target > 0 and target < 100 %}\n  {# Check if we've reached target within tolerance
      #}\n  {# IMPORTANT: Timer must have been running for at least 10 seconds to
      avoid immediate stop #}\n  {% set timer_running = as_timestamp(now()) - as_timestamp(state_attr('timer.roller_blind_timer',
      'finishes_at')) + 1080 %}\n  {% if timer_running > 10 %}\n    {% if state ==
      'opening' %}\n      {{ current >= (target - tolerance) }}\n    {% elif state
      == 'closing' %}\n      {{ current <= (target + tolerance) }}\n    {% else %}\n
      \     false\n    {% endif %}\n  {% else %}\n    false\n  {% endif %}\n{% else
      %}\n  false\n{% endif %}"
  action:
  - action: script.roller_blinds_stop
  - action: timer.cancel
    target:
      entity_id: timer.roller_blind_timer
  - action: input_number.set_value
    target:
      entity_id: input_number.roller_blind_position
    data:
      value: '{{ states(''input_number.roller_blind_target_position'') | int(0) }}'
  - action: input_select.select_option
    target:
      entity_id: input_select.roller_blind_state
    data:
      option: '{{ ''open'' if states(''input_number.roller_blind_target_position'')
        | int(0) > 50 else ''closed'' }}'
  mode: single
- id: '1749869999004'
  alias: Covers - Roller Blind Position Debug Logger
  description: Logs position changes for debugging (disable after testing)
  trigger:
  - platform: state
    entity_id: input_number.roller_blind_target_position
    id: target_changed
  - platform: state
    entity_id: input_number.roller_blind_position
    id: position_changed
  - platform: state
    entity_id: input_select.roller_blind_state
    id: state_changed
  action:
  - action: logbook.log
    data:
      name: Roller Blind Debug
      message: '{{ trigger.id }}: Target={{ states(''input_number.roller_blind_target_position'')
        }}%, Current={{ states(''input_number.roller_blind_position'') }}%, State={{
        states(''input_select.roller_blind_state'') }}, Timer={{ states(''timer.roller_blind_timer'')
        }}'
  mode: queued
  max: 10
- id: '1727826000001'
  alias: Automation Tracker - Manual Blind Control
  description: Records when manual blind control is enabled so automations can respect
    the override.
  triggers:
  - trigger: state
    entity_id:
    - cover.roller_blinds_chan1
    attribute: current_position
  conditions:
  - condition: template
    value_template: '{{ trigger.to_state.context.user_id is not none }}'
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.blind_manual_control
  - delay:
      hours: 2
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.blind_manual_control
  mode: restart
- id: '1685572749524'
  alias: Master Bedroom NFC - Control Blinds
  description: Runs blind control scripts when the bedroom NFC tag is scanned.
  trigger:
  - platform: tag
    tag_id: 531bec6b-8dea-4b53-ae0c-5840aca23f70
  condition: []
  action:
  - service: script.roller_blinds_up
    data: {}
    enabled: false
  - service: script.roller_blinds_down
    data: {}
  mode: single
- id: '1693433717718'
  alias: Tag Masterbed - Close Blinds Halfway
  description: Tag Masterbed - Close Blinds Halfway
  trigger:
  - platform: tag
    tag_id: 9d687fe2-e6f7-4d6f-838a-cee2712e3fdb
  condition: []
  action:
  - service: script.1693262268843
    data: {}
  mode: single
- id: '1690150562163'
  alias: Master Bedroom NFC - Heat and Lift Desk Corner
  description: Sets the bedroom climate to heat and opens blinds after a delay when
    that NFC tag is scanned.
  trigger:
  - platform: tag
    tag_id: 38314bff-f8ff-4949-908c-eab6853d970e
  condition: []
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: comfort
    target:
      area_id: master_bedroom
  - service: climate.set_hvac_mode
    data:
      hvac_mode: heat
    target:
      area_id: master_bedroom
  - delay:
      hours: 3
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: script.roller_blinds_up
    data: {}
  mode: single
