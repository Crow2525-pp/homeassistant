---
# ============================================================================
# ROLLER BLINDS AUTOMATION - 50% DEFAULT POSITION
# ============================================================================
# This file contains:
# 1. Default 50% position at morning and evening (easy open/close from middle)
# 2. Manual NFC tag controls (full open/full close)
# 3. Wind protection automation (safety feature)
# 4. Manual blind control tracker
#
# Note: Blinds default to 50% position so they can be easily opened or closed
# from the middle. Blueprint automation removed due to position feedback errors.
# ============================================================================

# ============================================================================
# DEFAULT 50% POSITION SCHEDULE
# ============================================================================

- id: '1644437526741'
  alias: Blinds - Set to 50% at Morning
  description: Set roller blinds to 50% (half open) at 8:00 AM on weekdays when not manually controlled
  trigger:
  - platform: time
    at: '08:00:00'
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  action:
  - service: cover.set_cover_position
    target:
      entity_id: cover.roller_blinds_chan1
    data:
      position: 50
  mode: single

- id: '1644402690424'
  alias: Blinds - Set to 50% at Evening
  description: Set roller blinds to 50% (half open) at sunset when not manually controlled
  trigger:
  - platform: sun
    event: sunset
  condition:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  action:
  - service: cover.set_cover_position
    target:
      entity_id: cover.roller_blinds_chan1
    data:
      position: 50
  mode: single

# ============================================================================
# SAFETY AUTOMATION: Wind Protection
# ============================================================================

- id: '1682548783368'
  alias: Safety - Raise Blinds When Windy
  description: Automatically raises roller blinds when wind speed exceeds 40 km/h
    to prevent damage. Waits for wind to drop below 25 km/h before restoring to 50%.
  trigger:
  - platform: template
    value_template: '{{ state_attr(''weather.home'', ''wind_speed'') > 40}}'
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  action:
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.roller_blinds_chan1
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: 'Safety Alert: High Winds'
      message: Roller blinds raised to protect from wind damage (>40 km/h)
  - wait_for_trigger:
    - platform: template
      value_template: '{{ state_attr(''weather.home'', ''wind_speed'') < 25 }}'
    continue_on_timeout: false
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: Wind Speed Reduced
      message: Restoring blinds to 50% position
  - service: cover.set_cover_position
    target:
      entity_id: cover.roller_blinds_chan1
    data:
      position: 50
  mode: single

# ============================================================================
# NFC TAG CONTROLS - Manual Blind Control
# ============================================================================

- id: '1685572749524'
  alias: Master Bedroom NFC - Open Blinds Fully
  description: Tap NFC tag to open roller blinds fully (100%)
  trigger:
  - platform: tag
    tag_id: 531bec6b-8dea-4b53-ae0c-5840aca23f70
  condition: []
  action:
  - service: script.roller_blinds_up
    data: {}
  mode: single

- id: '1693433717718'
  alias: Master Bedroom NFC - Close Blinds Fully
  description: Tap NFC tag to close roller blinds fully (0%)
  trigger:
  - platform: tag
    tag_id: 9d687fe2-e6f7-4d6f-838a-cee2712e3fdb
  condition: []
  action:
  - service: cover.close_cover
    target:
      entity_id: cover.roller_blinds_chan1
  mode: single

- id: '1690150562163'
  alias: Master Bedroom NFC - Heat and Lift Desk Corner
  description: Sets the bedroom climate to heat and opens blinds fully after a delay when
    that NFC tag is scanned.
  trigger:
  - platform: tag
    tag_id: 38314bff-f8ff-4949-908c-eab6853d970e
  condition: []
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: comfort
    target:
      area_id: master_bedroom
  - service: climate.set_hvac_mode
    data:
      hvac_mode: heat
    target:
      area_id: master_bedroom
  - delay:
      hours: 3
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: script.roller_blinds_up
    data: {}
  mode: single

# ============================================================================
# MANUAL BLIND CONTROL TRACKER
# ============================================================================

- id: '1727826000001'
  alias: Automation Tracker - Manual Blind Control
  description: Records when manual blind control is enabled so automation can
    respect the override (pauses for 2 hours).
  triggers:
  - trigger: state
    entity_id:
    - cover.roller_blinds_chan1
  conditions:
  - condition: template
    value_template: '{{ trigger.to_state.context.user_id is not none }}'
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.blind_manual_control
  - delay:
      hours: 2
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.blind_manual_control
  mode: restart
