---
# ============================================================================
# ROLLER BLINDS AUTOMATION - SIMPLIFIED
# ============================================================================
# This file contains:
# 1. Blueprint-based automation for outdoor roller blinds (primary control)
# 2. NFC tag-based manual controls (up/down/stop via tags)
# 3. Simple manual blind control tracker
#
# Removed: Position-based helpers, time-based automations, and complex
# positional logic. The blueprint handles all climate-based control.
# ============================================================================

- id: '1749858009259'
  alias: Outdoor Blinds - Cover Control Automation
  description: Coordinates cover control automation behaviour for the outdoor blinds.
  conditions:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  - condition: or
    conditions:
    - condition: time
      after: '17:15:00'
    - condition: state
      entity_id: binary_sensor.working_from_home
      state: 'off'
  use_blueprint:
    path: hvorragend/cover_control_automation.yaml
    input:
      auto_options:
      - auto_up_enabled
      - auto_down_enabled
      - auto_brightness_enabled
      - auto_sun_enabled
      - auto_ventilate_enabled
      - auto_shading_enabled
      cover_status_options: cover_helper_enabled
      cover_status_helper: input_text.cover_status_helper
      cover_drive_time: 90
      workday_sensor: binary_sensor.workday_sensor
      default_brightness_sensor: sensor.hub_2_0be5_illuminance
      brightness_up: 1000
      brightness_down: 11900
      contact_window_opened: binary_sensor.balcony_door_sensor_magnet_opening_2
      resident_sensor: input_boolean.home_presence
      resident_config:
      - resident_closing_enabled
      - resident_allow_opening
      check_config: true
      blind: cover.roller_blinds_chan1
      open_position: 100
      close_position: 0
      ventilate_position: 30
      shading_position: 25
      position_tolerance: 0
      shading_brightness_sensor: sensor.hub_2_0be5_illuminance
      shading_temperatur_sensor1: sensor.ble_temperature_masterbed_temp_humidity_sensor
      shading_temperatur_sensor2: sensor.essendon_airport_temp
      shading_forecast_sensor: sensor.essendon_airport_max_temp
      shading_sun_brightness_start: 20000
      shading_sun_brightness_end: 12000
      shading_elevation_min: 30
      shading_azimuth_start: 45
      shading_azimuth_end: 360
      is_shading_end_immediate_by_sun_position: true
      auto_shading_start_condition: []
      auto_shading_end_condition:
      - condition: sun
        after: sunset
      drive_delay_fix: 16
      drive_delay_random: 5
      sun_elevation_up: 12
      sun_elevation_down: 5
      sun_time_duration: 120

# ============================================================================
# NFC TAG CONTROLS - Manual Blind Control
# ============================================================================

- id: '1685572749524'
  alias: Master Bedroom NFC - Control Blinds (Open)
  description: Tap NFC tag to open roller blinds fully
  trigger:
  - platform: tag
    tag_id: 531bec6b-8dea-4b53-ae0c-5840aca23f70
  condition: []
  action:
  - service: script.roller_blinds_up
    data: {}
  mode: single

- id: '1693433717718'
  alias: Tag Masterbed - Close Blinds Partially
  description: Tap NFC tag to close blinds partially
  trigger:
  - platform: tag
    tag_id: 9d687fe2-e6f7-4d6f-838a-cee2712e3fdb
  condition: []
  action:
  - service: cover.close_cover
    target:
      entity_id: cover.roller_blinds_chan1
  mode: single

- id: '1690150562163'
  alias: Master Bedroom NFC - Heat and Lift Desk Corner
  description: Sets the bedroom climate to heat and opens blinds after a delay when
    that NFC tag is scanned.
  trigger:
  - platform: tag
    tag_id: 38314bff-f8ff-4949-908c-eab6853d970e
  condition: []
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: comfort
    target:
      area_id: master_bedroom
  - service: climate.set_hvac_mode
    data:
      hvac_mode: heat
    target:
      area_id: master_bedroom
  - delay:
      hours: 3
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: script.roller_blinds_up
    data: {}
  mode: single

# ============================================================================
# MANUAL BLIND CONTROL TRACKER
# ============================================================================

- id: '1727826000001'
  alias: Automation Tracker - Manual Blind Control
  description: Records when manual blind control is enabled so blueprint automation
    can respect the override (pauses for 2 hours).
  triggers:
  - trigger: state
    entity_id:
    - cover.roller_blinds_chan1
    attribute: current_position
  conditions:
  - condition: template
    value_template: '{{ trigger.to_state.context.user_id is not none }}'
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.blind_manual_control
  - delay:
      hours: 2
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.blind_manual_control
  mode: restart
