---
- id: '1644398227874'
  alias: Living Areas - Lights On Before Sunset
  description: Turns on the evening scene and area lighting when the sun elevation
    drops below 5 degrees and someone is home.
  triggers:
  - entity_id: sun.sun
    attribute: elevation
    below: '5'
    trigger: numeric_state
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Holiday
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: scene.turn_on
    target:
      entity_id: scene.living_room_evening
  - action: light.turn_on
    target:
      area_id:
      - kitchen
      - front_entrance
      - master_bedroom
      - back_garden
    data:
      brightness_pct: 100
  mode: single
- id: '1644398278136'
  alias: Living Areas - Lights Off for Night Routine
  description: Turns off lounge and surrounding lights at 22:15 or when the early
    bedtime calendar event starts.
  triggers:
  - at: '22:15:00'
    trigger: time
  - event: start
    offset: 0:0:0
    entity_id: calendar.early_to_bed
    trigger: calendar
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Sleeping
    - condition: state
      entity_id: input_select.occupancy
      state: Home
  actions:
  - action: remote.turn_off
    target:
      entity_id: remote.sony_kd_55x8500c
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - choose:
    - conditions:
      - condition: state
        entity_id: climate.living_room_versatile_thermostat
        attribute: is_on
        state: 'true'
      sequence:
      - data: {}
        target:
          entity_id: climate.living_room_versatile_thermostat
        action: climate.turn_off
  - data:
      option: Sleeping
    target:
      entity_id: input_select.occupancy
    action: input_select.select_option
  - data:
      transition: 300
    target:
      area_id:
      - kitchen
      - living_room
      - master_bedroom
      - back_garden
    action: light.turn_off
  mode: single
- id: '1649148675412'
  alias: Morning Wake-Up Lighting Routine
  description: Turns on living room light at 05:00 AM for morning wake-up. Excludes
    all bedroom lights to allow natural waking.
  triggers:
  - trigger: numeric_state
    entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
    below: 80
  - trigger: numeric_state
    entity_id: sensor.slvdh_floors_descended
    above: 1
  - at: 05:00:00
    trigger: time
  conditions:
  - condition: sun
    before: sunrise
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
    alias: Someone Home
  actions:
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.lounge
  mode: single
  # NOTE: Intentionally uses only living room (lounge) light
  # Excludes all bedroom lights to allow users to wake naturally without disruption
- id: '1684789400363'
  alias: Morning Shutdown for Stray Lights
  description: Turns off selected lights shortly after sunrise if they were left on
    overnight.
  triggers:
  - event: sunrise
    offset: 00:15:00
    trigger: sun
  conditions: []
  actions:
  - data: {}
    target:
      area_id:
      - living_room
      - kitchen
      - master_bedroom
      - back_garden
      - front_entrance
    action: light.turn_off
  mode: single
- id: '1655607456252'
  alias: Master Bedroom - Dim Lights at 8 PM
  description: Activates the master bedroom dimming scene at 20:00 if the main lights
    are off.
  trigger:
  - platform: time
    at: '20:00:00'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: light.reading_light
      state: 'off'
    - condition: state
      entity_id: light.sleeping_light_2
      state: 'off'
  action:
  - service: scene.turn_on
    target:
      entity_id: scene.master_bedroom_dimming
    metadata: {}
  mode: single
- id: '1657702278131'
  alias: Master Bedroom - Keep Lights Dim After Sunrise
  description: Reapplies the dimmed lighting scene after sunrise when either bedside
    light changes state.
  trigger:
  - platform: state
    entity_id: light.reading_light
  - platform: state
    entity_id: light.sleeping_light_2
  condition:
  - condition: sun
    after: sunrise
    after_offset: '120'
  action:
  - service: scene.turn_on
    target:
      entity_id: scene.master_bedroom_dimming
    metadata: {}
  mode: single
- id: '1662634152654'
  alias: Master Bedroom - Bedside Lights at 1 Percent
  description: Forces the bedside reading and sleeping lights to 1 percent brightness
    between 20:00 and 08:00.
  triggers:
  - trigger: state
    entity_id: light.reading_light
    to: 'on'
    id: Reading
  - trigger: state
    entity_id: light.sleeping_light_2
    to: 'on'
    id: Sleeping
  conditions:
  - condition: time
    before: 08:00:00
    after: '20:00:00'
  actions:
  - alias: Set Triggered Light to 1 Percent
    choose:
    - conditions:
      - condition: trigger
        id: Reading
      sequence:
      - target:
          entity_id: light.reading_light
        data:
          brightness_pct: 1
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: Sleeping
      sequence:
      - target:
          entity_id: light.sleeping_light_2
        data:
          brightness_pct: 1
        action: light.turn_on
  mode: single
- id: '1703583740639'
  alias: Front Entrance - Motion-Activated Light
  description: Turns on the front entrance lights when motion is detected and switches
    them off after the timeout.
  triggers:
  - entity_id:
    - binary_sensor.motion_sensor_motion
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.motion_sensor_motion
    to: 'off'
    for:
      minutes: 2
    trigger: state
  conditions:
  - condition: numeric_state
    entity_id: sun.sun
    attribute: elevation
    below: 5
    enabled: false
  - condition: numeric_state
    entity_id: sensor.motion_sensor_illuminance_lux
    below: 10
  actions:
  - choose:
    - conditions:
      - condition: state
        state: 'on'
        entity_id: binary_sensor.motion_sensor_motion
      sequence:
      - data: {}
        action: light.turn_on
        target:
          area_id: front_entrance
    - conditions:
      - condition: state
        state: 'off'
        entity_id: binary_sensor.motion_sensor_motion
      sequence:
      - data: {}
        action: light.turn_off
        target:
          area_id: front_entrance
  mode: restart
- id: '1752213080801'
  alias: Living Room - Motion Lighting
  description: Controls living room lighting based on motion detection during set
    hours.
  triggers:
  - entity_id:
    - binary_sensor.aqara_motion_and_light_sensor_p2_occupancy
    to: 'on'
    trigger: state
    id: Motion Detected
  - entity_id:
    - binary_sensor.aqara_motion_and_light_sensor_p2_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 20
      seconds: 0
    trigger: state
    id: motion clear
  - trigger: sun
    event: sunrise
    offset: 00:20:00
  conditions:
  - condition: numeric_state
    entity_id: sensor.aqara_motion_and_light_sensor_p2_illuminance_lux
    below: 30
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Motion Detected
      - condition: numeric_state
        entity_id: sun.sun
        attribute: elevation
        below: 0
      sequence:
      - data: {}
        action: light.turn_on
        target:
          area_id:
          - back_garden
          entity_id: light.lounge
    - conditions:
      - condition: trigger
        id:
        - motion clear
      - condition: or
        conditions:
        - condition: and
          conditions:
          - condition: state
            entity_id: media_player.living_room_wiimamp
            state: playing
          - condition: state
            entity_id: media_player.tv_2
            state: playing
          - condition: numeric_state
            entity_id: sun.sun
            attribute: elevation
            above: 0
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.lounge
          area_id: back_garden
    - conditions:
      - condition: trigger
        id:
        - motion clear
      - condition: numeric_state
        entity_id: sun.sun
        attribute: elevation
        above: 0
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.lounge
          area_id: back_garden
  mode: restart
- id: '1694596580092'
  alias: Living Room - Sync TV Power and Lighting
  description: Keeps the AV switch and bias lighting aligned with TV power events.
  trigger:
  - platform: state
    entity_id: remote.tv_2
    to: 'on'
    id: 'On'
  - platform: state
    entity_id: remote.tv_2
    to: 'off'
    id: 'Off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'On'
      sequence:
      - action: switch.turn_on
        target:
          entity_id: switch.living_room_av_relay_switch
      - if:
        - condition: sun
          after: sunset
        then:
        - service: script.tv_lights_on
          data: {}
    - conditions:
      - condition: trigger
        id:
        - 'Off'
      sequence:
      - service: script.tv_lights_off
        data: {}
      - action: switch.turn_off
        target:
          entity_id: switch.living_room_av_relay_switch
  mode: single
- id: '1756063707572'
  alias: Living Room - Lights Off When Watching TV
  description: Turns off selected lights when the living room TV is in use.
  triggers:
  - trigger: state
    entity_id:
    - media_player.tv
    to: playing
    for:
      hours: 0
      minutes: 5
      seconds: 0
    id: Playing
  - trigger: state
    entity_id:
    - media_player.tv
    to: paused
    for:
      hours: 0
      minutes: 0
      seconds: 0
    id: Paused
  - trigger: state
    entity_id:
    - media_player.tv
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    id: TurnedOff
  - trigger: state
    entity_id:
    - media_player.tv
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 0
    id: TurnedOff
  conditions:
  - condition: sun
    after: sunset
    before: sunrise
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Playing
      - condition: time
        after: '20:30:00'
        before: 00:00:00
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.lounge
    - conditions:
      - condition: or
        conditions:
        - condition: time
          after: 00:00:00
          before: '20:30:00'
        - condition: trigger
          id:
          - Paused
        - condition: trigger
          id:
          - TurnedOff
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.living_room_evening
  mode: single
- id: '1732241510110'
  alias: Living Room - Adjust Floor Lamp for Solar Output
  description: Dims or brightens the living room floor lamp based on available solar
    production.
  triggers:
  - entity_id: sensor.gosungrow_virtual_1205796_1_1_1_p24
    trigger: state
  - at: '16:00:00'
    trigger: time
  conditions:
  - condition: time
    after: 06:00:00
    before: '16:00:00'
  actions:
  - choose:
    - conditions:
      - condition: time
        after: 06:00:00
        before: '16:00:00'
      sequence:
      - target:
          entity_id: light.floor_lamp_socket_1
        data:
          rgb_color:
          - 0
          - 255
          - 0
          brightness_pct: '{% set production = states(''sensor.gosungrow_virtual_1205796_1_1_1_p24'')
            | float %} {{ (production / 5.5 * 100) | int if production >= 0 else 0
            }}

            '
        action: light.turn_on
    - conditions: []
      sequence:
      - target:
          entity_id: light.floor_lamp_socket_1
        action: light.turn_off
  mode: single
- id: '1734000000002'
  alias: Outdoor Holiday Lights - Sunset to 9:45pm
  description: Turns outdoor Christmas lights on at sunset and off at 9:45pm.
  triggers:
  - trigger: sun
    event: sunset
    id: turn_on
  - trigger: time
    at: '21:45:00'
    id: turn_off
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: turn_on
      sequence:
      - action: light.turn_on
        target:
          entity_id: light.outdoor_xmas_lights
    - conditions:
      - condition: trigger
        id: turn_off
      sequence:
      - action: light.turn_off
        target:
          entity_id: light.outdoor_xmas_lights
- id: '1734000000001'
  alias: Holiday Lights - Auto On/Off Schedule
  description: Keeps Christmas lights on except between 1am and 5am during holiday season.
  triggers:
  - trigger: time
    at: '05:00:00'
    id: turn_on
  - trigger: time
    at: '01:00:00'
    id: turn_off
  - trigger: state
    entity_id: binary_sensor.holiday_season
    to: 'on'
    id: season_start
  conditions:
  - condition: state
    entity_id: binary_sensor.holiday_season
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: turn_on
        - condition: and
          conditions:
          - condition: trigger
            id: season_start
          - condition: time
            after: '05:00:00'
            before: '01:00:00'
      sequence:
      - action: light.turn_on
        target:
          entity_id: light.xmas_lights_plug_socket_1
    - conditions:
      - condition: trigger
        id: turn_off
      sequence:
      - action: light.turn_off
        target:
          entity_id: light.outdoor_xmas_lights
  mode: single
- id: '1738899778775'
  alias: Study Remote - Toggle Computer Desk
  description: Lets the spare remote toggle the study computer desk smart switch without
    having to pull out a phone
  triggers:
  - platform: event
    event_type: zha_event
    event_data:
      device_id: a957c4c649b876f99732f7bd44193c43
      command: remote_button_short_press
  - platform: event
    event_type: zha_event
    event_data:
      device_id: a957c4c649b876f99732f7bd44193c43
      command: remote_button_short_press
  conditions: []
  actions:
  - action: switch.toggle
    metadata: {}
    data: {}
    target:
      entity_id: switch.computer_plug_switch
  mode: single
- id: '1685157513874'
  alias: Study Desk NFC - Toggle Desk Switch
  description: Toggles the study desk switch when its NFC tag is scanned.
  triggers:
  - tag_id: c99ee431-d1d8-497c-9f0f-214994610aa6
    trigger: tag
  conditions: []
  actions:
  - action: switch.toggle
    target:
      entity_id: switch.computer_plug_switch
  mode: single
- id: '1707562883987'
  alias: Study - Start Workday Desk Routine
  description: Turns on the study desk light and preps climate when the workday toggle
    activates.
  triggers:
  - trigger: state
    entity_id: switch.working_from_home
    to: 'on'
    id: 'On'
  - trigger: state
    entity_id: switch.working_from_home
    to: 'off'
    id: 'Off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'On'
      sequence:
      - action: switch.turn_on
        target:
          entity_id: switch.computer_plug_switch
      - data:
          preset_mode: comfort
        action: climate.set_preset_mode
        target:
          entity_id: climate.henry_s_room_versatile_thermostat
      - data:
          hvac_mode: cool
        action: climate.set_hvac_mode
        target:
          entity_id: climate.henry_s_room_versatile_thermostat
    - conditions:
      - condition: trigger
        id:
        - 'Off'
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.computer_plug_switch
      - data:
          hvac_mode: 'off'
        action: climate.set_hvac_mode
        target:
          entity_id: climate.henry_s_room_versatile_thermostat
  mode: single
- id: '1684410637520'
  alias: Workday Desk Power Prompt
  description: Sends an actionable notification asking to power the computer desk
    at the start of a workday.
  trigger:
  - platform: state
    entity_id: input_boolean.computer_switch
    to: 'on'
  action:
  - action: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: Workday Today
      message: Want the computer desk on?
      data:
        actions:
        - action: DESK_ON
          title: 'On'
        - action: DESK_OFF
          title: 'Off'
        - action: DESK_DELAY
          title: Delay 5 min
  - wait_for_trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: DESK_ON
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: DESK_OFF
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: DESK_DELAY
  - choose:
    - conditions:
      - condition: template
        value_template: "{{ wait.trigger.event.data.action == 'DESK_ON' }}"
      sequence:
      - action: switch.turn_on
        target:
          entity_id: switch.computer_plug_switch
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.computer_switch
    - conditions:
      - condition: template
        value_template: "{{ wait.trigger.event.data.action == 'DESK_OFF' }}"
      sequence:
      - action: switch.turn_off
        target:
          entity_id: switch.computer_plug_switch
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.computer_switch
    - conditions:
      - condition: template
        value_template: "{{ wait.trigger.event.data.action == 'DESK_DELAY' }}"
      sequence:
      - delay:
          minutes: 5
  mode: single
