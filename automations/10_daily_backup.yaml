---
# ============================================================================
# DAILY BACKUP AUTOMATION
# ============================================================================
# Purpose: Automated daily backups at 3:00 AM with notifications
# Trigger: Time-based (3:00 AM daily)
# Action: Create backup, send notification
# Requirements: Home Assistant with Supervisor backups (hassio.backup_full service)
#
# Documentation: docs/setup/BACKUP_AUTOMATION_SETUP.md
# ============================================================================

- id: system_daily_backup_3am
  alias: "System - Daily Backup (3 AM)"
  description: "Create automated backup at 3:00 AM daily with notifications"

  # ============================================================================
  # TRIGGER: Daily at 3:00 AM
  # ============================================================================
  trigger:
    - platform: time
      at: "03:00:00"
      id: scheduled_backup

  # ============================================================================
  # CONDITIONS: Optional Conditions
  # ============================================================================
  condition: []

  # ============================================================================
  # ACTIONS: Create Backup and Notify
  # ============================================================================
  action:
    # Action 1: Create backup
    - service: hassio.backup_full
      data:
        name: "Auto Backup {{ now().strftime('%Y-%m-%d') }}"

    # Action 2: Wait for backup to complete
    - delay:
        seconds: 10

    # Action 3: Send success notification
    - service: notify.persistent_notification
      data:
        title: "Backup Successful"
        message: >
          Daily backup completed successfully.

          Time: {{ now().strftime('%I:%M %p on %B %d, %Y') }}

          Backups are stored in Settings > System > Backups
        data:
          tag: "daily_backup"

    # Action 4: Log to logbook
    - service: logbook.log
      data:
        name: "System Backup"
        message: "Daily backup created successfully"

  mode: single
