---
# ============================================================================
# OFF-SITE BACKUP AUTOMATION - TEMPLATE
# ============================================================================
# Purpose: Upload backups to cloud storage or NAS for disaster recovery
# Trigger: 30 minutes after daily backup (3:30 AM)
# Action: Copy backup to off-site location
# Requirements: Cloud storage integration or NAS mount configured
#
# Options:
# - Google Drive Backup Add-on (recommended, easiest)
# - Samba/NFS share to NAS
# - Dropbox, OneDrive, or other cloud integrations
# - SSH/SCP to remote server
#
# Documentation: docs/BACKUP_AUTOMATION_SETUP.md
# ============================================================================

# ============================================================================
# OPTION A: GOOGLE DRIVE BACKUP (Recommended)
# ============================================================================
# If using Google Drive Backup add-on, configure via add-on UI instead
# This automation is not needed - the add-on handles scheduling automatically

# ============================================================================
# OPTION B: NAS/SAMBA BACKUP
# ============================================================================

- id: system_backup_to_nas
  alias: "System - Backup to NAS"
  description: "Copy daily backup to NAS for off-site storage"

  trigger:
    # Run 30 minutes after daily backup
    - platform: time
      at: "03:30:00"

  condition:
    # Verify NAS is reachable
    # CUSTOMIZE: Add your NAS availability sensor
    # - condition: state
    #   entity_id: binary_sensor.nas_available
    #   state: "on"

  action:
    # Only run if the shell command exists; otherwise notify and stop.
    - choose:
        - conditions:
            - condition: template
              value_template: "{{ has_service('shell_command.backup_to_nas') }}"
          sequence:
            # Copy latest backup to NAS
            - service: shell_command.backup_to_nas  # Define shell command in configuration.yaml

            # Wait for copy to complete
            - delay:
                seconds: 30

            # Notify on success
            - service: notify.persistent_notification
              data:
                title: "NAS Backup Complete"
                message: "Backup uploaded to NAS at {{ now().strftime('%I:%M %p') }}"
                data:
                  tag: "nas_backup"
      default:
        - service: notify.persistent_notification
          data:
            title: "NAS Backup Skipped"
            message: >
              NAS backup automation skipped because shell_command.backup_to_nas
              is not configured. Add it to configuration.yaml or disable this automation.
            data:
              tag: "nas_backup_missing"

  mode: single

# ============================================================================
# OPTION C: DROPBOX/ONEDRIVE BACKUP (Requires Integration)
# ============================================================================
# Uncomment if using Dropbox or OneDrive integration

# - id: system_backup_to_dropbox
#   alias: "System - Backup to Dropbox"
#   description: "Upload backup to Dropbox"
#
#   trigger:
#     - platform: time
#       at: "03:30:00"
#
#   action:
#     # Upload to Dropbox (requires Dropbox integration)
#     - service: dropbox.upload
#       data:
#         file_path: "/backup/latest.tar"  # Adjust path to latest backup
#         destination: "/HomeAssistant/backups/{{ now().strftime('%Y-%m-%d') }}.tar"
#
#     - service: notify.persistent_notification
#       data:
#         title: "Dropbox Backup Complete"
#         message: "Backup uploaded to Dropbox"
#
#   mode: single

# ============================================================================
# SHELL COMMAND CONFIGURATION
# ============================================================================
# Add to configuration.yaml for NAS backup option:
#
# shell_command:
#   backup_to_nas: >
#     cp /backup/*.tar /media/nas/ha_backups/$(date +%Y-%m-%d).tar
#
# Ensure NAS is mounted at /media/nas before using this command
# ============================================================================
