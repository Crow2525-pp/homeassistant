---
- id: '1681557115756'
  alias: Alarmo - Follow Occupancy Modes
  description: Arms or disarms Alarmo to mirror the current occupancy setting.
  trigger:
  - platform: state
    entity_id:
    - input_select.occupancy
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Away
      sequence:
      - action: alarm_control_panel.alarm_arm_away
        target:
          entity_id: alarm_control_panel.alarmo
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Home
      sequence:
      - action: alarm_control_panel.alarm_disarm
        target:
          entity_id: alarm_control_panel.alarmo
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Sleeping
      sequence:
      - action: alarm_control_panel.alarm_arm_night
        target:
          entity_id: alarm_control_panel.alarmo
  mode: single
- id: '1681731859692'
  alias: Alarmo - Arm Night Routine
  description: Arms Alarmo in night mode during bedtime hours based on occupancy or
    manual triggers.
  triggers:
  - at: '21:00:00'
    enabled: false
    trigger: time
  - entity_id:
    - input_select.occupancy
    from: Home
    to: Sleeping
    trigger: state
  - at: input_datetime.bedtime_phil_steph
    trigger: time
  - trigger: numeric_state
    entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
    above: 95
  conditions:
  - condition: time
    before: 06:00:00
    weekday:
    - mon
    - sun
    - tue
    - wed
    - thu
    - fri
    - sat
    after: '19:00:00'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Away
      sequence:
      - wait_for_trigger:
        - entity_id:
          - input_select.occupancy
          from: Away
          to: Home
          for:
            hours: 4
            minutes: 0
            seconds: 0
          trigger: state
        continue_on_timeout: false
      - action: alarm_control_panel.alarm_arm_night
        target:
          entity_id: alarm_control_panel.alarmo
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Home
      sequence:
      - action: alarm_control_panel.alarm_arm_night
        target:
          entity_id: alarm_control_panel.alarmo
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Holiday
      sequence:
      - stop: Not required. Alarm already set.
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Sleeping
      sequence:
      - action: alarm_control_panel.alarm_arm_night
        target:
          entity_id: alarm_control_panel.alarmo
    default:
    - action: alarm_control_panel.alarm_arm_night
      target:
        entity_id: alarm_control_panel.alarmo
  - action: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      message: Alarmo Armed
    enabled: true
  - data:
      message: Home has detected youre not at home. Are you coming home?
      title: 'Action: are you coming home tonight?'
    enabled: false
    service: notify.mobile_app_samsung_galaxy_s22_ultra
  mode: single
- id: '1716152338300'
  alias: Alarmo - Disarm When Household Awake
  description: Disarms Alarmo when someone wakes up during the early-morning routine.
  trigger:
  - trigger: numeric_state
    entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
    below: 80
  - trigger: numeric_state
    entity_id: sensor.slvdh_floors_descended
    above: 1
  - platform: time
    at: 07:00:00
  condition:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
    alias: Someone Home
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: armed_night
  action:
  - service: alarmo.disarm
    metadata: {}
    data:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: '1684787591500'
  alias: Alarmo Arming Prompt
  description: Sends an actionable notification to choose an Alarmo arming mode when
    prompted.
  trigger:
  - platform: state
    entity_id: input_boolean.alarmo_actionable_notification
    to: 'on'
  action:
  - action: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: Alarm Setup
      message: Choose an arming mode
      data:
        actions:
        - action: ALARM_AWAY
          title: Away
        - action: ALARM_NIGHT
          title: Night
        - action: ALARM_DISARM
          title: Disarm
  - wait_for_trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: ALARM_AWAY
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: ALARM_NIGHT
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: ALARM_DISARM
  - choose:
    - conditions:
      - condition: template
        value_template: "{{ wait.trigger.event.data.action == 'ALARM_AWAY' }}"
      sequence:
      - action: alarm_control_panel.alarm_arm_away
        target:
          entity_id: alarm_control_panel.alarmo
    - conditions:
      - condition: template
        value_template: "{{ wait.trigger.event.data.action == 'ALARM_NIGHT' }}"
      sequence:
      - action: alarm_control_panel.alarm_arm_night
        target:
          entity_id: alarm_control_panel.alarmo
    - conditions:
      - condition: template
        value_template: "{{ wait.trigger.event.data.action == 'ALARM_DISARM' }}"
      sequence:
      - action: alarm_control_panel.alarm_disarm
        target:
          entity_id: alarm_control_panel.alarmo
  mode: single
- id: bedtime_security_checklist
  alias: Night - Bedtime Security Checklist
  description: Provides a security checklist notification when switching to sleeping
    mode
  triggers:
  - trigger: state
    entity_id: input_select.occupancy
    to: Sleeping
  actions:
  - delay:
      minutes: 2
  - action: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: "\U0001F319 Bedtime Checklist"
      message: "{% set issues = [] %}\n{% if is_state('cover.smart_garage_door_garage',
        'open') %}{% set issues = issues + ['\U0001F697 Garage door open'] %}{% endif
        %}\n{% if is_state('binary_sensor.downstairs_doors', 'on') %}{% set issues
        = issues + ['\U0001F6AA Door open downstairs'] %}{% endif %}\n{% if states('climate.living_room_versatile_thermastat')
        in ['cool', 'heat'] %}{% set issues = issues + ['❄️ Living room AC still on']
        %}{% endif %}\n{% if issues | length > 0 %}{{ issues | join('\\n') }}{% else
        %}✅ All secure - sleep well!{% endif %}\n"
  mode: single
