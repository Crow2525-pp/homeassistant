---
# ============================================================================
# System - Daily Backup (3 AM)
# ============================================================================
# Purpose: Automated daily backups at 3:00 AM with notifications
# Uses: Home Assistant Supervisor hassio.backup_full service
#
# NOTE: This automation is now ACTIVE (no 99_ prefix).
# The 99_daily_backup_template.yaml is a template and should not be used.
# ============================================================================

- id: system_daily_backup_3am
  alias: "System - Daily Backup (3 AM)"
  description: "Create automated backup at 3:00 AM daily with notifications"

  trigger:
    - platform: time
      at: "03:00:00"
      id: scheduled_backup

  condition: []

  action:
    # Use hassio.backup_full service (required for compatibility)
    - service: hassio.backup_full
      data:
        name: "Auto Backup {{ now().strftime('%Y-%m-%d') }}"

    - delay:
        seconds: 10

    - service: notify.persistent_notification
      data:
        title: "Backup Successful"
        message: >
          Daily backup completed successfully.

          Time: {{ now().strftime('%I:%M %p on %B %d, %Y') }}

          Backups are stored in Settings > System > Backups
        data:
          tag: "daily_backup"

    - service: logbook.log
      data:
        name: "System Backup"
        message: "Daily backup created successfully"

  mode: single
