# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# Customize entities
homeassistant:
  customize: !include config/support/customize.yaml

# Text to speech
tts:
  - platform: google_translate

sensor: !include config/domains/mysensors.yaml
group: !include config/domains/groups.yaml
automation: !include_dir_merge_list automations
script: !include config/domains/scripts.yaml
scene: !include config/domains/scenes.yaml
climate: !include config/domains/climate.yaml
fan: !include config/domains/fan.yaml
media_player: !include config/domains/media_player.yaml
template: !include config/domains/templates.yaml
mqtt: !include config/domains/mqtt.yaml
notify: !include config/domains/notifications.yaml

lovelace:
  mode: yaml
  resources:
    - url: /hacsfiles/lovelace-card-mod/card-mod.js
      type: module
    - url: /hacsfiles/bar-card/bar-card.js
      type: module
    - url: /hacsfiles/better-thermostat-ui-card/better-thermostat-ui-card.js
      type: module
    - url: /hacsfiles/lovelace-auto-entities/auto-entities.js
      type: module
    - url: /hacsfiles/lovelace-template-entity-row/template-entity-row.js
      type: module
    - url: /hacsfiles/config-template-card/config-template-card.js
      type: module
    - url: /hacsfiles/upcoming-media-card/upcoming-media-card.js
      type: module
    - url: /hacsfiles/button-card/button-card.js
      type: module
    - url: /hacsfiles/mini-graph-card/mini-graph-card-bundle.js
      type: module
    - url: /hacsfiles/mini-media-player/mini-media-player-bundle.js
      type: module
    - url: /hacsfiles/my-cards/my-cards.js
      type: module
    - url: /hacsfiles/light-entity-card/dist/light-entity-card.js
      type: module
    - url: /hacsfiles/simple-weather-card/simple-weather-card-bundle.js
      type: module
    - url: /hacsfiles/weather-radar-card/weather-radar-card.js
      type: module
    - url: /hacsfiles/lovelace-state-switch/state-switch.js
      type: module
    - url: /hacsfiles/week-planner-card/week-planner-card.js
      type: module
    - url: /hacsfiles/lovelace-navbar-card/navbar-card.js
      type: module
    - url: /local/community/lovelace-layout-card/layout-card.js
      type: module

logger:
  default: warning
  logs:
    # Suppress GoSungrow MQTT discovery schema validation errors
    # These are caused by the GoSungrow app sending invalid unit/device_class combinations
    # The errors don't affect functionality, just log noise
    # Issue: https://github.com/MickMake/GoSungrow/issues
    homeassistant.components.mqtt.entity: error
    homeassistant.components.mqtt.models: error
    # Uncomment to debug MQTT issues:
    # custom_components.smartir.climate: debug
    # custom_components.smartir.fan: debug
    # custom_components.versatile_thermostat: debug

frontend:
  themes: !include_dir_merge_named themes
  extra_module_url:
    - /local/card-mod.js

http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 192.168.1.103
    - 192.168.1.90
    - 192.168.1.14
    - 192.168.1.16
    - 192.168.1.98
    - 172.30.33.0/24
    - 127.0.0.1

# Ping sensor to detect if on local network
# NOTE: Ping integration no longer supports YAML configuration
# Configure via UI: Settings -> Devices & Services -> Add Integration -> Ping
# Previous settings for reference:
#   - host: 192.168.1.1
#   - count: 2
#   - scan_interval: 60
# binary_sensor:
#   - platform: ping
#     name: "Local Network"
#     host: 192.168.1.1
#     count: 2
#     scan_interval: 60

# Roller Blinds - Migrated to modern template syntax
# See config/domains/templates.yaml for cover definitions

# Disabled integrations (commented out - not in use):
# adaptive_lighting - requires specific light entities and brightness control
# battery_notes - requires compatible battery-powered devices
# These can be re-enabled if needed for future battery monitoring

recorder:
  purge_keep_days: 730
  exclude:
    entity_globs:
      - sensor.*_rssi
      - sensor.*_linkquality
      - sensor.*_last_seen
      - sensor.*_last_boot
      - sensor.*_uptime
      - update.*

# Garage Door Sensors
input_boolean:
  garage_door_notify:
    name: Garage Door Notify

    icon: mdi:information
  local_network_access:
    name: Local Network Access Mode
    icon: mdi:network
    initial: true
  network_device_down_notify:
    name: Network Device Down Notify

    icon: mdi:alert
  wan_down_notify:
    name: WAN Down Notify
    icon: mdi:alert
  blind_manual_control:
    name: Blinds Manual Control Override
    icon: mdi:blinds
    initial: false
  climate_manual_control_living:
    name: Living Room Climate Manual Override
    icon: mdi:thermostat
    initial: false
  climate_manual_control_master:
    name: Master Bedroom Climate Manual Override
    icon: mdi:thermostat
    initial: false
  climate_manual_control_otto:
    name: Otto's Room Climate Manual Override
    icon: mdi:thermostat
    initial: false
  climate_manual_control_study:
    name: Lucas's Room Climate Manual Override
    icon: mdi:thermostat
    initial: false
  super_hot_today:
    name: Super Hot Day Flag
    icon: mdi:weather-sunny-alert
    initial: false
  hot_today_flag:
    name: Hot Day Flag
    icon: mdi:weather-sunny
    initial: false
  warm_today_flag:
    name: Warm Day Flag
    icon: mdi:weather-partly-sunny
    initial: false
  cool_today_flag:
    name: Cool Day Flag
    icon: mdi:weather-cloudy
    initial: false
  cold_today_flag:
    name: Cold Day Flag
    icon: mdi:snowflake
    initial: false
  super_cold_today:
    name: Super Cold Day Flag
    icon: mdi:snowflake-alert
    initial: false
  downstairs_doors_open:
    name: Downstairs Doors Open
    icon: mdi:door-open
    initial: false
  # HVAC Master Switches - Track whether automation thinks HVAC should be on (Principle #11)
  hvac_master_bedroom_should_be_on:
    name: Master Bedroom HVAC Should Be On
    icon: mdi:thermometer
    initial: false
  hvac_living_room_should_be_on:
    name: Living Room HVAC Should Be On
    icon: mdi:thermometer
    initial: false
  hvac_study_should_be_on:
    name: Lucas's Room HVAC Should Be On
    icon: mdi:thermometer
  hvac_kids_room_should_be_on:
    name: Kids Room HVAC Should Be On
    icon: mdi:thermometer

# Cover Control Automation Status Helpers
input_text:
  cover_status_helper:
    name: Roller Blinds Cover Status Helper
    max: 254
    initial: "unknown"
    icon: mdi:roller-shade
  cover_status_helper_curtains:
    name: Curtains Cover Status Helper
    max: 254
    initial: "unknown"
    icon: mdi:curtains

input_select:
  climate_season:
    name: Climate Season
    options:
      - summer
      - autumn
      - winter
      - spring
    initial: spring
    icon: mdi:weather-partly-cloudy
  occupancy:
    name: Occupancy Mode
    options:
      - Home
      - Away
      - Holiday
      - Sleeping
    initial: Home
    icon: mdi:home-account
  news_room_selector:
    name: News Room
    options:
      - Kitchen
      - Study
      - Master Bedroom
      - All Rooms
    initial: Kitchen
    icon: mdi:home-sound-in
  roller_blind_state_simple:
    name: Roller Blind State (Simple)
    options:
      - closed
      - partial
      - open
    initial: closed
    icon: mdi:blinds
  roller_blind_state:
    name: Roller Blind State
    options:
      - opening
      - closing
      - open
      - closed
    initial: closed
    icon: mdi:blinds
input_number:
  # Roller Blind Position Tracking
  roller_blind_position:
    name: Roller Blind Position
    min: 0
    max: 100
    step: 1
    initial: 0
    mode: box
    icon: mdi:blinds
    unit_of_measurement: '%'
  roller_blind_target_position:
    name: Roller Blind Target Position
    min: 0
    max: 100
    step: 1
    initial: 0
    mode: box
    icon: mdi:target
    unit_of_measurement: '%'
  # Climate Control Helpers
  living_room_heat_lead_minutes:
    name: Living Room Heat Lead Minutes
    icon: mdi:timer-plus
    min: 0
    max: 120
    step: 5
    unit_of_measurement: min
    initial: 30
  living_room_heat_comfort_minutes:
    name: Living Room Heat Comfort Window
    icon: mdi:timer-off
    min: 10
    max: 120
    step: 5
    unit_of_measurement: min
    initial: 45
  # Master Bedroom Climate Thresholds
  master_bedroom_temp_summer_cool:
    name: Master Bedroom Summer Cooling Threshold
    min: 22
    max: 28
    step: 0.5
    initial: 26
    unit_of_measurement: "C"
    icon: mdi:thermometer-chevron-up
  master_bedroom_temp_winter_heat:
    name: Master Bedroom Winter Heating Threshold
    min: 14
    max: 20
    step: 0.5
    initial: 16
    unit_of_measurement: "C"
    icon: mdi:thermometer-chevron-down
  master_bedroom_temp_comfort_low:
    name: Master Bedroom Comfort Low
    min: 16
    max: 22
    step: 0.5
    initial: 18
    unit_of_measurement: "C"
    icon: mdi:thermometer
  master_bedroom_temp_comfort_high:
    name: Master Bedroom Comfort High
    min: 20
    max: 28
    step: 0.5
    initial: 22
    unit_of_measurement: "C"
    icon: mdi:thermometer
  # Living Room Climate Thresholds
  living_room_temp_summer_cool:
    name: Living Room Summer Cooling Threshold
    min: 24
    max: 32
    step: 0.5
    initial: 28
    unit_of_measurement: "C"
    icon: mdi:thermometer-chevron-up
  living_room_temp_winter_heat:
    name: Living Room Winter Heating Threshold
    min: 16
    max: 22
    step: 0.5
    initial: 19
    unit_of_measurement: "C"
    icon: mdi:thermometer-chevron-down
  living_room_temp_winter_morning:
    name: Living Room Winter Morning Preheat Threshold
    min: 16
    max: 21
    step: 0.5
    initial: 19
    unit_of_measurement: "C"
    icon: mdi:thermometer-clock
  living_room_temp_comfort:
    name: Living Room Comfort Temperature
    min: 18
    max: 24
    step: 0.5
    initial: 20
    unit_of_measurement: "C"
    icon: mdi:thermometer
  # Otto's Room Climate Thresholds
  ottos_room_temp_heating:
    name: Otto's Room Winter Heating Threshold
    min: 16
    max: 21
    step: 0.5
    initial: 18.5
    unit_of_measurement: "C"
    icon: mdi:thermometer-chevron-down
  ottos_room_temp_comfort_low:
    name: Otto's Room Comfort Low
    min: 17
    max: 21
    step: 0.5
    initial: 18.5
    unit_of_measurement: "C"
    icon: mdi:thermometer
  ottos_room_temp_comfort_high:
    name: Otto's Room Comfort High
    min: 19
    max: 24
    step: 0.5
    initial: 19.5
    unit_of_measurement: "C"
    icon: mdi:thermometer
  ottos_room_temp_warm:
    name: Otto's Room Warm Threshold
    min: 21
    max: 25
    step: 0.5
    initial: 22
    unit_of_measurement: "C"
    icon: mdi:thermometer-chevron-up
  ottos_room_temp_hot:
    name: Otto's Room Hot Threshold
    min: 22
    max: 26
    step: 0.5
    initial: 23
    unit_of_measurement: "C"
    icon: mdi:thermometer-alert
  ottos_room_temp_very_hot:
    name: Otto's Room Very Hot Threshold
    min: 23
    max: 28
    step: 0.5
    initial: 25
    unit_of_measurement: "C"
    icon: mdi:thermometer-high
  # Henry's Room / Study Climate Thresholds
  henrys_room_temp_heating:
    name: Henry's Room Winter Heating Threshold
    min: 16
    max: 21
    step: 0.5
    initial: 21
    unit_of_measurement: "C"
    icon: mdi:thermometer-chevron-down
  henrys_room_temp_comfort_low:
    name: Henry's Room Comfort Low
    min: 20
    max: 23
    step: 0.5
    initial: 21
    unit_of_measurement: "C"
    icon: mdi:thermometer
  henrys_room_temp_comfort_high:
    name: Henry's Room Comfort High
    min: 22
    max: 25
    step: 0.5
    initial: 23
    unit_of_measurement: "C"
    icon: mdi:thermometer
  henrys_room_temp_warm:
    name: Henry's Room Warm Threshold
    min: 21
    max: 25
    step: 0.5
    initial: 22
    unit_of_measurement: "C"
    icon: mdi:thermometer-chevron-up
  henrys_room_temp_hot:
    name: Henry's Room Hot Threshold
    min: 23
    max: 26
    step: 0.5
    initial: 24
    unit_of_measurement: "C"
    icon: mdi:thermometer-alert
  # Automation Trigger Counters (daily, reset at midnight)
  seasonal_climate_triggers_today:
    name: Seasonal Climate Manager Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  morning_blinds_triggers_today:
    name: Morning Blinds Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  preheat_triggers_today:
    name: Preheat (5:30am) Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  evening_cooling_triggers_today:
    name: Evening Cooling Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  frost_protection_triggers_today:
    name: Frost Protection Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  afternoon_recheck_triggers_today:
    name: Afternoon Re-check Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  # Additional automations tracking
  master_bedroom_cooling_night_triggers_today:
    name: Master Bedroom Cooling Night Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  children_cooling_night_triggers_today:
    name: Children's Rooms Cooling Night Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  master_bedroom_blinds_night_triggers_today:
    name: Master Bedroom Blinds Night Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  master_bedroom_blinds_morning_triggers_today:
    name: Master Bedroom Blinds Morning Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter
  climate_flags_mark_hot_day_triggers_today:
    name: Climate Flags - Mark Hot Day Triggers Today
    min: 0
    max: 100
    step: 1
    initial: 0
    unit_of_measurement: triggers
    icon: mdi:counter

input_datetime:
  # Per-room wake/bed times for HVAC scheduling
  # Master Bedroom (Steph & Phil)
  wakeup_time_master_bedroom:
    name: Wake-up Time - Master Bedroom
    has_date: false
    has_time: true
    icon: mdi:weather-sunset-up
  bedtime_master_bedroom:
    name: Bedtime - Master Bedroom
    has_date: false
    has_time: true
    icon: mdi:weather-night
  # Otto's Room (Henry & Otto)
  wakeup_time_ottos_room:
    name: Wake-up Time - Otto's Room
    has_date: false
    has_time: true
    icon: mdi:weather-sunset-up
  bedtime_ottos_room:
    name: Bedtime - Otto's Room
    has_date: false
    has_time: true
    icon: mdi:weather-night
  # Lucas's Room (formerly Study/Henry's Room)
  wakeup_time_lucas_room:
    name: Wake-up Time - Lucas's Room
    has_date: false
    has_time: true
    icon: mdi:weather-sunset-up
  bedtime_lucas_room:
    name: Bedtime - Lucas's Room
    has_date: false
    has_time: true
    icon: mdi:weather-night
  # Living Room (follows household-wide schedule)
  wakeup_time_living_room:
    name: Wake-up Time - Living Room
    has_date: false
    has_time: true
    icon: mdi:weather-sunset-up
  bedtime_living_room:
    name: Bedtime - Living Room
    has_date: false
    has_time: true
    icon: mdi:weather-night

  last_climate_notification_living:
    name: Last Climate Notification - Living Room
    has_date: true
    has_time: true
  last_climate_notification_master:
    name: Last Climate Notification - Master Bedroom
    has_date: true
    has_time: true
  ac_filter_living_room:
    name: AC Filter Last Changed - Living Room
    has_date: true
    has_time: true
  ac_filter_master_bedroom:
    name: AC Filter Last Changed - Master Bedroom
    has_date: true
    has_time: true
  ac_filter_otto_room:
    name: AC Filter Last Changed - Otto's Room
    has_date: true
    has_time: true
  ac_filter_study_henry:
    name: AC Filter Last Changed - Lucas's Room
    has_date: true
    has_time: true
  # Automation Trigger Tracking
  last_trigger_seasonal_climate_manager:
    name: Last Trigger - Seasonal Climate Manager
    has_date: true
    has_time: true
  last_trigger_morning_blinds:
    name: Last Trigger - Morning Blinds Controller
    has_date: true
    has_time: true
  last_trigger_preheat_530am:
    name: Last Trigger - Living Room Preheat 5:30am
    has_date: true
    has_time: true
  last_trigger_evening_cooling:
    name: Last Trigger - Evening Cooling Night
    has_date: true
    has_time: true
  last_trigger_frost_protection:
    name: Last Trigger - Frost Protection Night
    has_date: true
    has_time: true
  last_trigger_afternoon_recheck:
    name: Last Trigger - Afternoon Hot Flag Re-check
    has_date: true
    has_time: true
  # Additional automation tracking
  last_trigger_master_bedroom_cooling_night:
    name: Last Trigger - Master Bedroom Cooling Night
    has_date: true
    has_time: true
  last_trigger_children_cooling_night:
    name: Last Trigger - Children's Rooms Cooling Night
    has_date: true
    has_time: true
  last_trigger_master_bedroom_blinds_night:
    name: Last Trigger - Master Bedroom Blinds Night
    has_date: true
    has_time: true
  last_trigger_master_bedroom_blinds_morning:
    name: Last Trigger - Master Bedroom Blinds Morning
    has_date: true
    has_time: true
  last_trigger_climate_flags_mark_hot_day:
    name: Last Trigger - Climate Flags Mark Hot Day
    has_date: true
    has_time: true

timer:
  roller_blind_timer:
    name: Roller Blind Movement Timer
    icon: mdi:timer
    restore: false

alert:
  garage_door_info_alert_active:
    name: Garage Door Alert Active
    entity_id: binary_sensor.garage_door_alert_active
    state: "on"
    repeat:
      - 180
    can_acknowledge: true
    skip_first: true
    title: "7580 Info - Garage Door Open"
    message: >
      Garage Door open for {{ relative_time(states.binary_sensor.garage_door_alert_active.last_changed) }}.
      Alerts on: {{ expand('entity_id.cover.smart_garage_door_garage') | selectattr('state', 'eq', 'open') | map(attribute='attributes.friendly_name') | list | join(', ') }}.
      Triggered: {{ as_timestamp(states.binary_sensor.garage_door_alert_active.last_changed) | timestamp_custom('%A %I:%M%p (%d-%b-%Y)') }}
    done_message: "Garage Door Alert RESOLVED at {{ as_timestamp(states.binary_sensor.garage_door_alert_active.last_changed) | timestamp_custom('%A %I:%M%p (%d-%b-%Y)') }}"
    notifiers:
      - STD_Information

  network_device_down_warn_alert_active:
    name: Network Device Down Alert Active
    entity_id: binary_sensor.network_device_down_alert_active
    state: "on"
    repeat:
      - 3
      - 10
      - 30
      - 60
    can_acknowledge: true
    skip_first: false
    title: "7580 Warning - Network Device Down"
    message: >
      Network device down for {{ relative_time(states.binary_sensor.network_device_down_alert_active.last_changed) }}.
      Alerts on: {{ expand('group.network_devices') | selectattr('state', 'eq', 'off') | map(attribute='attributes.friendly_name') | list | join(', ') }}.
      Triggered: {{ as_timestamp(states.binary_sensor.network_device_down_alert_active.last_changed) | timestamp_custom('%A %I:%M%p (%d-%b-%Y)') }}
    done_message: "Network Device Down Alert RESOLVED at {{ as_timestamp(states.binary_sensor.network_device_down_alert_active.last_changed) | timestamp_custom('%A %I:%M%p (%d-%b-%Y)') }}"
    notifiers:
      - STD_Warning
  wan_down_warn_alert_active:
    name: WAN Down Alert Active
    entity_id: binary_sensor.wan_down_alert_active
    state: "on"
    repeat:
      - 3
      - 10
      - 30
      - 60
    can_acknowledge: true
    skip_first: false
    title: "WAN Down"
    message: >
      WAN has been down for {{ relative_time(states.binary_sensor.wan_down_alert_active.last_changed) }}.
      Please check your WAN connection.
    done_message: "WAN Down Alert RESOLVED at {{ as_timestamp(states.binary_sensor.wan_down_alert_active.last_changed) | timestamp_custom('%A %I:%M%p (%d-%b-%Y)') }}"
    notifiers:
      - STD_Warning

# ============================================================================
# SHELL COMMANDS
# ============================================================================
# Shell commands allow running shell scripts/commands from automations
# Uncomment and configure as needed

shell_command:
  # NAS Backup Command
  # Used by automation: System - Backup to NAS (automations/11_backup_to_nas.yaml)
  # Instructions:
  # 1. Mount your NAS in Home Assistant (Settings > System > Network Storage)
  # 2. Update the path below to match your NAS mount point
  # 3. Uncomment the line below
  # 4. Restart Home Assistant
  # 5. Test the automation manually
  backup_to_nas: "echo 'NAS backup not configured. Update path in configuration.yaml'"
  # Example for NAS mounted at /media/nas:
  # backup_to_nas: "cp /backup/*.tar /media/nas/ha_backups/"
  # Example for Samba share:
  # backup_to_nas: "cp /backup/*.tar /mnt/nas/homeassistant/backups/"
