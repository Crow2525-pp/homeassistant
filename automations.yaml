- id: '1644318707340'
  alias: Master Bedroom - Close Blinds on High Humidity
  description: Closes the master bedroom blinds and starts cooling between 11:00 and
    18:00 when humidity stays above 20% for 5 minutes.
  triggers:
  - trigger: numeric_state
    id: humidity_high
    entity_id: sensor.ble_humidity_masterbed_temp_humidity_sensor
    above: 20
    for:
      minutes: 5
  conditions:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  - condition: state
    entity_id: binary_sensor.balcony_door_sensor_magnet_opening_2
    state: 'off'
  - condition: time
    after: '11:00:00'
    before: '18:00:00'
  actions:
  - if:
    - condition: state
      entity_id: input_select.occupancy
      state: Home
    then:
    - action: script.fan_speed_1
  - action: cover.close_cover
    target:
      entity_id: cover.roller_blinds_chan1
  - choose:
    - alias: Escalate Cooling When Humidity Exceeds 24 Percent
      conditions:
      - condition: numeric_state
        entity_id: sensor.ble_humidity_masterbed_temp_humidity_sensor
        above: 24
      sequence:
      - action: cover.close_cover
        target:
          entity_id: cover.windowcovering_cover
      - action: climate.turn_on
        target:
          area_id: master_bedroom
      - action: climate.set_hvac_mode
        data:
          hvac_mode: cool
        target:
          area_id: master_bedroom
  mode: single
- id: close_blinds_cooldown
  alias: Master Bedroom - Reopen Blinds When Room Cools
  description: Reopens blinds, stops cooling, and turns off the fan when the bedroom
    stays below 20C for 5 minutes.
  triggers:
  - trigger: numeric_state
    id: temperature_low
    entity_id: sensor.ble_temperature_masterbed_temp_humidity_sensor
    below: 20
    for:
      minutes: 5
  conditions:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  - condition: state
    entity_id: binary_sensor.balcony_door_sensor_magnet_opening_2
    state: 'off'
  - condition: time
    after: '11:00:00'
    before: '18:00:00'
  actions:
  - action: script.fan_off
  - action: cover.open_cover
    target:
      entity_id:
      - cover.roller_blinds_chan1
      - cover.windowcovering_cover
  - action: climate.turn_off
    target:
      area_id: master_bedroom
  mode: single
- id: '1644398227874'
  alias: Living Areas - Lights On Before Sunset
  description: Turns on the evening scene and area lighting when the sun elevation
    drops below 5 degrees and someone is home.
  triggers:
  - entity_id: sun.sun
    attribute: elevation
    below: '5'
    trigger: numeric_state
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Holiday
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: scene.turn_on
    target:
      entity_id: scene.living_room_evening
  - action: light.turn_on
    target:
      area_id:
      - kitchen
      - front_entrance
      - master_bedroom
      - back_garden
    data:
      brightness_pct: 100
  mode: single
- id: '1644398278136'
  alias: Living Areas - Lights Off for Night Routine
  description: Turns off lounge and surrounding lights at 22:15 or when the early
    bedtime calendar event starts.
  triggers:
  - at: '22:15:00'
    trigger: time
  - event: start
    offset: 0:0:0
    entity_id: calendar.early_to_bed
    trigger: calendar
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Sleeping
    - condition: state
      entity_id: input_select.occupancy
      state: Home
  actions:
  - type: turn_off
    device_id: a4c9fa6c4205ff2778142853b379e0c5
    entity_id: remote.sony_kd_55x8500c
    domain: remote
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - choose:
    - conditions:
      - condition: state
        entity_id: climate.living_room_versatile_thermastat
        attribute: is_on
        state: 'true'
      sequence:
      - data: {}
        target:
          entity_id: climate.living_room_ac
        action: climate.turn_off
  - data:
      option: Sleeping
    target:
      entity_id: input_select.occupancy
    action: input_select.select_option
  - data:
      transition: 300
    target:
      area_id:
      - kitchen
      - living_room
      - master_bedroom
      - back_garden
    action: light.turn_off
  mode: single
- id: '1644402690423'
  alias: Master Bedroom - Close Blinds for Night Mode
  description: Closes the master bedroom blinds at 21:30 when manual control is disabled
    and either blind is still open.
  trigger:
  - platform: time
    at: '21:30:00'
  condition:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: cover.roller_blinds_chan1
      state: open
    - condition: state
      entity_id: cover.windowcovering_cover
      state: open
  action:
  - action: cover.close_cover
    metadata: {}
    data: {}
    target:
      entity_id:
      - cover.roller_blinds_chan1
      - cover.windowcovering_cover
  mode: single
- id: '1644437526740'
  alias: Master Bedroom - Open Blinds for Morning Routine
  description: Opens the master bedroom blinds at the configured wake-up time when
    manual control is off and hot-day flags are clear.
  triggers:
  - at: input_datetime.wakeup_time_phil_steph
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.hot_today_flag
      state: 'off'
    - condition: state
      entity_id: input_boolean.super_hot_today
      state: 'off'
  actions:
  - action: cover.open_cover
    metadata: {}
    data: {}
    target:
      entity_id:
      - cover.roller_blinds_chan1
      - cover.windowcovering_cover
  mode: single
- id: '1647520935523'
  alias: Driveway Camera - Motion Test Stream
  description: Streams the driveway camera feed to the kitchen display when motion
    is detected for testing.
  trigger:
  - type: motion
    platform: device
    device_id: 4cadedd6aad3623038c4725e3f43188f
    entity_id: binary_sensor.driveway_cam_motion
    domain: binary_sensor
  condition: []
  action:
  - service: media_player.play_media
    target:
      entity_id: media_player.kitchen
    data:
      media_content_id: media-source://camera/camera.driveway_cam
      media_content_type: application/vnd.apple.mpegurl
    metadata:
      title: Driveway Cam
      thumbnail: /api/camera_proxy/camera.driveway_cam
      media_class: video
      children_media_class: null
      navigateIds:
      - {}
      - media_content_type: app
        media_content_id: media-source://camera
  mode: single
- id: '1647521016663'
  alias: Front Door Camera - Motion Test Stream
  description: Streams the front door camera feed when motion is detected while someone
    is home.
  triggers:
  - type: motion
    device_id: 92ce4d5d5c029a9e37a00e2bf4573f3c
    entity_id: binary_sensor.bi_door_camera_motion
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: state
    entity_id: input_boolean.people_home
    state: 'on'
  - condition: state
    entity_id: schedule.awake_hours
    state: 'on'
  actions:
  - target:
      entity_id: media_player.kitchen
    data:
      media_content_id: media-source://camera/camera.bi_door_camera
      media_content_type: image/jpeg
    metadata:
      title: BI Door Camera
      thumbnail: /api/camera_proxy/camera.bi_door_camera
      media_class: video
      children_media_class: null
      navigateIds:
      - {}
      - media_content_type: app
        media_content_id: media-source://camera
    action: media_player.play_media
  mode: single
- id: '1648979867608'
  alias: Send Phil a Door Camera Snapshot on Motion
  description: Uses the motion snapshot blueprint to notify Phil with a front door
    image when motion is detected.
  use_blueprint:
    path: vorion/send-camera-snapshot-notification-on-motion.yaml
    input:
      motion_sensor: binary_sensor.bi_door_camera_motion
      camera: camera.bi_front_door_camera
      notify_device: c054264b79e6739a057236f3a3c512b4
      delay: 1
- id: '1649108238334'
  alias: Notify Steph When Phil Leaves Work
  description: Sends Steph a notification when Phil exits the work zone.
  trigger:
  - platform: zone
    entity_id: person.phil_patterson
    zone: zone.work
    event: leave
  condition: []
  action:
  - service: notify.mobile_app_slvdh
    data:
      message: Phil is leaving work area now
      title: Phil leaves work
  mode: single
- id: '1649147714100'
  alias: Open Garage When Phil or Steph Arrive Home
  description: Opens the garage door and disarms Alarmo when Phil or Steph arrive
    home and the car is connected.
  triggers:
  - device_id: c054264b79e6739a057236f3a3c512b4
    domain: device_tracker
    entity_id: device_tracker.sm_s908e
    type: enters
    zone: zone.home
    trigger: device
  - device_id: 58e2eb1fec0eb5ec9ce450433d074fcf
    domain: device_tracker
    entity_id: device_tracker.slvdh_2
    type: enters
    zone: zone.home
    trigger: device
  conditions:
  - type: is_connected
    condition: device
    device_id: c054264b79e6739a057236f3a3c512b4
    entity_id: 39a721a1e67ec5758cce90959b3d8a25
    domain: binary_sensor
  actions:
  - device_id: 7edad8ef01a718694f8a423cbfdca0c0
    domain: cover
    entity_id: cover.smart_garage_door_garage
    type: open
  - device_id: d0246dd7b63468505017ec29f63e3d86
    domain: alarm_control_panel
    entity_id: alarm_control_panel.alarmo
    type: disarm
  mode: single
- id: '1649148675412'
  alias: Morning Wake-Up Lighting Routine
  description: Turns on selected lights near sunrise, when movement is detected, or
    at 05:00 while someone is home.
  triggers:
  - type: value
    device_id: c054264b79e6739a057236f3a3c512b4
    entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
    domain: sensor
    below: 80
    trigger: device
  - type: value
    device_id: 58e2eb1fec0eb5ec9ce450433d074fcf
    entity_id: sensor.slvdh_floors_descended
    domain: sensor
    above: 1
    trigger: device
  - at: 05:00:00
    trigger: time
  conditions:
  - condition: sun
    before: sunrise
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
    alias: Someone Home
  actions:
  - metadata: {}
    data: {}
    target:
      device_id:
      - 232fc839ce53ebd06b58a471c2412ad2
      - fee3e1405cfa62d116d3f31ec12a9618
      - cb1af1280403c9c6679a6535afb27939
    action: light.turn_on
  mode: single
- id: '1655607456252'
  alias: Master Bedroom - Dim Lights at 8 PM
  description: Activates the master bedroom dimming scene at 20:00 if the main lights
    are off.
  trigger:
  - platform: time
    at: '20:00:00'
  condition:
  - condition: or
    conditions:
    - condition: device
      type: is_off
      device_id: 1d56affa255e58f16de182a278c4965f
      entity_id: fda71f9209c97e761f7d018643b4d0b8
      domain: light
    - condition: device
      type: is_off
      device_id: 85033fd25fd770cd2ec0ffc76e107d3d
      entity_id: 78dfba29350243dbccf4dfcc7cc8492a
      domain: light
  action:
  - service: scene.turn_on
    target:
      entity_id: scene.master_bedroom_dimming
    metadata: {}
  mode: single
- id: '1657702278131'
  alias: Master Bedroom - Keep Lights Dim After Sunrise
  description: Reapplies the dimmed lighting scene after sunrise when either bedside
    light changes state.
  trigger:
  - platform: device
    type: changed_states
    device_id: 18551c9b3c72efc901c3e35633c1e3c7
    entity_id: light.reading_light
    domain: light
  - platform: device
    type: changed_states
    device_id: 3cf9c8bc5367cd26edc9b128e7303916
    entity_id: light.sleeping_light_2
    domain: light
  condition:
  - condition: sun
    after: sunrise
    after_offset: '120'
  action:
  - service: scene.turn_on
    target:
      entity_id: scene.master_bedroom_dimming
    metadata: {}
  mode: single
- id: '1662634152654'
  alias: Master Bedroom - Bedside Lights at 1 Percent
  description: Forces the bedside reading and sleeping lights to 1 percent brightness
    between 20:00 and 08:00.
  triggers:
  - type: turned_on
    device_id: 18551c9b3c72efc901c3e35633c1e3c7
    entity_id: 796eb3a2a943532f618ea9933efbfad6
    domain: light
    id: Reading
    trigger: device
  - type: turned_on
    device_id: 3cf9c8bc5367cd26edc9b128e7303916
    entity_id: c0696c96326546dbb113c5b3d97482a8
    domain: light
    id: Sleeping
    trigger: device
  conditions:
  - condition: time
    before: 08:00:00
    after: '20:00:00'
  actions:
  - alias: Set Triggered Light to 1 Percent
    choose:
    - conditions:
      - condition: trigger
        id: Reading
      sequence:
      - target:
          entity_id: light.reading_light
        data:
          brightness_pct: 1
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: Sleeping
      sequence:
      - target:
          entity_id: light.sleeping_light_2
        data:
          brightness_pct: 1
        action: light.turn_on
  mode: single
- id: '1662761539613'
  alias: Reset Occupancy to Home After Wake-Up
  description: Sets the household occupancy back to Home at the configured wake-up
    time while the state is Sleeping.
  trigger:
  - platform: sun
    event: sunrise
    offset: 0
    enabled: false
  - type: value
    platform: device
    device_id: c054264b79e6739a057236f3a3c512b4
    entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
    domain: sensor
    above: 99
    enabled: false
  - platform: time
    at: input_datetime.wakeup_time_phil_steph
  - platform: state
    entity_id:
    - input_button.wake_up_start
  condition:
  - condition: state
    entity_id: input_select.occupancy
    state: Sleeping
  action:
  - service: input_select.select_option
    data:
      option: Home
    target:
      entity_id: input_select.occupancy
  mode: single
- id: '1665308479762'
  alias: Living Room - Preheat at 5 30 AM if Cold
  description: Starts the living room climate at 05:30 when temperatures are low,
    provided manual overrides are off and someone is home.
  triggers:
  - at: 05:30:00
    trigger: time
  conditions:
  - condition: or
    conditions:
    - type: is_temperature
      condition: device
      device_id: ebf0379e33b2ccccd4ee6b6c351f4ce5
      entity_id: sensor.ble_temperature_kitchen_temp_humidity_sensor
      domain: sensor
      below: 19
    - type: is_temperature
      condition: device
      device_id: 4d7546906b50573a9ce56a4a8c04ff90
      entity_id: sensor.living_room_temperature_offset
      domain: sensor
      below: 17.5
  - condition: state
    entity_id: input_boolean.super_hot_today
    state: 'off'
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
    alias: Someone Home
  - condition: state
    entity_id: input_boolean.climate_manual_control_living
    state: 'off'
  actions:
  - data:
      preset_mode: comfort
    target:
      entity_id: climate.living_room_versatile_thermastat
    action: climate.set_preset_mode
  - action: climate.set_hvac_mode
    target:
      entity_id:
      - climate.living_room_versatile_thermastat
    data:
      hvac_mode: heat
  - action: climate.set_fan_mode
    metadata: {}
    data:
      fan_mode: highest
    target:
      device_id: b084d1fcd04470308deb597901c61d5c
  mode: single
- id: '1677490997108'
  alias: Battery Alerts - All Sensors
  description: Uses the community blueprint to notify both phones when any monitored
    battery falls below 25 percent.
  use_blueprint:
    path: sbyx/low-battery-level-detection-notification-for-all-battery-sensors.yaml
    input:
      actions:
      - device_id: c054264b79e6739a057236f3a3c512b4
        domain: mobile_app
        type: notify
        message: '{{sensors}}'
        title: Low battery warning
      - device_id: 58e2eb1fec0eb5ec9ce450433d074fcf
        domain: mobile_app
        type: notify
        message: '{{sensors}}'
        title: Low battery warning
      threshold: 25
      exclude:
        entity_id: []
        device_id:
        - 58e2eb1fec0eb5ec9ce450433d074fcf
        - c054264b79e6739a057236f3a3c512b4
- id: '1681337163617'
  alias: Set Occupancy to Away
  description: Switches the occupancy selector to Away after 10 minutes with no one
    in the home zone.
  triggers:
  - entity_id:
    - zone.home
    to: '0'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Away
  actions:
  - data:
      option: Away
    target:
      entity_id: input_select.occupancy
    action: input_select.select_option
  mode: single
- id: '1681548980319'
  alias: Set Occupancy to Home
  description: Returns the occupancy selector to Home as soon as either resident arrives.
  trigger:
  - platform: zone
    entity_id: person.stephanie_patterson
    zone: zone.home
    event: enter
  - platform: zone
    entity_id: device_tracker.sm_s908e
    zone: zone.home
    event: enter
  - platform: state
    entity_id:
    - zone.home
    from: '0'
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Home
  action:
  - service: input_select.select_option
    data:
      option: Home
    target:
      entity_id: input_select.occupancy
  mode: single
- id: '1681557115756'
  alias: Alarmo - Follow Occupancy Modes
  description: Arms or disarms Alarmo to mirror the current occupancy setting.
  trigger:
  - platform: state
    entity_id:
    - input_select.occupancy
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Away
      sequence:
      - device_id: d0246dd7b63468505017ec29f63e3d86
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: arm_away
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Home
      sequence:
      - device_id: d0246dd7b63468505017ec29f63e3d86
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: disarm
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Sleeping
      sequence:
      - device_id: d0246dd7b63468505017ec29f63e3d86
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: arm_night
  mode: single
- id: '1681617191471'
  alias: Theme - Apply Waves on Startup
  description: Sets the Lovelace theme to Waves whenever Home Assistant starts.
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: frontend.set_theme
    data:
      name: waves
  mode: single
- id: '1681731859692'
  alias: Alarmo - Arm Night Routine
  description: Arms Alarmo in night mode during bedtime hours based on occupancy or
    manual triggers.
  triggers:
  - at: '21:00:00'
    enabled: false
    trigger: time
  - entity_id:
    - input_select.occupancy
    from: Home
    to: Sleeping
    trigger: state
  - at: input_datetime.bedtime_phil_steph
    trigger: time
  - type: value
    device_id: c054264b79e6739a057236f3a3c512b4
    entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
    domain: sensor
    trigger: device
    above: 95
  conditions:
  - condition: time
    before: 06:00:00
    weekday:
    - mon
    - sun
    - tue
    - wed
    - thu
    - fri
    - sat
    after: '19:00:00'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Away
      sequence:
      - wait_for_trigger:
        - entity_id:
          - input_select.occupancy
          from: Away
          to: Home
          for:
            hours: 4
            minutes: 0
            seconds: 0
          trigger: state
        continue_on_timeout: false
      - device_id: d0246dd7b63468505017ec29f63e3d86
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: arm_night
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Home
      sequence:
      - device_id: d0246dd7b63468505017ec29f63e3d86
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: arm_night
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Holiday
      sequence:
      - stop: Not required. Alarm already set.
    - conditions:
      - condition: state
        entity_id: input_select.occupancy
        state: Sleeping
      sequence:
      - device_id: d0246dd7b63468505017ec29f63e3d86
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: arm_night
    default:
    - device_id: d0246dd7b63468505017ec29f63e3d86
      domain: alarm_control_panel
      entity_id: alarm_control_panel.alarmo
      type: arm_night
  - device_id: c054264b79e6739a057236f3a3c512b4
    domain: mobile_app
    type: notify
    message: Alarmo Armed
    enabled: true
  - data:
      message: Home has detected youre not at home. Are you coming home?
      title: 'Action: are you coming home tonight?'
    enabled: false
    service: notify.mobile_app_samsung_galaxy_s22_ultra
  mode: single
- id: '1682493497365'
  alias: Phil Leaves Work Alert
  description: Notifies the household when Phil leaves the work zone.
  trigger:
  - platform: device
    device_id: c054264b79e6739a057236f3a3c512b4
    domain: device_tracker
    entity_id: device_tracker.sm_s908e
    type: leaves
    zone: zone.work
  condition: []
  action:
  - service: notify.mobile_app_slvdh
    metadata: {}
    data:
      message: Phil has left work
  mode: single
- id: '1682548783368'
  alias: Master Bedroom - Raise Blinds When Windy
  description: Raises the roller blinds when wind speed exceeds 40 and manual control
    is off.
  trigger:
  - platform: template
    value_template: '{{ state_attr(''weather.home'', ''wind_speed'') > 40}}'
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  action:
  - variables:
      original_position: '{{ states(''cover.roller_blinds_chan1'') }}'
  - service: cover.open_cover
    data: {}
    target:
      entity_id: cover.roller_blinds_chan1
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: 'Safety alert: high winds'
      message: Roller blinds up
  - wait_for_trigger:
    - platform: template
      value_template: '{{ state_attr(''weather.home'', ''wind_speed'') < 25 }}'
    continue_on_timeout: false
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: Wind speed reduced
      message: Blinds can go back down
  - action: "{% if original_position == 'closed' %}\n  cover.close_cover\n{% elif\
      \ original_position == 'open' %}\n  cover.open_cover\n{% else %}\n  cover.stop_cover\n\
      {% endif %}\n"
    target:
      entity_id: cover.roller_blinds_chan1
    alias: Restore Blinds to Previous Position
  mode: single
- id: '1684410637520'
  alias: Workday Desk Power Prompt
  description: Sends an actionable notification asking to power the computer desk
    at the start of a workday.
  use_blueprint:
    path: vorion/actionable-notifications-for-android.yaml
    input:
      notify_device: c054264b79e6739a057236f3a3c512b4
      trigger_entity: input_boolean.computer_switch
      notification_title: Workday Today
      notification_message: Want the computer desk on?
      persistent_notification: false
      action_1_title: 'On'
      first_action:
      - type: turn_on
        device_id: 399b754fdf1cb07ed6c2bfcf22f86dce
        entity_id: switch.computer_desk_light_socket_1
        domain: switch
      - service: input_boolean.turn_off
        target:
          entity_id:
          - input_boolean.computer_switch
        data: {}
      action_2_title: 'Off'
      second_action:
      - type: turn_off
        device_id: 399b754fdf1cb07ed6c2bfcf22f86dce
        entity_id: switch.computer_desk_light_socket_1
        domain: switch
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.computer_switch
      action_3_title: Delay 5 min
      third_action:
      - delay:
          hours: 0
          minutes: 5
          seconds: 0
          milliseconds: 0
- id: '1684787591500'
  alias: Alarmo Arming Prompt
  description: Sends an actionable notification to choose an Alarmo arming mode when
    prompted.
  use_blueprint:
    path: vorion/actionable-notifications-for-android.yaml
    input:
      notify_device: c054264b79e6739a057236f3a3c512b4
      trigger_entity: input_boolean.alarmo_actionable_notification
      notification_title: Alarm Setup
      action_1_title: Away
      first_action:
      - device_id: d0246dd7b63468505017ec29f63e3d86
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: arm_away
      action_2_title: Night
      second_action:
      - device_id: d0246dd7b63468505017ec29f63e3d86
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: arm_night
      action_3_title: Disarm
      third_action:
      - device_id: d0246dd7b63468505017ec29f63e3d86
        domain: alarm_control_panel
        entity_id: alarm_control_panel.alarmo
        type: disarm
- id: '1684789400363'
  alias: Morning Shutdown for Stray Lights
  description: Turns off selected lights shortly after sunrise if they were left on
    overnight.
  triggers:
  - event: sunrise
    offset: 00:15:00
    trigger: sun
  conditions: []
  actions:
  - data: {}
    target:
      area_id:
      - living_room
      - kitchen
      - master_bedroom
      - back_garden
      - front_entrance
    action: light.turn_off
  mode: single
- id: '1684973809451'
  alias: iOS Action Button Dispatcher
  description: Triggers the iOS notification blueprint when the dedicated button is
    pressed.
  use_blueprint:
    path: Hypercookie/ios_notification_blueprint.yaml
    input:
      trigger_source: input_button.iphone_notification
      message_content: Test
      message_text: Let Phil know you received
      badge_type: -1
      interruption_level: active
      message_attachment: Disabled
      camera_camera_entity: camera.bi_door_camera
      dummy_4: true
      action_1_action_enabled: true
      action_2_action_enabled: false
      action_1_title: Front door Cam
      camera_hide_thumbnail: false
      target_for_notifications: mobile_app_slvdh
      action_1_action_authentication_required: false
- id: '1685157513874'
  alias: Study Desk NFC - Toggle Desk Switch
  description: Toggles the study desk switch when its NFC tag is scanned.
  triggers:
  - tag_id: c99ee431-d1d8-497c-9f0f-214994610aa6
    trigger: tag
  conditions: []
  actions:
  - type: toggle
    device_id: ac27c1acd87d567603e54ed90f046a50
    entity_id: 41d147d319aab7615baeff5015237de7
    domain: switch
  mode: single
- id: '1685572749524'
  alias: Master Bedroom NFC - Control Blinds
  description: Runs blind control scripts when the bedroom NFC tag is scanned.
  trigger:
  - platform: tag
    tag_id: 531bec6b-8dea-4b53-ae0c-5840aca23f70
  condition: []
  action:
  - service: script.roller_blinds_up
    data: {}
    enabled: false
  - service: script.roller_blinds_down
    data: {}
  mode: single
- id: '1685791154995'
  alias: Sync People Home Helper
  description: Keeps the people_home helper aligned with the household occupancy state.
  triggers:
  - entity_id: input_select.occupancy
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: zone.home
        state: not_home
      sequence:
      - target:
          entity_id: input_boolean.people_home
        action: input_boolean.turn_off
        data: {}
    default:
    - target:
        entity_id: input_boolean.people_home
      action: input_boolean.turn_on
      data: {}
  mode: single
- id: '1685791243798'
  alias: Driveway Motion Snapshot for Phil
  description: Uses the blueprint to send Phil a driveway snapshot when motion is
    detected.
  use_blueprint:
    path: Stan-Gobien/CriticalCollapseOptionNotHomeMotionCameraSnapshotWithClickAction.yaml
    input:
      motion_sensor: binary_sensor.bi_driveway_motion
      camera: camera.driveway_cam_fluent
      notify_device: c054264b79e6739a057236f3a3c512b4
      is_critical: false
- id: '1690150562163'
  alias: Master Bedroom NFC - Heat and Lift Desk Corner
  description: Sets the bedroom climate to heat and opens blinds after a delay when
    that NFC tag is scanned.
  trigger:
  - platform: tag
    tag_id: 38314bff-f8ff-4949-908c-eab6853d970e
  condition: []
  action:
  - service: climate.set_temperature
    data:
      temperature: 22
      hvac_mode: heat
    target:
      area_id: master_bedroom
  - delay:
      hours: 3
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: script.roller_blinds_up
    data: {}
  mode: single
- id: '1693433717718'
  alias: Tag Masterbed - Close Blinds Halfway
  description: Tag Masterbed - Close Blinds Halfway
  trigger:
  - platform: tag
    tag_id: 9d687fe2-e6f7-4d6f-838a-cee2712e3fdb
  condition: []
  action:
  - service: script.1693262268843
    data: {}
  mode: single
- id: '1694596580092'
  alias: Living Room - Sync TV Power and Lighting
  description: Keeps the AV switch and bias lighting aligned with TV power events.
  trigger:
  - platform: device
    type: turned_on
    device_id: a54fb9a78133e7eec040eef4ca052fc9
    entity_id: d909cd5581bd5b7a73feef1654706ba8
    domain: remote
    id: 'On'
  - platform: device
    type: turned_off
    device_id: a54fb9a78133e7eec040eef4ca052fc9
    entity_id: d909cd5581bd5b7a73feef1654706ba8
    domain: remote
    id: 'Off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'On'
      sequence:
      - type: turn_on
        device_id: eda310c53d64fbfed9908fd266dc8635
        entity_id: f9c445a5c33e26e2b2d9ef2addd13858
        domain: switch
      - if:
        - condition: sun
          after: sunset
        then:
        - service: script.tv_lights_on
          data: {}
    - conditions:
      - condition: trigger
        id:
        - 'Off'
      sequence:
      - service: script.tv_lights_off
        data: {}
      - type: turn_off
        device_id: eda310c53d64fbfed9908fd266dc8635
        entity_id: f9c445a5c33e26e2b2d9ef2addd13858
        domain: switch
  mode: single
- id: '1695509359232'
  alias: Climate Flags - Mark Hot Day
  description: Sets the hot-day helper booleans based on the early-morning forecast.
    depending on the forecast
  triggers:
  - at: 04:30:00
    trigger: time
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.braybrook_temp_max_0
        above: 25
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.super_hot_today
        action: input_boolean.turn_on
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.hot_today_flag
    - conditions:
      - condition: numeric_state
        entity_id: sensor.braybrook_temp_max_0
        above: 21
      sequence:
      - data: {}
        target:
          entity_id: input_boolean.hot_today_flag
        action: input_boolean.turn_on
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.super_hot_today
    - conditions:
      - condition: numeric_state
        entity_id: sensor.braybrook_temp_max_0
        below: 22
      sequence:
      - data: {}
        target:
          entity_id:
          - input_boolean.hot_today_flag
          - input_boolean.super_hot_today
        action: input_boolean.turn_off
  mode: single
- id: '1699526539731'
  alias: Master Bedroom - Fan On When AC Starts
  description: Adjusts the master bedroom fan when the climate shifts between cooling
    and heating.
  triggers:
  - trigger: state
    entity_id: climate.masterbed_versatile_thermostat
    to: cool
    id: Cool
  - trigger: state
    entity_id: climate.masterbed_versatile_thermostat
    to: heat
    id: Heat
  condition: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: Cool
      - condition: state
        entity_id: fan.masterbedroom_fan
        state: 'off'
      sequence:
      - service: fan.set_percentage
        data:
          percentage: 33
        target:
          entity_id: fan.masterbedroom_fan
    - conditions:
      - condition: trigger
        id: Heat
      sequence:
      - service: fan.turn_off
        target:
          entity_id: fan.masterbedroom_fan
  mode: single
- id: '1700272627906'
  alias: Kitchen Display - Stream Front Door Camera
  description: Streams the front door camera to the kitchen display when motion is
    detected.
  triggers:
  - type: motion
    device_id: 323193309f2af00ef6853c8b84e00a9f
    entity_id: cc238a811938c75648c19a89e545d1b1
    domain: binary_sensor
    trigger: device
  conditions: []
  actions:
  - data:
      format: hls
      media_player: media_player.kitchen
    target:
      device_id:
      - 323193309f2af00ef6853c8b84e00a9f
    action: camera.play_stream
  mode: single
- id: '1703583740639'
  alias: Front Entrance - Motion-Activated Light
  description: Turns on the front entrance lights when motion is detected and switches
    them off after the timeout.
  triggers:
  - entity_id:
    - binary_sensor.motion_sensor_motion
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.motion_sensor_motion
    to: 'off'
    for:
      minutes: 2
    trigger: state
  conditions:
  - condition: numeric_state
    entity_id: sun.sun
    attribute: elevation
    below: 5
    enabled: false
  - type: is_illuminance
    condition: device
    device_id: ff182513e25375d3e31074d0caed8a9b
    entity_id: bbcd14c8d6ec6c74d00290784818aa79
    domain: sensor
    below: 10
  actions:
  - choose:
    - conditions:
      - condition: state
        state: 'on'
        entity_id: binary_sensor.motion_sensor_motion
      sequence:
      - data: {}
        action: light.turn_on
        target:
          area_id: front_entrance
    - conditions:
      - condition: state
        state: 'off'
        entity_id: binary_sensor.motion_sensor_motion
      sequence:
      - data: {}
        action: light.turn_off
        target:
          area_id: front_entrance
  mode: restart
- id: '1705440129170'
  alias: Living Room Remote - Mijia Switch Actions
  description: Maps the Mijia wireless remote events to lighting and scene shortcuts.
  triggers:
  - event_type: zha_event
    event_data:
      device_id: 5858e6f215e4bc4f5876cb1e82be3dd5
    trigger: event
  actions:
  - variables:
      click_type: '{{ trigger.event.data.args.click_type }}'
      attrname: '{{ trigger.event.data.args.attribute_name }}'
      value: '{{ trigger.event.data.args.attribute_value }}'
      command: '{{ trigger.event.data.command }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ attrname == ''on_off'' }}'
      - condition: template
        value_template: '{{ value == true }}'
      sequence:
      - wait_for_trigger:
        - event_type: zha_event
          event_data:
            device_id: 5858e6f215e4bc4f5876cb1e82be3dd5
            command: attribute_updated
            args:
              attribute_id: 0
              attribute_name: on_off
              value: false
          trigger: event
        continue_on_timeout: true
        timeout: 0.6
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ not wait.trigger }}'
          sequence:
          - device_id: 1237768e2dd98b4fd8a60455b374908d
            domain: light
            entity_id: 7341353cf94f589e859b6d7a8d463077
            type: brightness_increase
        default:
        - type: toggle
          device_id: 1237768e2dd98b4fd8a60455b374908d
          entity_id: 7341353cf94f589e859b6d7a8d463077
          domain: light
        - action: light.toggle
          metadata: {}
          data: {}
          enabled: false
    - conditions:
      - condition: template
        value_template: '{{ command == ''click'' }}'
      sequence:
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ click_type == ''double'' }}'
          sequence:
          - device_id: 1237768e2dd98b4fd8a60455b374908d
            domain: light
            entity_id: 7341353cf94f589e859b6d7a8d463077
            type: brightness_decrease
        - conditions:
          - condition: template
            value_template: '{{ click_type == ''triple'' }}'
          sequence: []
        - conditions:
          - condition: template
            value_template: '{{ click_type == ''quadruple'' }}'
          sequence: []
        - conditions:
          - condition: template
            value_template: '{{ click_type == ''furious'' }}'
          sequence: []
  mode: parallel
  max_exceeded: silent
- id: '1706063916168'
  alias: Leak Sensors - Notify on Water Detection
  description: Sends mobile notifications when the monitored leak sensors report water.
  trigger:
  - type: moist
    platform: device
    device_id: 31301cc533660d63d02b479ee7edfeb6
    entity_id: 3d7056108abc259f11cb5f9d88bce3bd
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: 8ff9a6d91d82ddd9e30bcb8f76356d9e
    entity_id: d5af43c0f1114b2e0d4f85f7f2602981
    domain: binary_sensor
  condition: []
  action:
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title: Water leak detected
      message: Water leak detected at front door or laundry
  - service: notify.mobile_app_slvdh
    data:
      title: Water leak detected
      message: Water leak detected at front door or laundry
  mode: single
- id: '1707129145582'
  alias: Curtains - Open Before Sunset
  description: Opens the curtains 20 minutes before sunset when the household is home.
  trigger:
  - platform: sun
    event: sunset
    offset: '-20'
    id: Before Sunset
    enabled: true
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Holiday
    alias: Not on Holiday
  - condition: time
    after: 08:00:00
  - condition: sun
    after: sunrise
  action:
  - action: cover.open_cover
    metadata: {}
    data: {}
    target:
      entity_id: cover.windowcovering_cover
  mode: single
- id: '1707562883987'
  alias: Study - Start Workday Desk Routine
  description: Turns on the study desk switch and preps climate when the workday toggle
    activates.
  triggers:
  - type: turned_on
    device_id: dc326b28df2064ab9f7d9e983e6824e6
    entity_id: 63cfcb8c97058003e378eefffdaa028b
    domain: switch
    id: 'On'
    trigger: device
  - type: turned_off
    device_id: dc326b28df2064ab9f7d9e983e6824e6
    entity_id: 63cfcb8c97058003e378eefffdaa028b
    domain: switch
    id: 'Off'
    trigger: device
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'On'
      sequence:
      - type: turn_on
        device_id: ac27c1acd87d567603e54ed90f046a50
        entity_id: 41d147d319aab7615baeff5015237de7
        domain: switch
      - data:
          temperature: 23
          hvac_mode: cool
        action: climate.set_temperature
        target:
          entity_id: climate.study_ac
    - conditions:
      - condition: trigger
        id:
        - 'Off'
      sequence:
      - type: turn_off
        device_id: ac27c1acd87d567603e54ed90f046a50
        entity_id: 41d147d319aab7615baeff5015237de7
        domain: switch
      - data:
          hvac_mode: 'off'
        action: climate.set_temperature
        target:
          entity_id: climate.study_ac
  mode: single
- id: '1710134062501'
  alias: Occupancy - Sync Presence Helper
  description: Mirrors the occupancy select state into the home presence helper booleans.
  trigger:
  - platform: state
    entity_id:
    - input_select.occupancy
    to: Home
    id: Home
    from: Away
  - platform: state
    entity_id:
    - input_select.occupancy
    to: Sleeping
    id: Home
    from: Away
  - platform: state
    entity_id:
    - input_select.occupancy
    id: Away
    from: Home
    to: Away
  - platform: state
    entity_id:
    - input_select.occupancy
    id: Away
    from: Sleeping
    to: Away
  - platform: state
    entity_id:
    - input_select.occupancy
    id: Away
    to: Holiday
  - platform: state
    entity_id:
    - input_select.occupancy
    id: Home
    from: Holiday
  condition: []
  action:
  - if:
    - condition: trigger
      id:
      - Home
    then:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.home_presence
      data: {}
  - if:
    - condition: trigger
      id:
      - Away
    then:
    - service: input_boolean.turn_off
      target:
        entity_id:
        - input_boolean.home_presence
      data: {}
  mode: single
- id: '1710137210171'
  alias: Climate - Track Downstairs Door State
  description: Maintains helper booleans based on the aggregated downstairs door contact
    sensor.
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.downstairs_doors
    to: 'on'
    id: Open
  - platform: state
    entity_id:
    - binary_sensor.downstairs_doors
    to: 'off'
    id: Close
  condition: []
  action:
  - alias: Open
    if:
    - condition: trigger
      id:
      - Open
    then:
    - service: input_boolean.turn_on
      target:
        entity_id:
        - input_boolean.downstairs_doors_open
      data: {}
  - alias: Close
    if:
    - condition: trigger
      id:
      - Close
    then:
    - service: input_boolean.turn_off
      target:
        entity_id:
        - input_boolean.downstairs_doors_open
      data: {}
  mode: single
- id: '1711621732424'
  alias: Maintenance - Clean Master Toilets
  description: Tracks master ensuite cleaning via weekly schedule or NFC tag scans.
  triggers:
  - alias: On schedule
    id: schedule
    at: 08:00:00
    trigger: time
  - alias: When associated NFC tag is scanned
    id: tag_scan
    tag_id: 14544260-abc9-4e84-be5b-20b3df57978d
    trigger: tag
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Home
    - condition: state
      entity_id: input_select.occupancy
      state: Sleeping
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: tag_scan
      sequence:
      - service: input_datetime.set_datetime
        target:
          entity_id: input_datetime.masterbed_toilet_last_cleaned
        data:
          timestamp: '{{ now().timestamp() }}'
      - service: notify.mobile_app_samsung_galaxy_s22_ultra
        data:
          title: Master ensuite cleaned
          message: Toilets marked as done
      - service: notify.mobile_app_slvdh
        data:
          title: Master ensuite cleaned
          message: Toilets marked as done
    - conditions:
      - condition: trigger
        id: schedule
      - condition: template
        value_template: '{{ (days_since_last_cleaned | int) >= interval_days }}'
      sequence:
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ overdue }}'
          sequence:
          - service: notify.mobile_app_samsung_galaxy_s22_ultra
            data:
              title: Master ensuite cleaning overdue
              message: Toilet cleanup is {{ overdue_days }} day(s) overdue.
          - service: notify.mobile_app_slvdh
            data:
              title: Master ensuite cleaning overdue
              message: Toilet cleanup is {{ overdue_days }} day(s) overdue.
        default:
        - service: notify.mobile_app_samsung_galaxy_s22_ultra
          data:
            title: Master ensuite cleaning due
            message: Toilets need cleaning today
        - service: notify.mobile_app_slvdh
          data:
            title: Master ensuite cleaning due
            message: Toilets need cleaning today
  mode: single
  max_exceeded: silent
  variables:
    tracker: input_datetime.masterbed_toilet_last_cleaned
    interval_days: 7
    days_since_last_cleaned: "{% set value = states(tracker) %} {% if value in ['unknown',\
      \ 'unavailable', ''] %}\n  {{ interval_days + 1 }}\n{% else %}\n  {% set last\
      \ = value | as_datetime %}\n  {{ (now().date() - last.date()).days }}\n{% endif\
      \ %}"
    overdue_days: '{% set diff = (days_since_last_cleaned | int) - interval_days %}
      {{ diff if diff > 0 else 0 }}'
    overdue: '{{ (days_since_last_cleaned | int) > interval_days }}'
- id: '1713092115962'
  alias: Nightly Garage Door Check
  description: Nightly Garage Door Check
  triggers:
  - entity_id:
    - cover.smart_garage_door_garage
    to: open
    trigger: state
    for:
      hours: 0
      minutes: 30
      seconds: 0
  - trigger: time
    at: '21:00:00'
  conditions:
  - condition: state
    entity_id: cover.smart_garage_door_garage
    state: open
  actions:
  - data:
      message: 'Garage Door open for {{ relative_time(states.binary_sensor.garage_door_alert_active.last_changed)
        }} \   Alerts on: Alerts on: {{ states.cover | selectattr(''entity_id'', ''eq'',
        ''cover.smart_garage_door_garage'') | selectattr(''state'', ''eq'', ''on'')
        | map(attribute=''attributes.friendly_name'') | list | join('', '') }} \  Triggered:
        {{ as_timestamp(states.binary_sensor.garage_door_alert_active.last_changed)
        | timestamp_custom(''%A %I:%M%p (%d-%b-%Y)'') }}

        '
      title: 7580 Info - Garage Door Open
    service: notify.STD_Information
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      message: Garage door left open
      data:
        actions:
        - action: CLOSE_GARAGE
          title: Close Garage Door
  - service: notify.mobile_app_slvdh
    data:
      message: Garage door left open
      data:
        actions:
        - action: CLOSE_GARAGE
          title: Close Garage Door
  mode: single
- id: '1714337117111'
  alias: Master Bedroom - Turn Off AC on Wake
  description: Shuts down the master bedroom climate equipment when wake-up sensors
    fire.
  triggers:
  - type: value
    device_id: c054264b79e6739a057236f3a3c512b4
    entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
    domain: sensor
    below: 80
    trigger: device
  - type: value
    device_id: 58e2eb1fec0eb5ec9ce450433d074fcf
    entity_id: sensor.slvdh_floors_descended
    domain: sensor
    above: 1
    trigger: device
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
    alias: Someone Home
  - condition: time
    after: 06:00:00
    before: 09:00:00
  - condition: state
    entity_id: input_boolean.climate_manual_control_master
    state: 'off'
  actions:
  - metadata: {}
    data:
      hvac_mode: 'off'
    action: climate.set_hvac_mode
    target:
      area_id: master_bedroom
  - metadata: {}
    data: {}
    action: fan.turn_off
    target:
      area_id: master_bedroom
  - action: climate.turn_off
    metadata: {}
    data: {}
    target:
      area_id: henry_s_room
  mode: single
- id: '1714895967504'
  alias: Master Bedroom - Boost Cooling When Hot
  description: Runs fan and blind scripts when the bedroom temperature climbs above
    comfort thresholds.
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.ble_temperature_masterbed_temp_humidity_sensor
    above: 22
  condition:
  - condition: sun
    before: sunset
    after: sunrise
  action:
  - service: fan.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: fan.masterbedroom_fan
  - service: script.1693262268843
    metadata: {}
    data: {}
  mode: single
- id: '1716152338300'
  alias: Alarmo - Disarm When Household Awake
  description: Disarms Alarmo when someone wakes up during the early-morning routine.
  trigger:
  - type: value
    platform: device
    device_id: c054264b79e6739a057236f3a3c512b4
    entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
    domain: sensor
    below: 80
  - type: value
    platform: device
    device_id: 58e2eb1fec0eb5ec9ce450433d074fcf
    entity_id: sensor.slvdh_floors_descended
    domain: sensor
    above: 1
  - platform: time
    at: 07:00:00
  condition:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
    alias: Someone Home
  - condition: state
    entity_id: alarm_control_panel.alarmo
    state: armed_night
  action:
  - service: alarmo.disarm
    metadata: {}
    data:
      entity_id: alarm_control_panel.alarmo
  mode: single
- id: '1718513507860'
  alias: Media - Toggle Amp and Backlight
  description: Synchronises the media amplifier outlet and TV backlight with remote
    power events. TV backlights if it is after sundown
  triggers:
  - entity_id: remote.sony_kd_55x8500c
    from: 'off'
    to: 'on'
    id: tv_on
    trigger: state
  - entity_id: remote.sony_kd_55x8500c
    from: 'on'
    to: 'off'
    id: tv_off
    trigger: state
  - event: sunset
    offset: 0
    trigger: sun
  - entity_id: remote.sony_kd_55x8500c
    to: unavailable
    id: tv_unavailable
    trigger: state
  conditions: []
  actions:
  - alias: Amp and backlight on/off
    choose:
    - conditions:
      - condition: trigger
        id: tv_on
      sequence:
      - condition: sun
        after: sunset
        before: sunrise
      - action: light.turn_on
        target:
          entity_id: light.tv_backlight
        data: {}
    - conditions:
      - condition: trigger
        id: tv_off
      sequence:
      - action: light.turn_off
        target:
          entity_id: light.tv_backlight
        data: {}
    - conditions:
      - condition: trigger
        id: tv_unavailable
      sequence:
      - action: light.turn_off
        target:
          entity_id: light.tv_backlight
        data: {}
  mode: single
- id: '1721641437270'
  alias: Covers - Refresh Roller Blind Positions
  description: Periodically polls the roller blinds to keep positions accurate in
    Home Assistant.
  trigger:
  - platform: time_pattern
    seconds: /30
  condition:
  - condition: state
    entity_id: timer.roller_blind_timer
    state: active
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: cover.roller_blinds_chan1
        state: opening
      sequence:
      - service: input_number.set_value
        data_template:
          entity_id: input_number.roller_blind_position
          value: '{{ [states(''input_number.roller_blind_position'')|int + (100 /
            30), 100] | min }}

            '
    - conditions:
      - condition: state
        entity_id: cover.roller_blinds_chan1
        state: closing
      sequence:
      - service: input_number.set_value
        data_template:
          entity_id: input_number.roller_blind_position
          value: '{{ [states(''input_number.roller_blind_position'')|int - (100 /
            30), 0] | max }}

            '
- id: '1723799786022'
  alias: Master Bedroom - Close Blinds and Curtains When Hot
  description: Closes bedroom blinds and curtains with escalating responses based
    on indoor heat.
  triggers:
  - at: input_datetime.wakeup_time_phil_steph
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
  actions:
  - alias: Blinds closed if hot
    choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.super_hot_today
        state: 'on'
      sequence:
      - action: cover.close_cover
        metadata: {}
        data: {}
        target:
          entity_id:
          - cover.roller_blinds_chan1
          - cover.windowcovering_cover
      alias: Superhot
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: input_boolean.hot_today_flag
          state: 'on'
        - condition: state
          entity_id: input_boolean.super_hot_today
          state: 'off'
      sequence:
      - action: cover.set_cover_position
        target:
          entity_id:
          - cover.windowcovering_cover
        data:
          position: 60
      alias: Hot
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: input_boolean.hot_today_flag
          state: 'off'
        - condition: state
          entity_id: input_boolean.super_hot_today
          state: 'off'
      sequence:
      - action: cover.open_cover
        metadata: {}
        data: {}
        target:
          entity_id:
          - cover.roller_blinds_chan1
          - cover.windowcovering_cover
      alias: Not Hot
  mode: single
- id: '1724061115527'
  alias: Henry's Room - Heater Night Routine
  description: Keeps Henry's room heater running overnight when temperatures drop.
    Winter automation
  triggers:
  - entity_id:
    - sensor.study_esp32_henrysroom_temperature
    for:
      hours: 0
      minutes: 0
      seconds: 0
    above: 20.1
    id: Hot
    trigger: numeric_state
  - entity_id:
    - sensor.study_esp32_henrysroom_temperature
    for:
      hours: 0
      minutes: 0
      seconds: 0
    below: 19.7
    id: Cold
    trigger: numeric_state
  conditions:
  - condition: time
    after: '18:00:00'
    before: 06:00:00
    weekday:
    - sun
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Holiday
  - condition: state
    entity_id: input_boolean.climate_manual_control_study
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Hot
      sequence:
      - metadata: {}
        data:
          hvac_mode: 'off'
        action: climate.set_hvac_mode
        target:
          entity_id: climate.henry_s_room_versatile_thermostat
    - conditions:
      - condition: trigger
        id:
        - Cold
      sequence:
      - metadata: {}
        data:
          preset_mode: eco
        action: climate.set_preset_mode
        target:
          entity_id: climate.henry_s_room_versatile_thermostat
      - metadata: {}
        data:
          hvac_mode: heat
        action: climate.set_hvac_mode
        target:
          entity_id: climate.henry_s_room_versatile_thermostat
  mode: single
- id: '1724225427107'
  alias: Master Bedroom - Update Sleeping Status
  description: Updates the master sleeping helper using sleep confidence metrics.
    false
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.samsung_galaxy_s22_ultra_sleep_confidence
    above: 85
    for:
      minutes: 15
    id: Phil Sleeping
  - platform: numeric_state
    entity_id:
    - sensor.samsung_galaxy_s22_ultra_sleep_confidence
    below: 85
    id: Phil Not Sleeping
  - platform: numeric_state
    entity_id:
    - sensor.slvdh_battery_level
    for:
      minutes: 15
    above: 80
    id: Steph Sleeping
  - platform: numeric_state
    entity_id:
    - sensor.slvdh_floors_ascended
    above: 1
    enabled: false
  - platform: state
    entity_id:
    - sensor.slvdh_battery_state
    to: Charging
    enabled: false
  - platform: numeric_state
    entity_id:
    - sensor.slvdh_battery_level
    below: 90
    for:
      minutes: 15
    id: Steph Not Sleeping
  condition: []
  action:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
        above: 85
      - condition: numeric_state
        entity_id: sensor.slvdh_battery_level
        above: 80
      sequence:
      - target:
          entity_id: input_boolean.masterbed_sleeping
        action: input_boolean.turn_on
        data: {}
    - conditions: []
      sequence:
      - target:
          entity_id: input_boolean.masterbed_sleeping
        action: input_boolean.turn_off
        data: {}
  mode: single
- id: '1730921531314'
  alias: Living Room - Keep IR Controller Powered
  description: Ensures the living room IR controller USB power outlets stay on. on
    - converted to state trigger from polling
  triggers:
  - trigger: state
    entity_id:
    - 5988af91837e47236db524998627e65e
    - 4e12ee54d94d1ad1c2db1176f6da428d
    to: 'off'
    for:
      seconds: 30
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: device
        type: is_off
        device_id: 232fc839ce53ebd06b58a471c2412ad2
        entity_id: 5988af91837e47236db524998627e65e
        domain: switch
      sequence:
      - type: turn_on
        device_id: 232fc839ce53ebd06b58a471c2412ad2
        entity_id: 5988af91837e47236db524998627e65e
        domain: switch
    - conditions:
      - condition: device
        type: is_off
        device_id: 399b754fdf1cb07ed6c2bfcf22f86dce
        entity_id: 4e12ee54d94d1ad1c2db1176f6da428d
        domain: switch
      sequence:
      - type: turn_on
        device_id: 232fc839ce53ebd06b58a471c2412ad2
        entity_id: 5988af91837e47236db524998627e65e
        domain: switch
  mode: single
- id: '1732241510110'
  alias: Living Room - Adjust Floor Lamp for Solar Output
  description: Dims or brightens the living room floor lamp based on available solar
    production.
  triggers:
  - entity_id: sensor.gosungrow_virtual_1205796_1_1_1_p24
    trigger: state
  - at: '16:00:00'
    trigger: time
  conditions:
  - condition: time
    after: 06:00:00
    before: '16:00:00'
  actions:
  - choose:
    - conditions:
      - condition: time
        after: 06:00:00
        before: '16:00:00'
      sequence:
      - target:
          device_id: fee3e1405cfa62d116d3f31ec12a9618
        data:
          rgb_color:
          - 0
          - 255
          - 0
          brightness_pct: '{% set production = states(''sensor.gosungrow_virtual_1205796_1_1_1_p24'')
            | float %} {{ (production / 5.5 * 100) | int if production >= 0 else 0
            }}

            '
        action: light.turn_on
    - conditions: []
      sequence:
      - target:
          device_id: fee3e1405cfa62d116d3f31ec12a9618
        action: light.turn_off
  mode: single
- id: '1732435588125'
  alias: Laundry - Washing Machine Notifications & Actions
  description: Uses the appliance blueprint to notify and automate around the washing
    machine cycle.
  use_blueprint:
    path: Blackshome/appliance-notifications.yaml
    input:
      running_dead_zone: 0
      start_notify_device:
      - c054264b79e6739a057236f3a3c512b4
      - 58e2eb1fec0eb5ec9ce450433d074fcf
      include_end_notify: enable_end_notify_options
      end_notify_device:
      - 58e2eb1fec0eb5ec9ce450433d074fcf
      - c054264b79e6739a057236f3a3c512b4
      end_reminder_notification: disable_reminder_notification
      include_power_tracking: enable_power_tracking
      include_duration_tracking: enable_duration_tracking
      start_notify_data:
      - channel
      start_notify_channel: Laundry
      end_notify_data:
      - channel
      end_notify_channel: Laundry
      power_consumption_sensor: sensor.washing_machine_power_plug_summation_delivered
      include_custom_actions:
      - enable_end_custom_actions
      - enable_start_custom_actions
      start_custom_actions:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.washing_machine_on
      - action: media_player.play_media
        target:
          entity_id: media_player.kitchen
        data:
          media:
            media_content_id: media-source://media_source/local/audioclips/makemyclothesniceandclean.aac
            media_content_type: audio/x-aac
            metadata:
              title: makemyclothesniceandclean.aac
              thumbnail: null
              media_class: music
              children_media_class: null
              navigateIds:
              - {}
              - media_content_type: app
                media_content_id: media-source://media_source
              - media_content_type: ''
                media_content_id: media-source://media_source/local/audioclips
              browse_entity_id: media_player.kitchen
      end_custom_actions:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.washing_machine_on
      - action: tts.google_translate_say
        metadata: {}
        data:
          cache: false
          entity_id: media_player.kitchen
          message: '{{ states(''sensor.washing_machine_random_message'') }}'
      - action: tts.google_translate_say
        metadata: {}
        data:
          cache: false
          entity_id: media_player.study_speaker
          message: '{{ states(''sensor.washing_machine_random_message'') }}'
      - choose:
        - conditions:
          - condition: time
            after: 08:00:00
            before: '20:00:00'
          - condition: template
            value_template: '{{ expand(area_entities(''master_bedroom'')) | selectattr(''domain'',
              ''eq'', ''light'') | selectattr(''state'', ''eq'', ''on'') | list |
              count > 0 }}'
          sequence:
          - action: tts.google_translate_say
            metadata: {}
            data:
              cache: false
              entity_id: media_player.master_bedroom_speaker
              message: '{{ states(''sensor.washing_machine_random_message'') }}'
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - action: media_player.play_media
        target:
          entity_id: media_player.kitchen
        data:
          media:
            media_content_id: media-source://media_source/local/Memes/image1.jpg
            media_content_type: image/jpeg
            metadata:
              title: image1.jpg
              thumbnail: null
              media_class: image
              children_media_class: null
              navigateIds:
              - {}
              - media_content_type: app
                media_content_id: media-source://media_source
              - media_content_type: ''
                media_content_id: media-source://media_source/local/Memes
      - delay:
          hours: 0
          minutes: 15
          seconds: 0
          milliseconds: 0
      - action: media_player.turn_off
        metadata: {}
        data: {}
        target:
          device_id: 38066f3083671e091a033c27c46cc53c
      start_appliance_power: 10
      include_start_notify: enable_start_notify_options
      end_appliance_power: 10
      end_time_delay: 1
      start_time_delay: 1
      end_repeat_count: 1
      start_message: YES! Another load of washing is ON :)
      start_power_consumption: input_number.washing_power_tracker_kwh
      end_power_consumption: input_number.washing_power_tracker_end_kwh
      start_notify_interruption_level: passive
      end_notify_interruption_level: passive
      global_conditions:
      - condition: state
        entity_id: input_boolean.master_automation_killswitch
        state: 'off'
      power_sensor: sensor.washing_machine_power_plug_power
- id: '1732614031949'
  alias: Garden - Run Sprinklers at Sunrise if Hot
  description: Runs the sprinkler zone for hot days at sunrise when extreme heat is
    forecast.
  triggers:
  - trigger: sun
    event: sunrise
    offset: 0
  conditions:
  - condition: state
    entity_id: input_boolean.super_hot_today
    state: 'on'
  actions:
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      device_id: 7f15e0de838d7d32254c9598ce75aa10
  - delay:
      hours: 0
      minutes: 20
      seconds: 0
      milliseconds: 0
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      device_id: 7f15e0de838d7d32254c9598ce75aa10
  mode: single
- id: '1733691257280'
  alias: Holiday Lights - Turn On Morning Routine
  description: Starts the morning run of the Christmas lights during the season.
  triggers:
  - trigger: time
    at: 05:30:00
  conditions: []
  actions:
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: light.xmas_lights_plug_socket_1
  mode: single
- id: '1735426056624'
  alias: Occupancy - Set Holiday Mode from Alarmo
  description: Sets the occupancy selector to Holiday whenever Alarmo enters the holiday
    state.
  triggers:
  - trigger: state
    entity_id:
    - alarm_control_panel.alarmo
    to: armed_vacation
  conditions: []
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Holiday
    target:
      entity_id: input_select.occupancy
  mode: single
- id: '1735867240188'
  alias: Irrigation - Limit Watering to 10 Minutes
  description: Stops the irrigation run after ten minutes to prevent over-watering.
  triggers:
  - type: turned_on
    device_id: 7f15e0de838d7d32254c9598ce75aa10
    entity_id: 9b99b8ca53b6982903c65cd267091adf
    domain: switch
    trigger: device
  conditions: []
  actions:
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - type: turn_off
    device_id: 7f15e0de838d7d32254c9598ce75aa10
    entity_id: 9b99b8ca53b6982903c65cd267091adf
    domain: switch
  mode: single
- id: '1735955632537'
  alias: Laundry - Dryer Notifications & Actions
  description: Uses the appliance blueprint to notify and automate around the dryer
    cycle.
  use_blueprint:
    path: Blackshome/appliance-notifications.yaml
    input:
      power_sensor: sensor.dryer_power_plug_power
      start_notify_device:
      - c054264b79e6739a057236f3a3c512b4
      - 58e2eb1fec0eb5ec9ce450433d074fcf
      include_start_notify: enable_start_notify_options
      start_notify_data:
      - channel
      start_notify_channel: Washing
      include_end_notify: enable_end_notify_options
      end_notify_device:
      - c054264b79e6739a057236f3a3c512b4
      - 58e2eb1fec0eb5ec9ce450433d074fcf
      end_notify_interruption_level: passive
      end_notify_data:
      - channel
      end_notify_channel: Washing
      end_message: Dryer is finished!
      start_message: YES! Another dryer load is ON :)
      include_power_tracking: enable_power_tracking
      power_consumption_sensor: sensor.dryer_power_plug_summation_delivered
      include_duration_tracking: enable_duration_tracking
      include_custom_actions:
      - enable_end_custom_actions
      - enable_start_custom_actions
      end_custom_actions:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.dryer_on
      - action: tts.google_translate_say
        metadata: {}
        data:
          cache: false
          entity_id: media_player.kitchen
          message: '{{ states(''sensor.dryer_random_message'') }}'
      - action: tts.google_translate_say
        metadata: {}
        data:
          cache: false
          entity_id: media_player.study_speaker
          message: '{{ states(''sensor.dryer_random_message'') }}'
      - choose:
        - conditions:
          - condition: time
            after: 08:00:00
            before: '20:00:00'
          - condition: template
            value_template: '{{ expand(area_entities(''master_bedroom'')) | selectattr(''domain'',
              ''eq'', ''light'') | selectattr(''state'', ''eq'', ''on'') | list |
              count > 0 }}'
          sequence:
          - action: tts.google_translate_say
            metadata: {}
            data:
              cache: false
              entity_id: media_player.master_bedroom_speaker
              message: '{{ states(''sensor.dryer_random_message'') }}'
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - action: media_player.play_media
        target:
          entity_id: media_player.kitchen
        data:
          media:
            media_content_id: media-source://media_source/local/Memes/images.jpg
            media_content_type: image/jpeg
            metadata:
              title: images.jpg
              thumbnail: null
              media_class: image
              children_media_class: null
              navigateIds:
              - {}
              - media_content_type: app
                media_content_id: media-source://media_source
              - media_content_type: ''
                media_content_id: media-source://media_source/local/Memes
      - action: media_player.play_media
        target:
          entity_id: media_player.kitchen
        data:
          media:
            media_content_id: media-source://media_source/local/audioclips/the washing
              is done.aac
            media_content_type: audio/x-aac
            metadata:
              title: the washing is done.aac
              thumbnail: null
              media_class: music
              children_media_class: null
              navigateIds:
              - {}
              - media_content_type: app
                media_content_id: media-source://media_source
              - media_content_type: ''
                media_content_id: media-source://media_source/local/audioclips
              browse_entity_id: media_player.kitchen
      - delay:
          hours: 0
          minutes: 15
          seconds: 0
          milliseconds: 0
      - action: media_player.turn_off
        metadata: {}
        data: {}
        target:
          device_id: 38066f3083671e091a033c27c46cc53c
      end_appliance_power: 14
      start_custom_actions:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.dryer_on
      watchdog_custom_actions: []
      end_time_delay: 0.5
      start_title: Dryer
      end_message_title: Dryer
      start_appliance_power: 10
      start_power_consumption: input_number.start_dryer_power_tracker
      end_power_consumption: input_number.end_dryer_power_tracker_kwh
      start_notify_interruption_level: passive
      end_reminder_notification_max_count: 1
      start_time_delay: 0.5
      include_watchdog: enable_watchdog
      watchdog_timeframe:
        hours: 5
        minutes: 0
        seconds: 0
      watchdog_message: Uh-oh! Time to check the dry
      watchdog_notify_data:
      - channel
      watchdog_notify_channel: Washing
      global_conditions:
      - condition: state
        entity_id: input_boolean.master_automation_killswitch
        state: 'off'
      running_dead_zone: 1
- id: '1738224719290'
  alias: Master Bedroom Remote - Control Reading Light
  description: Maps bedside remote presses to toggling and dimming the reading light.
  triggers:
  - device_id: f085406cb09d1a8a9f10f0b500c48ebe
    domain: zha
    type: remote_button_short_press
    subtype: button_1
    trigger: device
    id: Once
  - device_id: f085406cb09d1a8a9f10f0b500c48ebe
    domain: zha
    type: remote_button_long_press
    subtype: button_1
    trigger: device
    id: Held
  - device_id: f085406cb09d1a8a9f10f0b500c48ebe
    domain: zha
    type: remote_button_double_press
    subtype: button_1
    trigger: device
    id: Double
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Once
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          device_id: 18551c9b3c72efc901c3e35633c1e3c7
    - conditions:
      - condition: trigger
        id:
        - Double
      sequence:
      - choose:
        - conditions:
          - condition: or
            conditions:
            - condition: state
              entity_id: light.computer_desk_light_socket_1
              state: 'on'
            - condition: state
              entity_id: light.reading_light
              state: 'on'
            - condition: state
              entity_id: light.sleeping_light_2
              state: 'on'
          sequence:
          - action: light.turn_off
            metadata: {}
            data: {}
            target:
              area_id: master_bedroom
        default:
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            area_id: master_bedroom
  mode: single
- id: '1738226362136'
  alias: Master Bedroom Remote - Control Sleeping Light
  description: Maps bedside remote presses to control the sleeping light brightness
    and power.
  triggers:
  - device_id: 8c730c300afc8f900acf8e9782eb6d62
    domain: zha
    type: remote_button_short_press
    subtype: button_1
    trigger: device
    id: Once
  - device_id: 8c730c300afc8f900acf8e9782eb6d62
    domain: zha
    type: remote_button_double_press
    subtype: button_1
    trigger: device
    id: Double
  - device_id: 8c730c300afc8f900acf8e9782eb6d62
    domain: zha
    type: remote_button_short_press
    subtype: button
    trigger: device
    id: Once
    enabled: false
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Once
      sequence:
      - action: light.toggle
        metadata: {}
        data: {}
        target:
          device_id:
          - 3cf9c8bc5367cd26edc9b128e7303916
    - conditions:
      - condition: trigger
        id:
        - Double
      sequence:
      - choose:
        - conditions:
          - condition: or
            conditions:
            - condition: state
              entity_id: light.computer_desk_light_socket_1
              state: 'on'
            - condition: state
              entity_id: light.reading_light
              state: 'on'
            - condition: state
              entity_id: light.sleeping_light_2
              state: 'on'
          sequence:
          - action: light.turn_off
            metadata: {}
            data: {}
            target:
              area_id: master_bedroom
        default:
        - action: light.turn_on
          metadata: {}
          data: {}
          target:
            area_id: master_bedroom
  mode: single
- id: '1738720805420'
  alias: Master Bedroom Remote - Toggle Room Lighting
  description: Uses the bedside remote to toggle the master bedroom lighting group.
  triggers:
  - device_id: f085406cb09d1a8a9f10f0b500c48ebe
    domain: zha
    type: remote_button_short_press
    subtype: button
    trigger: device
    enabled: false
  - device_id: 8cb8be820d24cc85cc448e17a28fb15d
    domain: zha
    type: remote_button_short_press
    subtype: button
    trigger: device
    id: Once
  - device_id: 8cb8be820d24cc85cc448e17a28fb15d
    domain: zha
    type: remote_button_short_press
    subtype: button_1
    trigger: device
    id: Held
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: light.reading_light
          state: 'on'
        - condition: state
          entity_id: light.sleeping_light_2
          state: 'on'
        - condition: state
          entity_id: switch.computer_desk_light_child_lock
          state: 'on'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: master_bedroom
    default:
    - action: light.turn_on
      metadata: {}
      data: {}
      target:
        area_id: master_bedroom
  mode: single
- id: '1738899778775'
  alias: Study Remote - Toggle Computer Desk
  description: Lets the spare remote toggle the study computer desk smart switch.
    having to pull out a phone
  triggers:
  - device_id: a957c4c649b876f99732f7bd44193c43
    domain: zha
    type: remote_button_short_press
    subtype: button_1
    trigger: device
  conditions: []
  actions:
  - action: switch.toggle
    metadata: {}
    data: {}
    target:
      device_id: ac27c1acd87d567603e54ed90f046a50
  mode: single
- id: '1740132306652'
  alias: Laundry - Dishwasher Notifications & Actions
  description: Sends start and finish notifications for the dishwasher based on power
    usage. run
  use_blueprint:
    path: Blackshome/appliance-notifications.yaml
    input:
      end_power_consumption: input_number.dishwasher_power_tracker_end
      start_appliance_power: 15
      include_start_notify: enable_start_notify_options
      start_notify_device:
      - 58e2eb1fec0eb5ec9ce450433d074fcf
      - c054264b79e6739a057236f3a3c512b4
      start_title: Dishwasher
      start_message: YES! The dishwasher is on
      start_notify_interruption_level: passive
      start_notify_data: []
      include_end_notify: enable_end_notify_options
      end_notify_device:
      - 58e2eb1fec0eb5ec9ce450433d074fcf
      - c054264b79e6739a057236f3a3c512b4
      end_message_title: Dishwasher
      end_message: Unpack the dishwasher - it's done!
      include_power_tracking: enable_power_tracking
      power_consumption_sensor: sensor.dishwasher_smart_plug_consumption
      start_power_consumption: input_number.dishwasher_power_tracker_start
      include_duration_tracking: enable_duration_tracking
      include_custom_actions:
      - enable_start_custom_actions
      - enable_end_custom_actions
      start_custom_actions:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.dishwasher_on
      end_custom_actions:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.dishwasher_on
      - action: media_player.play_media
        target:
          entity_id: media_player.kitchen
        data:
          media:
            media_content_id: media-source://media_source/local/audioclips/clean the
              dishes ya filthy animal.aac
            media_content_type: audio/x-aac
            metadata:
              title: clean the dishes ya filthy animal.aac
              thumbnail: null
              media_class: music
              children_media_class: null
              navigateIds:
              - {}
              - media_content_type: app
                media_content_id: media-source://media_source
              - media_content_type: ''
                media_content_id: media-source://media_source/local/audioclips
              browse_entity_id: media_player.kitchen
      global_conditions:
      - condition: state
        entity_id: input_boolean.master_automation_killswitch
        state: 'off'
      end_appliance_power: 13
      include_watchdog: disable_watchdog
      running_dead_zone: 3
      power_sensor: sensor.smart_plug_power
      end_notify_data:
      - channel
      end_notify_channel: Dishwasher
      end_reminder_notification_message: Hey! Your dishes are ready, don't leave it
        to get mouldy!
      end_time_delay: 15
      start_time_delay: 0.5
      include_cycle_counter: enable_cycle_counter_and_notify
      cycle_counter_helper: counter.dishwasher_counter
      include_service_reminder: enable_service_reminder
      service_reminder_counter_helper: counter.dishwasher_counter
- id: '1740211475857'
  alias: Otto's Room - Night Door Alert
  description: Announces when Otto's door opens during quiet hours or while the door
    alarm is active.
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.otto_room_door_sensor_opening
    to: 'on'
    from: 'off'
    for:
      seconds: 2
  conditions:
  - condition: state
    entity_id: input_boolean.otto_automation_killswitch
    state: 'off'
  - condition: state
    entity_id: input_boolean.master_automation_killswitch
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.otto_door_alarm_active
      state: 'on'
    - condition: time
      after: '19:00:00'
      before: '22:30:00'
  actions:
  - action: tts.cloud_say
    metadata: {}
    data:
      cache: false
      entity_id: media_player.kitchen
      message: Otto's doors open
  - action: tts.cloud_say
    metadata: {}
    data:
      cache: false
      entity_id: media_player.study_speaker
      message: Otto's doors open
  - choose:
    - conditions:
      - condition: time
        after: 08:00:00
        before: '20:00:00'
      - condition: template
        value_template: '{{ expand(area_entities(''master_bedroom'')) | selectattr(''domain'',
          ''eq'', ''light'') | selectattr(''state'', ''eq'', ''on'') | list | count
          > 0 }}'
      sequence:
      - action: tts.cloud_say
        metadata: {}
        data:
          cache: false
          entity_id: media_player.master_bedroom_speaker
          message: Otto's doors open
  - action: light.toggle
    metadata: {}
    data: {}
    target:
      area_id:
      - master_bedroom
      - living_room
      - front_entrance
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: light.toggle
    metadata: {}
    data: {}
    target:
      area_id:
      - master_bedroom
      - living_room
      - front_entrance
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.ottos_door_open
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.otto_room_door_sensor_opening
      to: 'off'
    continue_on_timeout: true
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.ottos_door_open
  mode: single
- id: '1740797986690'
  alias: Front Door - Snapshot Notification for Steph
  description: Delivers front door snapshots to Steph when driveway motion is detected.
  use_blueprint:
    path: Stan-Gobien/CriticalCollapseOptionNotHomeMotionCameraSnapshotWithClickAction.yaml
    input:
      motion_sensor: binary_sensor.bi_front_door_camera_motion
      camera: camera.bi_front_door_camera
      notify_device: 58e2eb1fec0eb5ec9ce450433d074fcf
      blocker_entity: input_boolean.people_home
      is_critical: false
- id: '1742615433146'
  alias: Maintenance - Update Cleaning Timestamp via NFC
  description: Records the last-cleaned timestamps when toilet maintenance NFC tags
    are scanned.
  triggers:
  - tag_id: 859e3818-e623-47aa-9062-d89afd44489b
    id: main_toilet
    trigger: tag
  - tag_id: 14544260-abc9-4e84-be5b-20b3df57978d
    id: masterbed_toilet
    trigger: tag
  - tag_id: 0dba78a1-9dd0-439b-9d5b-386fa0f5df85
    id: omas_toilet
    trigger: tag
  - tag_id: 69410df3-68be-4aec-9721-f933de3c73de
    id: kids_toilet
    trigger: tag
  actions:
  - data:
      name: RFID Debug
      message: 'Trigger ID: {{ trigger.id }}'
    service: logbook.log
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.id == ''main_toilet'' }}'
      sequence:
      - target:
          entity_id: input_datetime.main_toilet_last_cleaned
        data:
          timestamp: '{{ now().timestamp() }}'
        service: input_datetime.set_datetime
    - conditions:
      - condition: template
        value_template: '{{ trigger.id == ''masterbed_toilet'' }}'
      sequence:
      - target:
          entity_id: input_datetime.masterbed_toilet_last_cleaned
        data:
          timestamp: '{{ now().timestamp() }}'
        service: input_datetime.set_datetime
    - conditions:
      - condition: template
        value_template: '{{ trigger.id == ''omas_toilet'' }}'
      sequence:
      - target:
          entity_id: input_datetime.omas_toilet_last_cleaned
        data:
          timestamp: '{{ now().timestamp() }}'
        service: input_datetime.set_datetime
    - conditions:
      - condition: template
        value_template: '{{ trigger.id == ''kids_toilet'' }}'
      sequence:
      - target:
          entity_id: input_datetime.kids_toilet_last_cleaned
        data:
          timestamp: '{{ now().timestamp() }}'
        service: input_datetime.set_datetime
  mode: single
- id: '1744580704061'
  alias: Aquarium NFC - Log Feeding Time
  description: Updates the fish feeding timestamp when the aquarium NFC tag is scanned.
  triggers:
  - tag_id: 8bc95efa-4e0c-410c-93a1-dea4085761ee
    trigger: tag
  actions:
  - target:
      entity_id: input_datetime.fish_last_fed
    data:
      datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
    action: input_datetime.set_datetime
  mode: single
- id: '1744580844831'
  alias: Aquarium - Morning Feed Reminder
  description: Reminds the household at 8am if the fish haven't been fed.
  triggers:
  - at: 08:00:00
    trigger: time
  conditions:
  - condition: or
    conditions:
    - condition: template
      value_template: '{% set fed = states(''input_datetime.fish_last_fed'') %} {%
        set now_date = now().date() %} {% set fed_time = as_datetime(fed) %} {{ fed_time.date()
        != now_date or fed_time.hour < 6 or fed_time.hour >= 8 }}

        '
  actions:
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      message: Fish aren't fed - morning
  - service: notify.mobile_app_slvdh
    data:
      message: Fish aren't fed - morning
  mode: single
- id: '1744580871551'
  alias: Aquarium - Dinner Feed Reminder
  description: Reminds the household at 9pm if the fish haven't been fed.
  triggers:
  - at: '21:00:00'
    trigger: time
  conditions:
  - condition: template
    value_template: '{% set fed = states(''input_datetime.fish_last_fed'') %} {% set
      now_date = now().date() %} {% set fed_time = as_datetime(fed) %} {{ fed_time.date()
      != now_date or fed_time.hour < 16 or fed_time.hour >= 21 }}

      '
  actions:
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      message: Fish aren't fed - dinner
  - service: notify.mobile_app_slvdh
    data:
      message: Fish aren't fed - dinner
  mode: single
- id: '1746997822978'
  alias: Living Room - Turn Off Heater When Warm
  description: Shuts off the living room heater once the room reaches the comfort
    temperature.
  triggers:
  - trigger: time
    at: 06:30:00
  - trigger: time
    at: 07:00:00
  - trigger: time
    at: 07:30:00
  - trigger: time
    at: 06:00:00
  conditions:
  - condition: state
    entity_id: climate.living_room_ac
    state: heat
    for:
      hours: 0
      minutes: 30
      seconds: 0
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.living_room_temperature_offset
      above: 20
    - condition: numeric_state
      entity_id: sensor.ble_temperature_kitchen_temp_humidity_sensor
      above: 20
  - condition: state
    entity_id: input_boolean.climate_manual_control_living
    state: 'off'
  actions:
  - device_id: b084d1fcd04470308deb597901c61d5c
    domain: climate
    entity_id: 919759f355a72fa8f73dfe61b55457b2
    type: set_hvac_mode
    hvac_mode: 'off'
  mode: single
- id: '1747602506171'
  alias: Otto's Room - Heater Night Routine
  description: Keeps Otto's heater running overnight when the room is cold. Winter
    automation
  triggers:
  - entity_id:
    - sensor.ottos_room_temp_humidity_sensor_temperature
    for:
      hours: 0
      minutes: 0
      seconds: 0
    above: 19.5
    id: Hot
    trigger: numeric_state
  - entity_id:
    - sensor.ottos_room_temp_humidity_sensor_temperature
    for:
      hours: 0
      minutes: 0
      seconds: 0
    below: 18.5
    id: Cold
    trigger: numeric_state
  conditions:
  - condition: time
    after: '18:00:00'
    before: 06:00:00
    weekday:
    - sun
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Holiday
  - condition: state
    entity_id: input_boolean.climate_manual_control_otto
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Hot
      sequence:
      - metadata: {}
        data:
          preset_mode: 'Off'
        target:
          entity_id: climate.otto_s_room
        enabled: false
        action: climate.set_preset_mode
      - metadata: {}
        data:
          hvac_mode: 'off'
        action: climate.set_hvac_mode
        target:
          entity_id: climate.otto_s_room
    - conditions:
      - condition: trigger
        id:
        - Cold
      sequence:
      - metadata: {}
        data:
          preset_mode: eco
        action: climate.set_preset_mode
        target:
          entity_id: climate.otto_s_room
      - metadata: {}
        data:
          hvac_mode: heat
        action: climate.set_hvac_mode
        target:
          entity_id: climate.otto_s_room
  mode: single
- id: '1747602740394'
  alias: Master Bedroom - Heater Night Assist
  description: Turns on the master bedroom heater overnight when temperatures fall
    below the threshold. Winter automation
  triggers:
  - entity_id:
    - sensor.temperaturesensor_temperature
    for:
      hours: 0
      minutes: 0
      seconds: 0
    above: 17.2
    id: Hot
    trigger: numeric_state
  - entity_id:
    - sensor.temperaturesensor_temperature
    for:
      hours: 0
      minutes: 10
      seconds: 0
    below: 16
    id: Cold
    trigger: numeric_state
  conditions:
  - condition: time
    after: '18:00:00'
    before: 06:00:00
    weekday:
    - sun
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Holiday
  - condition: state
    entity_id: input_boolean.climate_manual_control_master
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Hot
      sequence:
      - metadata: {}
        data:
          preset_mode: 'Off'
        target:
          entity_id: climate.masterbed_versatile_thermostat
        enabled: true
        action: climate.set_preset_mode
      - metadata: {}
        data:
          hvac_mode: 'off'
        action: climate.set_hvac_mode
        target:
          entity_id: climate.masterbed_versatile_thermostat
    - conditions:
      - condition: trigger
        id:
        - Cold
      sequence:
      - metadata: {}
        data:
          preset_mode: frost
        action: climate.set_preset_mode
        target:
          entity_id: climate.masterbed_versatile_thermostat
      - metadata: {}
        data:
          hvac_mode: heat
        action: climate.set_hvac_mode
        target:
          entity_id: climate.masterbed_versatile_thermostat
  mode: single
- id: '1747862856741'
  alias: Living Room - Night Temperature Setback
  description: Applies an overnight setback to the living room thermostat for energy
    savings. Winter automation
  triggers:
  - entity_id:
    - sensor.living_room_temperature_offset
    for:
      hours: 0
      minutes: 10
      seconds: 0
    above: 16
    id: Hot
    trigger: numeric_state
  - entity_id:
    - sensor.living_room_temperature_offset
    for:
      hours: 0
      minutes: 10
      seconds: 0
    below: 14.5
    id: Cold
    trigger: numeric_state
  conditions:
  - condition: time
    after: '22:00:00'
    before: 05:00:00
    weekday:
    - sun
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Holiday
  - condition: state
    entity_id: input_boolean.climate_manual_control_living
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Hot
      sequence:
      - metadata: {}
        data:
          hvac_mode: 'off'
        action: climate.set_hvac_mode
        target:
          entity_id: climate.living_room_ac
    - conditions:
      - condition: trigger
        id:
        - Cold
      sequence:
      - metadata: {}
        data:
          preset_mode: eco
        action: climate.set_preset_mode
        target:
          entity_id: climate.living_room_versatile_thermastat
      - metadata: {}
        data:
          hvac_mode: heat
        action: climate.set_hvac_mode
        target:
          entity_id:
          - climate.living_room_versatile_thermastat
  mode: single
- id: '1749730336110'
  alias: Living Room Audio - Control WiiM Amp Volume
  description: Sets and tracks the WiiM Amp volume based on scripted adjustments.
  triggers:
  - trigger: time
    at: 06:30:00
  conditions: []
  actions:
  - action: media_player.volume_set
    metadata: {}
    data:
      volume_level: 0.08
    target:
      device_id: 460e7ce205c826c208cee3efb7193105
  mode: single
- id: '1749858009259'
  alias: Outdoor Blinds - Cover Control Automation
  description: Coordinates cover control automation behaviour for the outdoor blinds.
  use_blueprint:
    path: hvorragend/cover_control_automation.yaml
    input:
      auto_options:
      - auto_up_enabled
      - auto_down_enabled
      - auto_brightness_enabled
      - auto_sun_enabled
      - auto_ventilate_enabled
      - auto_shading_enabled
      cover_status_options: cover_helper_enabled
      cover_status_helper: input_text.cover_status_helper
      workday_sensor: binary_sensor.workday_sensor
      default_brightness_sensor: sensor.hub_2_0be5_illuminance
      brightness_up: 4673
      contact_window_opened: binary_sensor.balcony_door_sensor_magnet_opening_2
      resident_sensor: input_boolean.home_presence
      check_config: true
      blind: cover.roller_blinds_chan1
      shading_brightness_sensor: sensor.hub_2_0be5_illuminance
      shading_temperatur_sensor1: sensor.ble_temperature_masterbed_temp_humidity_sensor
      shading_temperatur_sensor2: sensor.essendon_airport_temp
      shading_forecast_sensor: sensor.essendon_airport_max_temp
      shading_sun_brightness_start: 20000
      shading_sun_brightness_end: 10000
      shading_elevation_min: 30
      shading_azimuth_start: 0
      shading_azimuth_end: 360
      is_shading_end_immediate_by_sun_position: true
      auto_shading_start_condition: []
      auto_shading_end_condition:
      - condition: sun
        after: sunset
      brightness_down: 3500
      resident_config:
      - resident_closing_enabled
      - resident_allow_opening
      drive_delay_fix: 16
  conditions:
  - condition: state
    entity_id: input_boolean.blind_manual_control
    state: 'off'
- id: '1749869631608'
  alias: Curtains - Cover Control Automation
  description: Coordinates cover control automation behaviour for the curtain group.
  use_blueprint:
    path: hvorragend/cover_control_automation.yaml
    input:
      auto_options:
      - auto_up_enabled
      - auto_down_enabled
      - auto_brightness_enabled
      - auto_sun_enabled
      - auto_ventilate_enabled
      cover_status_options: cover_helper_disabled
      cover_status_helper: input_text.cover_status_helper_curtains
      workday_sensor: binary_sensor.workday_sensor
      default_brightness_sensor: sensor.hub_2_0be5_light_level
      brightness_up: 4673
      contact_window_opened: binary_sensor.balcony_door_sensor_magnet_opening_2
      resident_sensor: input_boolean.home_presence
      check_config: true
      blind: cover.curtain_3_b3bb
      shading_brightness_sensor: sensor.hub_2_0be5_illuminance
      shading_temperatur_sensor1: sensor.ble_temperature_masterbed_temp_humidity_sensor
      shading_temperatur_sensor2: sensor.essendon_airport_temp
      shading_forecast_sensor: sensor.essendon_airport_max_temp
- id: '1751230347186'
  alias: Driveway - Motion Notification
  description: Sends alerts when the driveway motion sensor is triggered.
  use_blueprint:
    path: vorion/send-camera-snapshot-notification-on-motion.yaml
    input:
      motion_sensor: binary_sensor.bi_driveway_motion
      camera: camera.driveway_cam_fluent
      notify_device: c054264b79e6739a057236f3a3c512b4
- id: '1752139587383'
  alias: Living Room - Heater Off Overnight
  description: Turns the living room heater off each night as part of the bedtime
    routine.
  triggers:
  - type: value
    device_id: c054264b79e6739a057236f3a3c512b4
    entity_id: sensor.samsung_galaxy_s22_ultra_sleep_confidence
    domain: sensor
    below: 80
    trigger: device
  - type: value
    device_id: 58e2eb1fec0eb5ec9ce450433d074fcf
    entity_id: sensor.slvdh_floors_descended
    domain: sensor
    above: 1
    trigger: device
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
    alias: Someone Home
  - condition: time
    after: '20:30:00'
    before: 01:00:00
  - condition: state
    entity_id: input_boolean.climate_manual_control_living
    state: 'off'
  actions:
  - metadata: {}
    data:
      hvac_mode: 'off'
    action: climate.set_hvac_mode
    target:
      area_id: living_room
  mode: single
- id: '1752213080801'
  alias: Living Room - Motion Lighting
  description: Controls living room lighting based on motion detection during set
    hours.
  triggers:
  - entity_id:
    - binary_sensor.aqara_motion_and_light_sensor_p2_occupancy
    to: 'on'
    trigger: state
    id: Motion Detected
  - entity_id:
    - binary_sensor.aqara_motion_and_light_sensor_p2_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 20
      seconds: 0
    trigger: state
    id: motion clear
  - trigger: sun
    event: sunrise
    offset: 00:20:00
  conditions:
  - type: is_illuminance
    condition: device
    device_id: bdadcf77909c9b2214e34dfa9ecef057
    entity_id: b93f5f454feabef4f527879b2e19309b
    domain: sensor
    below: 30
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Motion Detected
      - condition: numeric_state
        entity_id: sun.sun
        attribute: elevation
        below: 0
      sequence:
      - data: {}
        action: light.turn_on
        target:
          area_id:
          - back_garden
          entity_id: light.lounge
    - conditions:
      - condition: trigger
        id:
        - motion clear
      - condition: or
        conditions:
        - condition: and
          conditions:
          - condition: state
            entity_id: media_player.living_room_wiimamp
            state: playing
          - condition: state
            entity_id: media_player.tv_2
            state: playing
          - condition: numeric_state
            entity_id: sun.sun
            attribute: elevation
            above: 0
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.lounge
          area_id: back_garden
    - conditions:
      - condition: trigger
        id:
        - motion clear
      - condition: numeric_state
        entity_id: sun.sun
        attribute: elevation
        above: 0
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.lounge
          area_id: back_garden
  mode: restart
- id: '1752525370218'
  alias: Morning - Start Music Routine
  description: Starts the morning music playlist at the scheduled time.
  triggers:
  - trigger: time
    at: 06:30:00
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_select.occupancy
      state: Home
    - condition: state
      entity_id: input_select.occupancy
      state: Sleeping
  actions:
  - action: media_player.volume_set
    metadata: {}
    data:
      volume_level: 0.2
    target:
      entity_id: media_player.wiim_amp_pro_ebe4
  - action: media_player.play_media
    metadata: {}
    data: {}
    target:
      entity_id: media_player.wiim_amp_pro_ebe4
  mode: single
- id: '1756063707572'
  alias: Living Room - Lights Off When Watching TV
  description: Turns off selected lights when the living room TV is in use.
  triggers:
  - trigger: state
    entity_id:
    - media_player.tv
    to: playing
    for:
      hours: 0
      minutes: 5
      seconds: 0
    id: Playing
  - trigger: state
    entity_id:
    - media_player.tv
    to: paused
    for:
      hours: 0
      minutes: 0
      seconds: 0
    id: Paused
  conditions:
  - condition: sun
    after: sunset
    before: sunrise
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Playing
      - condition: time
        after: '20:30:00'
        before: 00:00:00
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.lounge
    - conditions:
      - condition: or
        conditions:
        - condition: time
          after: 00:00:00
          before: '20:30:00'
        - condition: trigger
          id:
          - Paused
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.living_room_evening
  mode: single
- id: '1727826000000'
  alias: Garage - Handle Close Notification Action
  description: Executes the garage close action when the mobile notification button
    is pressed.
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: CLOSE_GARAGE
  actions:
  - action: cover.close_cover
    target:
      entity_id: cover.smart_garage_door_garage
  mode: single
- id: '1727826000001'
  alias: Automation Tracker - Manual Blind Control
  description: Records when manual blind control is enabled so automations can respect
    the override.
  triggers:
  - trigger: state
    entity_id:
    - cover.roller_blinds_chan1
    - cover.windowcovering_cover
    attribute: current_position
  conditions:
  - condition: template
    value_template: '{{ trigger.to_state.context.user_id is not none }}'
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.blind_manual_control
  - delay:
      hours: 2
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.blind_manual_control
  mode: restart
- id: '1727826000002'
  alias: Automation Tracker - Manual Climate Control (Living Room)
  description: Captures manual climate changes in the living room to pause conflicting
    automations.
  triggers:
  - trigger: state
    entity_id:
    - climate.living_room_ac
    - climate.living_room_versatile_thermastat
  conditions:
  - condition: template
    value_template: '{{ trigger.to_state.context.user_id is not none }}'
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.climate_manual_control_living
  - delay:
      hours: 4
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.climate_manual_control_living
  mode: restart
- id: '1727826000003'
  alias: Automation Tracker - Manual Climate Control (Master Bedroom)
  description: Logs manual climate adjustments in the master bedroom to prevent automation
    interference.
  triggers:
  - trigger: state
    entity_id:
    - climate.masterbed_versatile_thermostat
  conditions:
  - condition: template
    value_template: '{{ trigger.to_state.context.user_id is not none }}'
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.climate_manual_control_master
  - delay:
      hours: 4
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.climate_manual_control_master
  mode: restart
- id: '1727826000004'
  alias: Automation Tracker - Manual Climate Control (Otto's Room)
  description: Tracks manual thermostat tweaks in Otto's room and pauses automations
    accordingly.
  triggers:
  - trigger: state
    entity_id:
    - climate.otto_s_room
  conditions:
  - condition: template
    value_template: '{{ trigger.to_state.context.user_id is not none }}'
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.climate_manual_control_otto
  - delay:
      hours: 4
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.climate_manual_control_otto
  mode: restart
- id: '1727826000005'
  alias: Automation Tracker - Manual Climate Control (Study / Henry's Room)
  description: Monitors manual climate changes in the study/Henry's room to suspend
    automation changes.
  triggers:
  - trigger: state
    entity_id:
    - climate.henry_s_room_versatile_thermostat
  conditions:
  - condition: template
    value_template: '{{ trigger.to_state.context.user_id is not none }}'
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.climate_manual_control_study
  - delay:
      hours: 4
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.climate_manual_control_study
  mode: restart
- id: '1727826100000'
  alias: Smart Climate Notification - Living Room
  description: Suggests climate control when solar excess available and room uncomfortable
  triggers:
  - trigger: state
    entity_id: sensor.living_room_climate_suggestion
    to:
    - heat_now
    - cool_now
    for:
      minutes: 30
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: state
    entity_id: climate.living_room_ac
    state: 'off'
  - condition: template
    value_template: "{% set last = states('input_datetime.last_climate_notification_living')\
      \ %} {% if last in ['unknown', 'unavailable', ''] %}\n  true\n{% else %}\n \
      \ {{ (as_timestamp(now()) - as_timestamp(last)) > 7200 }}\n{% endif %}\n"
  actions:
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title:  Climate Suggestion - Living Room
      message: '{{ state_attr(''sensor.living_room_climate_suggestion'', ''message'')
        }}'
      data:
        actions:
        - action: CLIMATE_LIVING_ON
          title: Turn On Climate
        - action: CLIMATE_DISMISS
          title: Dismiss
        tag: climate_suggestion_living
        importance: high
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.last_climate_notification_living
    data:
      datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
  mode: single
- id: '1727826100001'
  alias: Smart Climate Notification - Master Bedroom
  description: Suggests climate control when solar excess available and room uncomfortable
  triggers:
  - trigger: state
    entity_id: sensor.master_bedroom_climate_suggestion
    to:
    - heat_now
    - cool_now
    - heat_needed
    - cool_needed
    for:
      minutes: 30
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  - condition: state
    entity_id: climate.masterbed_versatile_thermostat
    state: 'off'
  - condition: state
    entity_id: input_boolean.climate_manual_control_master
    state: 'off'
  - condition: state
    entity_id: binary_sensor.master_bedroom_door_sensor_opening
    state: 'off'
  - condition: template
    value_template: "{% set last = states('input_datetime.last_climate_notification_master')\
      \ %} {% if last in ['unknown', 'unavailable', ''] %}\n  true\n{% else %}\n \
      \ {{ (as_timestamp(now()) - as_timestamp(last)) > 7200 }}\n{% endif %}\n"
  actions:
  - service: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title:  Climate Suggestion - Master Bedroom
      message: '{{ state_attr(''sensor.master_bedroom_climate_suggestion'', ''message'')
        }}'
      data:
        actions:
        - action: CLIMATE_MASTER_ON
          title: Turn On Climate
        - action: CLIMATE_DISMISS
          title: Dismiss
        tag: climate_suggestion_master
        importance: high
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.last_climate_notification_master
    data:
      datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
  mode: single
- id: '1727826100002'
  alias: Handle Climate Notification Action - Living Room
  description: Turn on living room climate when user taps notification
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: CLIMATE_LIVING_ON
  actions:
  - action: climate.turn_on
    target:
      entity_id: climate.living_room_ac
  - action: climate.set_temperature
    target:
      entity_id: climate.living_room_ac
    data:
      temperature: "{% if states('sensor.living_room_climate_suggestion') == 'heat_now'\
        \ %}\n  22\n{% else %}\n  24\n{% endif %}\n"
  - action: climate.set_hvac_mode
    target:
      entity_id: climate.living_room_ac
    data:
      hvac_mode: "{% if states('sensor.living_room_climate_suggestion') == 'heat_now'\
        \ %}\n  heat\n{% else %}\n  cool\n{% endif %}\n"
  mode: single
- id: '1727826100003'
  alias: Handle Climate Notification Action - Master Bedroom
  description: Turns on master bedroom climate when the user approves a notification
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: CLIMATE_MASTER_ON
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.master_bedroom_door_sensor_opening
        state: 'on'
      sequence:
      - service: notify.mobile_app_samsung_galaxy_s22_ultra
        data:
          title: Door is open
          message: Close the master bedroom door before starting the climate system.
      - stop: true
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.climate_manual_control_master
  - choose:
    - conditions:
      - condition: template
        value_template: "{{ states('sensor.master_bedroom_climate_suggestion') in ['heat_now', 'heat_needed'] }}"
      sequence:
      - service: script.roller_blinds_up
      - service: cover.open_cover
        target:
          entity_id: cover.windowcovering_cover
      - service: fan.turn_off
        target:
          entity_id: fan.masterbedroom_fan
      - service: climate.set_temperature
        target:
          entity_id: climate.masterbed_versatile_thermostat
        data:
          temperature: 20
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.masterbed_versatile_thermostat
        data:
          hvac_mode: heat
    default:
      - service: script.1693262268843
      - service: fan.set_percentage
        target:
          entity_id: fan.masterbedroom_fan
        data:
          percentage: 33
      - service: climate.set_temperature
        target:
          entity_id: climate.masterbed_versatile_thermostat
        data:
          temperature: 23
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.masterbed_versatile_thermostat
        data:
          hvac_mode: cool
  mode: single
- id: appliance_timeout_failsafe
  alias: Appliances - Timeout Failsafe
  description: Automatically turns off appliance trackers after timeout to prevent
    stuck states
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.dishwasher_on
    - input_boolean.washing_machine_on
    - input_boolean.dryer_on
    to: 'on'
    for:
      hours: 1
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id: '{{ trigger.entity_id }}'
  - action: notify.std_information
    data:
      title: Appliance Timeout
      message: '{{ state_attr(trigger.entity_id, "friendly_name") }} was automatically
        marked as done after timeout'
  mode: parallel
- id: bedtime_security_checklist
  alias: Night - Bedtime Security Checklist
  description: Provides a security checklist notification when switching to sleeping mode
  triggers:
  - trigger: state
    entity_id: input_select.occupancy
    to: 'Sleeping'
  actions:
  - delay:
      minutes: 2
  - action: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title:  Bedtime Checklist
      message: |
        {% set issues = [] %}
        {% if is_state('cover.smart_garage_door_garage', 'open') %}{% set issues = issues + [' Garage door open'] %}{% endif %}
        {% if is_state('binary_sensor.downstairs_doors', 'on') %}{% set issues = issues + [' Door open downstairs'] %}{% endif %}
        {% if states('climate.living_room_ac') in ['cool', 'heat'] %}{% set issues = issues + [' Living room AC still on'] %}{% endif %}
        {% if issues | length > 0 %}{{ issues | join('\n') }}{% else %} All secure - sleep well!{% endif %}
  mode: single
- id: morning_energy_climate_summary
  alias: Morning - Energy & Climate Summary
  description: Sends a morning summary of weather, solar production, and temperature
  triggers:
  - trigger: time
    at: "07:00:00"
  conditions:
  - condition: state
    entity_id: binary_sensor.someone_home
    state: 'on'
  actions:
  - action: notify.mobile_app_samsung_galaxy_s22_ultra
    data:
      title:  Good Morning - Daily Summary
      message: |
         Today's forecast: {{ states('sensor.braybrook_temp_max_0') }}C
         Current solar: {{ states('sensor.gosungrow_virtual_1205796_1_1_1_p24') | round(1) }}kW
         Home temp: {{ states('sensor.living_room_temperature_offset') }}C

        {% if is_state('input_boolean.super_hot_today', 'on') %} Super hot day - blinds will stay closed{% endif %}
  mode: single
- id: high_power_usage_warning
  alias: Energy - High Power Usage Warning
  description: Alerts when power consumption is high with minimal solar production
  triggers:
  - trigger: numeric_state
    entity_id: sensor.gosungrow_virtual_1205796_7_1_1_p8018
    above: 5000
    for:
      minutes: 15
  conditions:
  - condition: numeric_state
    entity_id: sensor.gosungrow_virtual_1205796_1_1_1_p24
    below: 2000
  actions:
  - action: notify.std_warning
    data:
      title:  High Grid Import
      message: "Importing {{ (states('sensor.gosungrow_virtual_1205796_7_1_1_p8018') | float / 1000) | round(1) }}kW from grid with only {{ (states('sensor.gosungrow_virtual_1205796_1_1_1_p24') | float / 1000) | round(1) }}kW solar - check what's running"
  mode: single
- id: ac_filter_living_room_reminder
  alias: Maintenance - Living Room AC Filter Reminder
  description: Reminds to change Living Room AC filter every 90 days
  triggers:
  - trigger: time
    at: "09:00:00"
  conditions:
  - condition: template
    value_template: >
      {% set last = states('input_datetime.ac_filter_living_room') %}
      {% if last in ['unknown', 'unavailable', ''] %}
        true
      {% else %}
        {{ (as_timestamp(now()) - as_timestamp(last)) / 86400 > 90 }}
      {% endif %}
  actions:
  - action: notify.std_information
    data:
      title:  Living Room AC Filter Due
      message: |
        Living Room AC filter needs replacement
        {% set last = states('input_datetime.ac_filter_living_room') %}
        {% if last not in ['unknown', 'unavailable', ''] %}
        Last changed {{ relative_time(states('input_datetime.ac_filter_living_room')) }} ago
        {% else %}
        No change date recorded
        {% endif %}
  mode: single
- id: ac_filter_master_bedroom_reminder
  alias: Maintenance - Master Bedroom AC Filter Reminder
  description: Reminds to change Master Bedroom AC filter every 90 days
  triggers:
  - trigger: time
    at: "09:00:00"
  conditions:
  - condition: template
    value_template: >
      {% set last = states('input_datetime.ac_filter_master_bedroom') %}
      {% if last in ['unknown', 'unavailable', ''] %}
        true
      {% else %}
        {{ (as_timestamp(now()) - as_timestamp(last)) / 86400 > 90 }}
      {% endif %}
  actions:
  - action: notify.std_information
    data:
      title:  Master Bedroom AC Filter Due
      message: |
        Master Bedroom AC filter needs replacement
        {% set last = states('input_datetime.ac_filter_master_bedroom') %}
        {% if last not in ['unknown', 'unavailable', ''] %}
        Last changed {{ relative_time(states('input_datetime.ac_filter_master_bedroom')) }} ago
        {% else %}
        No change date recorded
        {% endif %}
  mode: single
- id: ac_filter_otto_room_reminder
  alias: Maintenance - Otto's Room AC Filter Reminder
  description: Reminds to change Otto's Room AC filter every 90 days
  triggers:
  - trigger: time
    at: "09:00:00"
  conditions:
  - condition: template
    value_template: >
      {% set last = states('input_datetime.ac_filter_otto_room') %}
      {% if last in ['unknown', 'unavailable', ''] %}
        true
      {% else %}
        {{ (as_timestamp(now()) - as_timestamp(last)) / 86400 > 90 }}
      {% endif %}
  actions:
  - action: notify.std_information
    data:
      title:  Otto's Room AC Filter Due
      message: |
        Otto's Room AC filter needs replacement
        {% set last = states('input_datetime.ac_filter_otto_room') %}
        {% if last not in ['unknown', 'unavailable', ''] %}
        Last changed {{ relative_time(states('input_datetime.ac_filter_otto_room')) }} ago
        {% else %}
        No change date recorded
        {% endif %}
  mode: single
- id: ac_filter_study_henry_reminder
  alias: Maintenance - Study/Henry's Room AC Filter Reminder
  description: Reminds to change Study/Henry's Room AC filter every 90 days
  triggers:
  - trigger: time
    at: "09:00:00"
  conditions:
  - condition: template
    value_template: >
      {% set last = states('input_datetime.ac_filter_study_henry') %}
      {% if last in ['unknown', 'unavailable', ''] %}
        true
      {% else %}
        {{ (as_timestamp(now()) - as_timestamp(last)) / 86400 > 90 }}
      {% endif %}
  actions:
  - action: notify.std_information
    data:
      title:  Study/Henry's Room AC Filter Due
      message: |
        Study/Henry's Room AC filter needs replacement
        {% set last = states('input_datetime.ac_filter_study_henry') %}
        {% if last not in ['unknown', 'unavailable', ''] %}
        Last changed {{ relative_time(states('input_datetime.ac_filter_study_henry')) }} ago
        {% else %}
        No change date recorded
        {% endif %}
  mode: single
- id: ac_filter_living_room_changed
  alias: Maintenance - Living Room AC Filter Changed (NFC)
  description: Updates the filter change date when NFC tag is scanned
  triggers:
  - trigger: tag
    tag_id: REPLACE_WITH_YOUR_NFC_TAG_ID
  actions:
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.ac_filter_living_room
    data:
      datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
  - action: notify.std_information
    data:
      title:  Living Room AC Filter Updated
      message: Filter change date recorded successfully
  mode: single
- id: ac_filter_master_bedroom_changed
  alias: Maintenance - Master Bedroom AC Filter Changed (NFC)
  description: Updates the filter change date when NFC tag is scanned
  triggers:
  - trigger: tag
    tag_id: REPLACE_WITH_YOUR_NFC_TAG_ID
  actions:
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.ac_filter_master_bedroom
    data:
      datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
  - action: notify.std_information
    data:
      title:  Master Bedroom AC Filter Updated
      message: Filter change date recorded successfully
  mode: single
- id: ac_filter_otto_room_changed
  alias: Maintenance - Otto's Room AC Filter Changed (NFC)
  description: Updates the filter change date when NFC tag is scanned
  triggers:
  - trigger: tag
    tag_id: REPLACE_WITH_YOUR_NFC_TAG_ID
  actions:
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.ac_filter_otto_room
    data:
      datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
  - action: notify.std_information
    data:
      title:  Otto's Room AC Filter Updated
      message: Filter change date recorded successfully
  mode: single
- id: ac_filter_study_henry_changed
  alias: Maintenance - Study/Henry's Room AC Filter Changed (NFC)
  description: Updates the filter change date when NFC tag is scanned
  triggers:
  - trigger: tag
    tag_id: REPLACE_WITH_YOUR_NFC_TAG_ID
  actions:
  - action: input_datetime.set_datetime
    target:
      entity_id: input_datetime.ac_filter_study_henry
    data:
      datetime: '{{ now().strftime(''%Y-%m-%d %H:%M:%S'') }}'
  - action: notify.std_information
    data:
      title:  Study/Henry's Room AC Filter Updated
      message: Filter change date recorded successfully
  mode: single

- id: keep_computer_desk_light_socket_2_on
  alias: Keep Computer Desk Light Socket 2 Always On
  description: Ensures switch.computer_desk_light_socket_2 is always turned on
  trigger:
    - platform: state
      entity_id: switch.computer_desk_light_socket_2
      to: 'off'
  actions:
    - action: switch.turn_on
      target:
        entity_id: switch.computer_desk_light_socket_2
  mode: single

- id: garage_door_open_display_cameras
  alias: Garage Door - Cast Front Door Camera on Open
  description: Casts the front door camera to the kitchen display when the garage door opens
  triggers:
    - trigger: state
      entity_id: cover.smart_garage_door_garage
      to: 'open'
  conditions: []
  actions:
    - service: camera.play_stream
      data:
        media_player: media_player.kitchen
        format: hls
      target:
        entity_id: camera.bi_front_door_camera
  mode: single

- id: garage_door_close_stop_kitchen
  alias: Garage Door - Stop Kitchen Stream on Close
  description: Stops any kitchen playback once the garage door closes
  triggers:
    - trigger: state
      entity_id: cover.smart_garage_door_garage
      to: 'closed'
      from: 'open'
  conditions: []
  actions:
    - service: media_player.media_stop
      target:
        entity_id: media_player.kitchen
  mode: single
- id: '1728310000000'
  alias: Master Bedroom - Solar Assisted Climate Control
  description: Uses solar excess, shading, and fan control to keep the master bedroom between 18-24C while respecting manual overrides.
  triggers:
  - platform: state
    entity_id: sensor.master_bedroom_climate_suggestion
  - platform: state
    entity_id: binary_sensor.solar_excess_available
  - platform: state
    entity_id: binary_sensor.master_bedroom_door_sensor_opening
  - platform: state
    entity_id: input_boolean.climate_manual_control_master
  - platform: state
    entity_id: sensor.ble_temperature_masterbed_temp_humidity_sensor
  - platform: time_pattern
    minutes: "/5"
  - platform: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.climate_manual_control_master
        state: 'on'
      sequence:
      - stop: true
    - conditions:
      - condition: state
        entity_id: binary_sensor.master_bedroom_door_sensor_opening
        state: 'on'
      sequence:
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.masterbed_versatile_thermostat
        data:
          hvac_mode: 'off'
      - service: fan.turn_off
        target:
          entity_id: fan.masterbedroom_fan
      - stop: true
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.solar_excess_available
        state: 'on'
      - condition: state
        entity_id: binary_sensor.master_bedroom_door_sensor_opening
        state: 'off'
      sequence:
      - choose:
        - conditions:
          - condition: numeric_state
            entity_id: sensor.ble_temperature_masterbed_temp_humidity_sensor
            above: 26
          sequence:
          - service: cover.close_cover
            target:
              entity_id: cover.roller_blinds_chan1
          - service: cover.close_cover
            target:
              entity_id: cover.windowcovering_cover
          - service: fan.set_percentage
            target:
              entity_id: fan.masterbedroom_fan
            data:
              percentage: 66
          - service: climate.set_temperature
            target:
              entity_id: climate.masterbed_versatile_thermostat
            data:
              temperature: 23
          - service: climate.set_hvac_mode
            target:
              entity_id: climate.masterbed_versatile_thermostat
            data:
              hvac_mode: cool
        - conditions:
          - condition: numeric_state
            entity_id: sensor.ble_temperature_masterbed_temp_humidity_sensor
            above: 24
          sequence:
          - service: script.1693262268843
          - service: fan.set_percentage
            target:
              entity_id: fan.masterbedroom_fan
            data:
              percentage: 33
          - service: climate.set_temperature
            target:
              entity_id: climate.masterbed_versatile_thermostat
            data:
              temperature: 23
          - service: climate.set_hvac_mode
            target:
              entity_id: climate.masterbed_versatile_thermostat
            data:
              hvac_mode: cool
        - conditions:
          - condition: numeric_state
            entity_id: sensor.ble_temperature_masterbed_temp_humidity_sensor
            below: 18
          sequence:
          - service: script.roller_blinds_up
          - service: cover.open_cover
            target:
              entity_id: cover.windowcovering_cover
          - service: fan.turn_off
            target:
              entity_id: fan.masterbedroom_fan
          - service: climate.set_temperature
            target:
              entity_id: climate.masterbed_versatile_thermostat
            data:
              temperature: 20
          - service: climate.set_hvac_mode
            target:
              entity_id: climate.masterbed_versatile_thermostat
            data:
              hvac_mode: heat
        default:
          - service: fan.turn_off
            target:
              entity_id: fan.masterbedroom_fan
          - service: climate.set_hvac_mode
            target:
              entity_id: climate.masterbed_versatile_thermostat
            data:
              hvac_mode: 'off'
    default:
      - choose:
        - conditions:
          - condition: numeric_state
            entity_id: sensor.ble_temperature_masterbed_temp_humidity_sensor
            above: 24
          sequence:
          - service: script.1693262268843
          - service: fan.set_percentage
            target:
              entity_id: fan.masterbedroom_fan
            data:
              percentage: 33
        - conditions:
          - condition: numeric_state
            entity_id: sensor.ble_temperature_masterbed_temp_humidity_sensor
            below: 18
          sequence:
          - service: cover.close_cover
            target:
              entity_id: cover.windowcovering_cover
          - service: fan.turn_off
            target:
              entity_id: fan.masterbedroom_fan
      - service: climate.set_hvac_mode
        target:
          entity_id: climate.masterbed_versatile_thermostat
        data:
          hvac_mode: 'off'
  mode: single
